<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.2">
<meta name="author" content="Costin Leau, Jennifer Hickey, Christoph Strobl, Thomas Darimont, Mark Paluch, Jay Bryant">
<title>Spring Data Redis</title>
<link rel="stylesheet" href="css/spring.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
</head>
<body class="book toc2 toc-left">
<div id="header">
<h1>Spring Data Redis</h1>
<div class="details">
<span id="author" class="author">Costin Leau, Jennifer Hickey, Christoph Strobl, Thomas Darimont, Mark Paluch, Jay Bryant</span><br>
<span id="revnumber">version 2.4.1,</span>
<span id="revdate">2020-11-11</span>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel0">
<li><a href="index.html#preface">Preface</a>
<ul class="sectlevel1">
<li><a href="index.html#get-started:first-steps:spring">1. Learning Spring</a></li>
<li><a href="index.html#get-started:first-steps:nosql">2. Learning NoSQL and Key Value Stores</a>
<ul class="sectlevel2">
<li><a href="index.html#get-started:first-steps:samples">2.1. Trying out the Samples</a></li>
</ul>
</li>
<li><a href="index.html#requirements">3. Requirements</a></li>
<li><a href="index.html#get-started:help">4. Additional Help Resources</a></li>
<li><a href="index.html#get-started:up-to-date">5. Following Development</a></li>
<li><a href="index.html#new-features">6. New &amp; Noteworthy</a>
<ul class="sectlevel2">
<li><a href="index.html#new-in-2.4.0">6.1. New in Spring Data Redis 2.4</a></li>
<li><a href="index.html#new-in-2.3.0">6.2. New in Spring Data Redis 2.3</a></li>
<li><a href="index.html#new-in-2.2.0">6.3. New in Spring Data Redis 2.2</a></li>
<li><a href="index.html#new-in-2.1.0">6.4. New in Spring Data Redis 2.1</a></li>
<li><a href="index.html#new-in-2.0.0">6.5. New in Spring Data Redis 2.0</a></li>
<li><a href="index.html#new-in-1.8.0">6.6. New in Spring Data Redis 1.8</a></li>
<li><a href="index.html#new-in-1.7.0">6.7. New in Spring Data Redis 1.7</a></li>
<li><a href="index.html#new-in-1-6-0">6.8. New in Spring Data Redis 1.6</a></li>
<li><a href="index.html#new-in-1-5-0">6.9. New in Spring Data Redis 1.5</a></li>
</ul>
</li>
<li><a href="index.html#dependencies">7. Dependencies</a>
<ul class="sectlevel2">
<li><a href="index.html#dependencies.spring-boot">7.1. Dependency Management with Spring Boot</a></li>
<li><a href="index.html#dependencies.spring-framework">7.2. Spring Framework</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="index.html#reference">Reference Documentation</a>
<ul class="sectlevel1">
<li><a href="index.html#introduction">8. Introduction</a>
<ul class="sectlevel2">
<li><a href="index.html#introduction.structure">8.1. Document Structure</a></li>
</ul>
</li>
<li><a href="index.html#why-spring-redis">9. Why Spring Data Redis?</a></li>
<li><a href="index.html#redis">10. Redis support</a>
<ul class="sectlevel2">
<li><a href="index.html#redis:setup">10.1. Getting Started</a></li>
<li><a href="index.html#redis:requirements">10.2. Redis Requirements</a></li>
<li><a href="index.html#redis:architecture">10.3. Redis Support High-level View</a></li>
<li><a href="index.html#redis:connectors">10.4. Connecting to Redis</a>
<ul class="sectlevel3">
<li><a href="index.html#redis:connectors:connection">10.4.1. RedisConnection and RedisConnectionFactory</a></li>
<li><a href="index.html#redis:connectors:lettuce">10.4.2. Configuring the Lettuce Connector</a></li>
<li><a href="index.html#redis:connectors:jedis">10.4.3. Configuring the Jedis Connector</a></li>
<li><a href="index.html#redis:write-to-master-read-from-replica">10.4.4. Write to Master, Read from Replica</a></li>
</ul>
</li>
<li><a href="index.html#redis:sentinel">10.5. Redis Sentinel Support</a></li>
<li><a href="index.html#redis:template">10.6. Working with Objects through RedisTemplate</a></li>
<li><a href="index.html#redis:string">10.7. String-focused Convenience Classes</a></li>
<li><a href="index.html#redis:serializer">10.8. Serializers</a></li>
<li><a href="index.html#redis.hashmappers.root">10.9. Hash mapping</a>
<ul class="sectlevel3">
<li><a href="index.html#">10.9.1. Hash Mappers</a></li>
<li><a href="index.html#redis.hashmappers.jackson2">10.9.2. Jackson2HashMapper</a></li>
</ul>
</li>
<li><a href="index.html#pubsub">10.10. Redis Messaging (Pub/Sub)</a>
<ul class="sectlevel3">
<li><a href="index.html#redis:pubsub:publish">10.10.1. Publishing (Sending Messages)</a></li>
<li><a href="index.html#redis:pubsub:subscribe">10.10.2. Subscribing (Receiving Messages)</a>
<ul class="sectlevel4">
<li><a href="index.html#redis:pubsub:subscribe:containers">Message Listener Containers</a></li>
<li><a href="index.html#redis:pubsub:subscribe:adapter">The MessageListenerAdapter</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="index.html#redis.streams">10.11. Redis Streams</a>
<ul class="sectlevel3">
<li><a href="index.html#redis.streams.send">10.11.1. Appending</a></li>
<li><a href="index.html#redis.streams.receive">10.11.2. Consuming</a>
<ul class="sectlevel4">
<li><a href="index.html#redis.streams.receive.synchronous">Synchronous reception</a></li>
<li><a href="index.html#redis.streams.receive.containers">Asynchronous reception through Message Listener Containers</a></li>
<li><a href="index.html#redis.streams.acknowledge"><code>Acknowledge</code> strategies</a></li>
<li><a href="index.html#redis.streams.receive.readoffset"><code>ReadOffset</code> strategies</a></li>
<li><a href="index.html#redis.streams.receive.serialization">Serialization</a></li>
<li><a href="index.html#redis.streams.hashing">Object Mapping</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="index.html#tx">10.12. Redis Transactions</a>
<ul class="sectlevel3">
<li><a href="index.html#tx.spring">10.12.1. @Transactional Support</a></li>
</ul>
</li>
<li><a href="index.html#pipeline">10.13. Pipelining</a></li>
<li><a href="index.html#scripting">10.14. Redis Scripting</a></li>
<li><a href="index.html#redis:support">10.15. Support Classes</a>
<ul class="sectlevel3">
<li><a href="index.html#redis:support:cache-abstraction">10.15.1. Support for the Spring Cache Abstraction</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="index.html#redis:reactive">11. Reactive Redis support</a>
<ul class="sectlevel2">
<li><a href="index.html#redis:reactive:requirements">11.1. Redis Requirements</a></li>
<li><a href="index.html#redis:reactive:connectors">11.2. Connecting to Redis by Using a Reactive Driver</a>
<ul class="sectlevel3">
<li><a href="index.html#redis:reactive:connectors:operation-modes">11.2.1. Redis Operation Modes</a></li>
<li><a href="index.html#redis:reactive:connectors:connection">11.2.2. <code>ReactiveRedisConnection</code> and <code>ReactiveRedisConnectionFactory</code></a></li>
<li><a href="index.html#redis:reactive:connectors:lettuce">11.2.3. Configuring a Lettuce Connector</a></li>
</ul>
</li>
<li><a href="index.html#redis:reactive:template">11.3. Working with Objects through ReactiveRedisTemplate</a></li>
<li><a href="index.html#redis:reactive:string">11.4. String-focused Convenience Classes</a></li>
<li><a href="index.html#redis:reactive:pubsub">11.5. Redis Messaging/PubSub</a>
<ul class="sectlevel3">
<li><a href="index.html#redis:reactive:pubsub:publish">11.5.1. Sending/Publishing messages</a></li>
<li><a href="index.html#redis:reactive:pubsub:subscribe">11.5.2. Receiving/Subscribing for messages</a>
<ul class="sectlevel4">
<li><a href="index.html#redis:reactive:pubsub:subscribe:containers">Message Listener Containers</a></li>
<li><a href="index.html#redis:reactive:pubsub:subscribe:template">Subscribing via template API</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="index.html#redis:reactive:scripting">11.6. Reactive Scripting</a></li>
</ul>
</li>
<li><a href="index.html#cluster">12. Redis Cluster</a>
<ul class="sectlevel2">
<li><a href="index.html#">12.1. Enabling Redis Cluster</a></li>
<li><a href="index.html#cluster.working.with.cluster">12.2. Working With Redis Cluster Connection</a></li>
<li><a href="index.html#cluster.redistemplate">12.3. Working with <code>RedisTemplate</code> and <code>ClusterOperations</code></a></li>
</ul>
</li>
<li><a href="index.html#redis.repositories">13. Redis Repositories</a>
<ul class="sectlevel2">
<li><a href="index.html#redis.repositories.usage">13.1. Usage</a></li>
<li><a href="index.html#mapping.fundamentals">13.2. Object Mapping Fundamentals</a>
<ul class="sectlevel3">
<li><a href="index.html#mapping.object-creation">13.2.1. Object creation</a></li>
<li><a href="index.html#mapping.property-population">13.2.2. Property population</a></li>
<li><a href="index.html#mapping.general-recommendations">13.2.3. General recommendations</a></li>
<li><a href="index.html#mapping.kotlin">13.2.4. Kotlin support</a>
<ul class="sectlevel4">
<li><a href="index.html#">Kotlin object creation</a></li>
<li><a href="index.html#">Property population of Kotlin data classes</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="index.html#redis.repositories.mapping">13.3. Object-to-Hash Mapping</a>
<ul class="sectlevel3">
<li><a href="index.html#">13.3.1. Customizing Type Mapping</a>
<ul class="sectlevel4">
<li><a href="index.html#">Configuring Custom Type Mapping</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="index.html#redis.repositories.keyspaces">13.4. Keyspaces</a></li>
<li><a href="index.html#redis.repositories.indexes">13.5. Secondary Indexes</a>
<ul class="sectlevel3">
<li><a href="index.html#redis.repositories.indexes.simple">13.5.1. Simple Property Index</a></li>
<li><a href="index.html#redis.repositories.indexes.geospatial">13.5.2. Geospatial Index</a></li>
</ul>
</li>
<li><a href="index.html#query-by-example">13.6. Query by Example</a>
<ul class="sectlevel3">
<li><a href="index.html#query-by-example.introduction">13.6.1. Introduction</a></li>
<li><a href="index.html#query-by-example.usage">13.6.2. Usage</a></li>
<li><a href="index.html#query-by-example.matchers">13.6.3. Example Matchers</a></li>
<li><a href="index.html#query-by-example.running">13.6.4. Running an Example</a></li>
</ul>
</li>
<li><a href="index.html#redis.repositories.expirations">13.7. Time To Live</a></li>
<li><a href="index.html#redis.repositories.references">13.8. Persisting References</a></li>
<li><a href="index.html#redis.repositories.partial-updates">13.9. Persisting Partial Updates</a></li>
<li><a href="index.html#redis.repositories.queries">13.10. Queries and Query Methods</a></li>
<li><a href="index.html#redis.repositories.cluster">13.11. Redis Repositories Running on a Cluster</a></li>
<li><a href="index.html#redis.repositories.cdi-integration">13.12. CDI Integration</a></li>
<li><a href="index.html#redis.repositories.anatomy">13.13. Redis Repositories Anatomy</a>
<ul class="sectlevel3">
<li><a href="index.html#redis.repositories.anatomy.insert">13.13.1. Insert new</a></li>
<li><a href="index.html#redis.repositories.anatomy.replace">13.13.2. Replace existing</a></li>
<li><a href="index.html#redis.repositories.anatomy.geo">13.13.3. Save Geo Data</a></li>
<li><a href="index.html#redis.repositories.anatomy.index">13.13.4. Find using simple index</a></li>
<li><a href="index.html#redis.repositories.anatomy.geo-index">13.13.5. Find using Geo Index</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a href="index.html#appendixes">Appendixes</a>
<ul class="sectlevel1">
<li><a href="index.html#appendix">Appendix Document Structure</a></li>
<li><a href="index.html#appendix:schema">Appendix A: Schema</a></li>
<li><a href="index.html#appendix:command-reference">Appendix B: Command Reference</a>
<ul class="sectlevel2">
<li><a href="index.html#">Supported Commands</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>&#169; 2011-2020 The original authors.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Copies of this document may be made for your own use and for distribution to others, provided that you do not charge any fee for such copies and further provided that each copy contains this Copyright Notice, whether distributed in print or electronically.
</td>
</tr>
</table>
</div>

</div>
</div>
<h1 id="preface" class="sect0"><a class="anchor" href="index.html#preface"></a>Preface</h1>
<div class="openblock partintro">
<div class="content">
<div class="paragraph">
<p>The Spring Data Redis project applies core Spring concepts to the development of solutions by using a key-value style data store.
We provide a &#8220;template&#8221; as a high-level abstraction for sending and receiving messages.
You may notice similarities to the JDBC support in the Spring Framework.</p>
</div>
<div class="paragraph">
<p>This section provides an easy-to-follow guide for getting started with the Spring Data Redis module.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="get-started:first-steps:spring"><a class="anchor" href="index.html#get-started:first-steps:spring"></a>1. Learning Spring</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Spring Data uses Spring framework&#8217;s <a href="https://docs.spring.io/spring/docs/5.3.1/spring-framework-reference/core.html">core</a> functionality, including:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://docs.spring.io/spring/docs/5.3.1/spring-framework-reference/core.html#beans">IoC</a> container</p>
</li>
<li>
<p><a href="https://docs.spring.io/spring/docs/5.3.1/spring-framework-reference/core.html#validation">type conversion system</a></p>
</li>
<li>
<p><a href="https://docs.spring.io/spring/docs/5.3.1/spring-framework-reference/core.html#expressions">expression language</a></p>
</li>
<li>
<p><a href="https://docs.spring.io/spring/docs/5.3.1/spring-framework-reference/integration.html#jmx">JMX integration</a></p>
</li>
<li>
<p><a href="https://docs.spring.io/spring/docs/5.3.1/spring-framework-reference/data-access.html#dao-exceptions">DAO exception hierarchy</a>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>While you need not know the Spring APIs, understanding the concepts behind them is important.
At a minimum, the idea behind Inversion of Control (IoC) should be familiar, and you should be familiar with whatever IoC container you choose to use.</p>
</div>
<div class="paragraph">
<p>The core functionality of the Redis support can be used directly, with no need to invoke the IoC services of the Spring Container.
This is much like <code>JdbcTemplate</code>, which can be used "'standalone'" without any other services of the Spring container.
To leverage all the features of Spring Data Redis, such as the repository support, you need to configure some parts of the library to use Spring.</p>
</div>
<div class="paragraph">
<p>To learn more about Spring, you can refer to the comprehensive documentation that explains the Spring Framework in detail.
There are a lot of articles, blog entries, and books on the subject.
See the Spring framework <a href="https://spring.io/docs">home page</a> for more information.</p>
</div>
<div class="paragraph">
<p>In general, this should be the starting point for developers wanting to try Spring Data Redis.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="get-started:first-steps:nosql"><a class="anchor" href="index.html#get-started:first-steps:nosql"></a>2. Learning NoSQL and Key Value Stores</h2>
<div class="sectionbody">
<div class="paragraph">
<p>NoSQL stores have taken the storage world by storm.
It is a vast domain with a plethora of solutions, terms, and patterns (to make things worse, even the term itself has multiple <a href="https://www.google.com/search?q=nosoql+acronym">meanings</a>).
While some of the principles are common, it is crucial that you be familiar to some degree with the stores supported by SDR. The best way to get acquainted with these solutions is to read their documentation and follow their examples.
It usually does not take more then five to ten minutes to go through them and, if you come from an RDMBS-only background, many times these exercises can be eye-openers.</p>
</div>
<div class="sect2">
<h3 id="get-started:first-steps:samples"><a class="anchor" href="index.html#get-started:first-steps:samples"></a>2.1. Trying out the Samples</h3>
<div class="paragraph">
<p>One can find various samples for key-value stores in the dedicated Spring Data example repo, at <a href="https://github.com/spring-projects/spring-data-keyvalue-examples">https://github.com/spring-projects/spring-data-keyvalue-examples</a>.
For Spring Data Redis, you should pay particular attention to the <code>retwisj</code> sample, a Twitter-clone built on top of Redis that can be run locally or be deployed into the cloud.
See its <a href="../../../../../data-keyvalue/examples/retwisj/current/index.html">documentation</a>, the following blog <a href="https://spring.io/blog/2011/04/27/getting-started-redis-spring-cloud-foundry/">entry</a> for more information.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="requirements"><a class="anchor" href="index.html#requirements"></a>3. Requirements</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Spring Data Redis 2.x binaries require JDK level 8.0 and above and <a href="https://projects.spring.io/spring-framework/">Spring Framework</a> 5.3.1 and above.</p>
</div>
<div class="paragraph">
<p>In terms of key-value stores, <a href="https://redis.io">Redis</a> 2.6.x or higher is required.
Spring Data Redis is currently tested against the latest 4.0 release.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="get-started:help"><a class="anchor" href="index.html#get-started:help"></a>4. Additional Help Resources</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Learning a new framework is not always straightforward.
In this section, we try to provide what we think is an easy-to-follow guide for starting with the Spring Data Redis module.
However, if you encounter issues or you need advice, feel free to use one of the following links:</p>
</div>
<div class="dlist get-started:help:community]">
<dl>
<dt>Community Forum </dt>
<dd>
<p>Spring Data on <a href="https://stackoverflow.com/questions/tagged/spring-data">Stack Overflow</a> is a tag for all Spring Data (not just Document) users to share information and help each other.
Note that registration is needed only for posting.</p>
</dd>
</dl>
</div>
<div id="get-started:help:professional" class="dlist">
<dl>
<dt class="hdlist1">Professional Support </dt>
<dd>
<p>Professional, from-the-source support, with guaranteed response time, is available from <a href="https://pivotal.io/">Pivotal Sofware, Inc.</a>, the company behind Spring Data and Spring.</p>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect1">
<h2 id="get-started:up-to-date"><a class="anchor" href="index.html#get-started:up-to-date"></a>5. Following Development</h2>
<div class="sectionbody">
<div class="paragraph">
<p>For information on the Spring Data source code repository, nightly builds, and snapshot artifacts, see the Spring Data home <a href="https://spring.io/spring-data">page</a>.</p>
</div>
<div class="paragraph">
<p>You can help make Spring Data best serve the needs of the Spring community by interacting with developers on Stack Overflow at either
<a href="https://stackoverflow.com/questions/tagged/spring-data">spring-data</a> or <a href="https://stackoverflow.com/questions/tagged/spring-data-redis">spring-data-redis</a>.</p>
</div>
<div class="paragraph">
<p>If you encounter a bug or want to suggest an improvement (including to this documentation), please create a ticket on the Spring Data issue <a href="https://jira.spring.io/browse/DATAREDIS">tracker</a>.</p>
</div>
<div class="paragraph">
<p>To stay up to date with the latest news and announcements in the Spring eco system, subscribe to the Spring Community <a href="https://spring.io/">Portal</a>.</p>
</div>
<div class="paragraph">
<p>Lastly, you can follow the Spring <a href="https://spring.io/blog/">blog</a> or the project team (<a href="https://twitter.com/SpringData">@SpringData</a>) on Twitter.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="new-features"><a class="anchor" href="index.html#new-features"></a>6. New &amp; Noteworthy</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This section briefly covers items that are new and noteworthy in the latest releases.</p>
</div>
<div class="sect2">
<h3 id="new-in-2.4.0"><a class="anchor" href="index.html#new-in-2.4.0"></a>6.1. New in Spring Data Redis 2.4</h3>
<div class="ulist">
<ul>
<li>
<p><code>RedisCache</code> now exposes <code>CacheStatistics</code>.</p>
</li>
<li>
<p>ACL authentication support for Redis Standalone, Redis Cluster and Master/Replica.</p>
</li>
<li>
<p>Password support for Redis Sentinel using Jedis.</p>
</li>
<li>
<p>Support for <code>ZREVRANGEBYLEX</code> and <code>ZLEXCOUNT</code> commands.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="new-in-2.3.0"><a class="anchor" href="index.html#new-in-2.3.0"></a>6.2. New in Spring Data Redis 2.3</h3>
<div class="ulist">
<ul>
<li>
<p>Template API Method Refinements for <code>Duration</code> and <code>Instant</code>.</p>
</li>
<li>
<p>Extension of Stream Commands.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="new-in-2.2.0"><a class="anchor" href="index.html#new-in-2.2.0"></a>6.3. New in Spring Data Redis 2.2</h3>
<div class="ulist">
<ul>
<li>
<p><a href="index.html#redis.streams">Redis Streams</a></p>
</li>
<li>
<p>Refined <code>union</code>/<code>diff</code>/<code>intersect</code> set-operation methods accepting a single collection of keys.</p>
</li>
<li>
<p>Upgrade to Jedis 3.</p>
</li>
<li>
<p>Add support for scripting commands using Jedis Cluster.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="new-in-2.1.0"><a class="anchor" href="index.html#new-in-2.1.0"></a>6.4. New in Spring Data Redis 2.1</h3>
<div class="ulist">
<ul>
<li>
<p>Unix domain socket connections using <a href="index.html#redis:connectors:lettuce">Lettuce</a>.</p>
</li>
<li>
<p><a href="index.html#redis:write-to-master-read-from-replica">Write to Master, read from Replica</a> support using Lettuce.</p>
</li>
<li>
<p><a href="index.html#query-by-example">Query by Example</a> integration.</p>
</li>
<li>
<p><code>@TypeAlias</code> Support for Redis repositories.</p>
</li>
<li>
<p>Cluster-wide <code>SCAN</code> using Lettuce and <code>SCAN</code> on a selected node supported by both drivers.</p>
</li>
<li>
<p><a href="index.html#redis:reactive:pubsub">Reactive Pub/Sub</a> to send and receive a message stream.</p>
</li>
<li>
<p><code>BITFIELD</code>, <code>BITPOS</code>, and <code>OBJECT</code> command support.</p>
</li>
<li>
<p>Align return types of <code>BoundZSetOperations</code> with <code>ZSetOperations</code>.</p>
</li>
<li>
<p>Reactive <code>SCAN</code>, <code>HSCAN</code>, <code>SSCAN</code>, and <code>ZSCAN</code> support.</p>
</li>
<li>
<p>Usage of <code>IsTrue</code> and <code>IsFalse</code> keywords in repository query methods.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="new-in-2.0.0"><a class="anchor" href="index.html#new-in-2.0.0"></a>6.5. New in Spring Data Redis 2.0</h3>
<div class="ulist">
<ul>
<li>
<p>Upgrade to Java 8.</p>
</li>
<li>
<p>Upgrade to Lettuce 5.0.</p>
</li>
<li>
<p>Removed support for SRP and JRedis drivers.</p>
</li>
<li>
<p><a href="index.html#redis:reactive">Reactive connection support using Lettuce</a>.</p>
</li>
<li>
<p>Introduce Redis feature-specific interfaces for <code>RedisConnection</code>.</p>
</li>
<li>
<p>Improved <code>RedisConnectionFactory</code> configuration with <code>JedisClientConfiguration</code> and <code>LettuceClientConfiguration</code>.</p>
</li>
<li>
<p>Revised <code>RedisCache</code> implementation.</p>
</li>
<li>
<p>Add <code>SPOP</code> with count command for Redis 3.2.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="new-in-1.8.0"><a class="anchor" href="index.html#new-in-1.8.0"></a>6.6. New in Spring Data Redis 1.8</h3>
<div class="ulist">
<ul>
<li>
<p>Upgrade to Jedis 2.9.</p>
</li>
<li>
<p>Upgrade to <code>Lettuce</code> 4.2 (Note: Lettuce 4.2 requires Java 8).</p>
</li>
<li>
<p>Support for Redis <a href="https://redis.io/commands#geo">GEO</a> commands.</p>
</li>
<li>
<p>Support for Geospatial Indexes using Spring Data Repository abstractions (see <a href="index.html#redis.repositories.indexes.geospatial">Geospatial Index</a>).</p>
</li>
<li>
<p><code>MappingRedisConverter</code>-based <code>HashMapper</code> implementation (see <a href="index.html#redis.hashmappers.root">Hash mapping</a>).</p>
</li>
<li>
<p>Support for <code>PartialUpdate</code> in repositories (see <a href="index.html#redis.repositories.partial-updates">Persisting Partial Updates</a>).</p>
</li>
<li>
<p>SSL support for connections to Redis cluster.</p>
</li>
<li>
<p>Support for <code>client name</code> through <code>ConnectionFactory</code> when using Jedis.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="new-in-1.7.0"><a class="anchor" href="index.html#new-in-1.7.0"></a>6.7. New in Spring Data Redis 1.7</h3>
<div class="ulist">
<ul>
<li>
<p>Support for <a href="https://redis.io/topics/cluster-tutorial">RedisCluster</a>.</p>
</li>
<li>
<p>Support for Spring Data Repository abstractions (see <a href="index.html#redis.repositories">Redis Repositories</a>).</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="new-in-1-6-0"><a class="anchor" href="index.html#new-in-1-6-0"></a>6.8. New in Spring Data Redis 1.6</h3>
<div class="ulist">
<ul>
<li>
<p>The <code>Lettuce</code> Redis driver switched from <a href="https://github.com/wg/lettuce">wg/lettuce</a> to <a href="https://github.com/mp911de/lettuce">mp911de/lettuce</a>.</p>
</li>
<li>
<p>Support for <code>ZRANGEBYLEX</code>.</p>
</li>
<li>
<p>Enhanced range operations for <code>ZSET</code>, including <code>+inf</code> / <code>-inf</code>.</p>
</li>
<li>
<p>Performance improvements in <code>RedisCache</code>, now releasing connections earlier.</p>
</li>
<li>
<p>Generic Jackson2 <code>RedisSerializer</code> making use of Jackson&#8217;s polymorphic deserialization.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="new-in-1-5-0"><a class="anchor" href="index.html#new-in-1-5-0"></a>6.9. New in Spring Data Redis 1.5</h3>
<div class="ulist">
<ul>
<li>
<p>Add support for Redis HyperLogLog commands: <code>PFADD</code>, <code>PFCOUNT</code>, and <code>PFMERGE</code>.</p>
</li>
<li>
<p>Configurable <code>JavaType</code> lookup for Jackson-based <code>RedisSerializers</code>.</p>
</li>
<li>
<p><code>PropertySource</code>-based configuration for connecting to Redis Sentinel (see: <a href="index.html#redis:sentinel">Redis Sentinel Support</a>).</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="dependencies"><a class="anchor" href="index.html#dependencies"></a>7. Dependencies</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Due to the different inception dates of individual Spring Data modules, most of them carry different major and minor version numbers. The easiest way to find compatible ones is to rely on the Spring Data Release Train BOM that we ship with the compatible versions defined. In a Maven project, you would declare this dependency in the <code>&lt;dependencyManagement /&gt;</code> section of your POM as follows:</p>
</div>
<div class="exampleblock">
<div class="title">Example 1. Using the Spring Data release train BOM</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="xml" class="language-xml hljs">&lt;dependencyManagement&gt;
  &lt;dependencies&gt;
    &lt;dependency&gt;
      &lt;groupId&gt;org.springframework.data&lt;/groupId&gt;
      &lt;artifactId&gt;spring-data-bom&lt;/artifactId&gt;
      &lt;version&gt;2020.0.1&lt;/version&gt;
      &lt;scope&gt;import&lt;/scope&gt;
      &lt;type&gt;pom&lt;/type&gt;
    &lt;/dependency&gt;
  &lt;/dependencies&gt;
&lt;/dependencyManagement&gt;</code></pre>
</div>
</div>
</div>
</div>
<div id="dependencies.train-version" class="paragraph">
<p>The current release train version is <code>2020.0.1</code>. The train version uses <a href="https://calver.org/">calver</a> with the pattern <code>YYYY.MINOR.MICRO</code>.
The version name follows <code>${calver}</code> for GA releases and service releases and the following pattern for all other versions: <code>${calver}-${modifier}</code>, where <code>modifier</code> can be one of the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>SNAPSHOT</code>: Current snapshots</p>
</li>
<li>
<p><code>M1</code>, <code>M2</code>, and so on: Milestones</p>
</li>
<li>
<p><code>RC1</code>, <code>RC2</code>, and so on: Release candidates</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You can find a working example of using the BOMs in our <a href="https://github.com/spring-projects/spring-data-examples/tree/master/bom">Spring Data examples repository</a>. With that in place, you can declare the Spring Data modules you would like to use without a version in the <code>&lt;dependencies /&gt;</code> block, as follows:</p>
</div>
<div class="exampleblock">
<div class="title">Example 2. Declaring a dependency to a Spring Data module</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="xml" class="language-xml hljs">&lt;dependencies&gt;
  &lt;dependency&gt;
    &lt;groupId&gt;org.springframework.data&lt;/groupId&gt;
    &lt;artifactId&gt;spring-data-jpa&lt;/artifactId&gt;
  &lt;/dependency&gt;
&lt;dependencies&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="dependencies.spring-boot"><a class="anchor" href="index.html#dependencies.spring-boot"></a>7.1. Dependency Management with Spring Boot</h3>
<div class="paragraph">
<p>Spring Boot selects a recent version of Spring Data modules for you. If you still want to upgrade to a newer version, set
the <code>spring-data-releasetrain.version</code> property to the <a href="index.html#dependencies.train-version">train version and iteration</a> you would like to use.</p>
</div>
</div>
<div class="sect2">
<h3 id="dependencies.spring-framework"><a class="anchor" href="index.html#dependencies.spring-framework"></a>7.2. Spring Framework</h3>
<div class="paragraph">
<p>The current version of Spring Data modules require Spring Framework 5.3.1 or better. The modules might also work with an older bugfix version of that minor version. However, using the most recent version within that generation is highly recommended.</p>
</div>
</div>
</div>
</div>
<h1 id="reference" class="sect0"><a class="anchor" href="index.html#reference"></a>Reference Documentation</h1>
<div class="sect1">
<h2 id="introduction"><a class="anchor" href="index.html#introduction"></a>8. Introduction</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="introduction.structure"><a class="anchor" href="index.html#introduction.structure"></a>8.1. Document Structure</h3>
<div class="paragraph">
<p>This part of the reference documentation explains the core functionality offered by Spring Data Redis.
It explains Key-Value module concepts and semantics and the syntax for various stores namespaces.
For an introduction to key-value stores, Spring, or Spring Data examples, see <a href="index.html#get-started:first-steps:nosql">Learning NoSQL and Key Value Stores</a>.
This documentation refers only to Spring Data Redis Support and assumes the user is familiar with key-value storage and Spring concepts.</p>
</div>
<div class="paragraph">
<p>&#8220;<a href="index.html#redis">Redis support</a>&#8221; introduces the Redis module feature set.</p>
</div>
<div class="paragraph">
<p>&#8220;<a href="index.html#redis.repositories">Redis Repositories</a>&#8221; introduces the repository support for Redis.</p>
</div>
<div class="paragraph">
<p>This document is the reference guide for Spring Data Redis (SDR) Support.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="why-spring-redis"><a class="anchor" href="index.html#why-spring-redis"></a>9. Why Spring Data Redis?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The Spring Framework is the leading full-stack Java/JEE application framework. It provides a lightweight container and a non-invasive programming model enabled by the use of dependency injection, AOP, and portable service abstractions.</p>
</div>
<div class="paragraph">
<p><a href="https://en.wikipedia.org/wiki/NoSQL">NoSQL</a> storage systems provide an alternative to classical RDBMS for horizontal scalability and speed. In terms of implementation, key-value stores represent one of the largest (and oldest) members in the NoSQL space.</p>
</div>
<div class="paragraph">
<p>The Spring Data Redis (SDR) framework makes it easy to write Spring applications that use the Redis key-value store by eliminating the redundant tasks and boilerplate code required for interacting with the store through Spring&#8217;s excellent infrastructure support.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="redis"><a class="anchor" href="index.html#redis"></a>10. Redis support</h2>
<div class="sectionbody">
<div class="paragraph">
<p>One of the key-value stores supported by Spring Data is <a href="https://redis.io">Redis</a>. To quote the Redis project home page:</p>
</div>
<div class="quoteblock">
<blockquote>
Redis is an advanced key-value store. It is similar to memcached but the dataset is not volatile, and values can be strings, exactly like in memcached, but also lists, sets, and ordered sets. All this data types can be manipulated with atomic operations to push/pop elements, add/remove elements, perform server side union, intersection, difference between sets, and so forth. Redis supports different kind of sorting abilities.
</blockquote>
</div>
<div class="paragraph">
<p>Spring Data Redis provides easy configuration and access to Redis from Spring applications. It offers both low-level and high-level abstractions for interacting with the store, freeing the user from infrastructural concerns.</p>
</div>
<div class="sect2">
<h3 id="redis:setup"><a class="anchor" href="index.html#redis:setup"></a>10.1. Getting Started</h3>
<div class="paragraph">
<p>An easy way to setting up a working environment is to create a Spring-based project in <a href="https://spring.io/tools/sts">STS</a>.</p>
</div>
<div class="paragraph">
<p>First, you need to set up a running Redis server.</p>
</div>
<div class="paragraph">
<p>To create a Spring project in STS:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Go to File &#8594; New &#8594; Spring Template Project &#8594; Simple Spring Utility Project, and press Yes when prompted. Then enter a project and a package name, such as <code>org.spring.redis.example</code>.
.Add the following to the pom.xml files <code>dependencies</code> element:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="xml" class="language-xml hljs">&lt;dependencies&gt;

  &lt;!-- other dependency elements omitted --&gt;

  &lt;dependency&gt;
    &lt;groupId&gt;org.springframework.data&lt;/groupId&gt;
    &lt;artifactId&gt;spring-data-redis&lt;/artifactId&gt;
    &lt;version&gt;2.4.1&lt;/version&gt;
  &lt;/dependency&gt;

&lt;/dependencies&gt;</code></pre>
</div>
</div>
</li>
<li>
<p>Change the version of Spring in the pom.xml to be</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="xml" class="language-xml hljs">&lt;spring.framework.version&gt;5.3.1&lt;/spring.framework.version&gt;</code></pre>
</div>
</div>
</li>
<li>
<p>Add the following location of the Spring Milestone repository for Maven to your <code>pom.xml</code> such that it is at the same level of your <code>&lt;dependencies/&gt;</code> element:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="xml" class="language-xml hljs">&lt;repositories&gt;
  &lt;repository&gt;
    &lt;id&gt;spring-milestone&lt;/id&gt;
    &lt;name&gt;Spring Maven MILESTONE Repository&lt;/name&gt;
    &lt;url&gt;https://repo.spring.io/libs-milestone&lt;/url&gt;
  &lt;/repository&gt;
&lt;/repositories&gt;</code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>The repository is also <a href="https://repo.spring.io/milestone/org/springframework/data/">browseable here</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="redis:requirements"><a class="anchor" href="index.html#redis:requirements"></a>10.2. Redis Requirements</h3>
<div class="paragraph">
<p>Spring Redis requires Redis 2.6 or above and Spring Data Redis integrates with <a href="https://github.com/lettuce-io/lettuce-core">Lettuce</a> and <a href="https://github.com/xetorthio/jedis">Jedis</a>, two popular open-source Java libraries for Redis.</p>
</div>
</div>
<div class="sect2">
<h3 id="redis:architecture"><a class="anchor" href="index.html#redis:architecture"></a>10.3. Redis Support High-level View</h3>
<div class="paragraph">
<p>The Redis support provides several components. For most tasks, the high-level abstractions and support services are the best choice. Note that, at any point, you can move between layers. For example, you can get a low-level connection (or even the native library) to communicate directly with Redis.</p>
</div>
</div>
<div class="sect2">
<h3 id="redis:connectors"><a class="anchor" href="index.html#redis:connectors"></a>10.4. Connecting to Redis</h3>
<div class="paragraph">
<p>One of the first tasks when using Redis and Spring is to connect to the store through the IoC container. To do that, a Java connector (or binding) is required. No matter the library you choose, you need to use only one set of Spring Data Redis APIs (which behaves consistently across all connectors): the <code>org.springframework.data.redis.connection</code> package and its <code>RedisConnection</code> and <code>RedisConnectionFactory</code> interfaces for working with and retrieving active connections to Redis.</p>
</div>
<div class="sect3">
<h4 id="redis:connectors:connection"><a class="anchor" href="index.html#redis:connectors:connection"></a>10.4.1. RedisConnection and RedisConnectionFactory</h4>
<div class="paragraph">
<p><code>RedisConnection</code> provides the core building block for Redis communication, as it handles the communication with the Redis back end. It also automatically translates the underlying connecting library exceptions to Spring&#8217;s consistent DAO exception <a href="https://docs.spring.io/spring/docs/5.3.1/spring-framework-reference/data-access.html#dao-exceptions">hierarchy</a> so that you can switch the connectors without any code changes, as the operation semantics remain the same.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
For the corner cases where the native library API is required, <code>RedisConnection</code> provides a dedicated method (<code>getNativeConnection</code>) that returns the raw, underlying object used for communication.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Active <code>RedisConnection</code> objects are created through <code>RedisConnectionFactory</code>. In addition, the factory acts as <code>PersistenceExceptionTranslator</code> objects, meaning that, once declared, they let you do transparent exception translation. For example, you can do exception translation through the use of the <code>@Repository</code> annotation and AOP. For more information, see the dedicated <a href="https://docs.spring.io/spring/docs/5.3.1/spring-framework-reference/data-access.html#orm-exception-translation">section</a> in the Spring Framework documentation.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Depending on the underlying configuration, the factory can return a new connection or an existing connection (when a pool or shared native connection is used).
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The easiest way to work with a <code>RedisConnectionFactory</code> is to configure the appropriate connector through the IoC container and inject it into the using class.</p>
</div>
<div class="paragraph">
<p>Unfortunately, currently, not all connectors support all Redis features. When invoking a method on the Connection API that is unsupported by the underlying library, an <code>UnsupportedOperationException</code> is thrown. The following overview explains features that are supported by the individual Redis connectors:</p>
</div>
<table id="redis:connectors:overview" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. Feature Availability across Redis Connectors</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Supported Feature</th>
<th class="tableblock halign-left valign-top">Lettuce</th>
<th class="tableblock halign-left valign-top">Jedis</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Standalone Connections</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">X</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">X</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="index.html#redis:write-to-master-read-from-replica">Master/Replica Connections</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">X</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="index.html#redis:sentinel">Redis Sentinel</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Master Lookup, Sentinel Authentication, Replica Reads</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Master Lookup</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="index.html#cluster">Redis Cluster</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cluster Connections, Cluster Node Connections, Replica Reads</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cluster Connections, Cluster Node Connections</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Transport Channels</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCP, OS-native TCP (epoll, kqueue), Unix Domain Sockets</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCP</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Connection Pooling</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">X (using <code>commons-pool2</code>)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">X (using <code>commons-pool2</code>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Other Connection Features</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Singleton-connection sharing for non-blocking commands</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>JedisShardInfo</code> support</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SSL Support</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">X</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">X</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="index.html#pubsub">Pub/Sub</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">X</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">X</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="index.html#pipeline">Pipelining</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">X</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">X</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="index.html#tx">Transactions</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">X</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">X</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Datatype support</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Key, String, List, Set, Sorted Set, Hash, Server, Stream, Scripting, Geo, HyperLogLog</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Key, String, List, Set, Sorted Set, Hash, Server, Scripting, Geo, HyperLogLog</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="index.html#redis:reactive">Reactive (non-blocking) API</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">X</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="redis:connectors:lettuce"><a class="anchor" href="index.html#redis:connectors:lettuce"></a>10.4.2. Configuring the Lettuce Connector</h4>
<div class="paragraph">
<p><a href="https://github.com/lettuce-io/lettuce-core">Lettuce</a> is a <a href="https://netty.io/">Netty</a>-based open-source connector supported by Spring Data Redis through the <code>org.springframework.data.redis.connection.lettuce</code> package.</p>
</div>
<div class="listingblock">
<div class="title">Add the following to the pom.xml files <code>dependencies</code> element:</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="xml" class="language-xml hljs">&lt;dependencies&gt;

  &lt;!-- other dependency elements omitted --&gt;

  &lt;dependency&gt;
    &lt;groupId&gt;io.lettuce&lt;/groupId&gt;
    &lt;artifactId&gt;lettuce-core&lt;/artifactId&gt;
    &lt;version&gt;6.0.1.RELEASE&lt;/version&gt;
  &lt;/dependency&gt;

&lt;/dependencies&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following example shows how to create a new Lettuce connection factory:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">@Configuration
class AppConfig {

  @Bean
  public LettuceConnectionFactory redisConnectionFactory() {

    return new LettuceConnectionFactory(new RedisStandaloneConfiguration("server", 6379));
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>There are also a few Lettuce-specific connection parameters that can be tweaked. By default, all <code>LettuceConnection</code> instances created by the <code>LettuceConnectionFactory</code> share the same thread-safe native connection for all non-blocking and non-transactional operations. To use a dedicated connection each time, set <code>shareNativeConnection</code> to <code>false</code>. <code>LettuceConnectionFactory</code> can also be configured to use a <code>LettucePool</code> for pooling blocking and transactional connections or all connections if <code>shareNativeConnection</code> is set to <code>false</code>.</p>
</div>
<div class="paragraph">
<p>Lettuce integrates with Netty&#8217;s <a href="https://netty.io/wiki/native-transports.html">native transports</a>, letting you use Unix domain sockets to communicate with Redis. Make sure to include the appropriate native transport dependencies that match your runtime environment. The following example shows how to create a Lettuce Connection factory for a Unix domain socket at <code>/var/run/redis.sock</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">@Configuration
class AppConfig {

  @Bean
  public LettuceConnectionFactory redisConnectionFactory() {

    return new LettuceConnectionFactory(new RedisSocketConfiguration("/var/run/redis.sock"));
  }
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Netty currently supports the epoll (Linux) and kqueue (BSD/macOS) interfaces for OS-native transport.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="redis:connectors:jedis"><a class="anchor" href="index.html#redis:connectors:jedis"></a>10.4.3. Configuring the Jedis Connector</h4>
<div class="paragraph">
<p><a href="https://github.com/xetorthio/jedis">Jedis</a> is a community-driven connector supported by the Spring Data Redis module through the <code>org.springframework.data.redis.connection.jedis</code> package.</p>
</div>
<div class="listingblock">
<div class="title">Add the following to the pom.xml files <code>dependencies</code> element:</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="xml" class="language-xml hljs">&lt;dependencies&gt;

  &lt;!-- other dependency elements omitted --&gt;

  &lt;dependency&gt;
    &lt;groupId&gt;redis.clients&lt;/groupId&gt;
    &lt;artifactId&gt;jedis&lt;/artifactId&gt;
    &lt;version&gt;3.3.0&lt;/version&gt;
  &lt;/dependency&gt;

&lt;/dependencies&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>In its simplest form, the Jedis configuration looks as follow:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">@Configuration
class AppConfig {

  @Bean
  public JedisConnectionFactory redisConnectionFactory() {
    return new JedisConnectionFactory();
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>For production use, however, you might want to tweak settings such as the host or password, as shown in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">@Configuration
class RedisConfiguration {

  @Bean
  public JedisConnectionFactory redisConnectionFactory() {

    RedisStandaloneConfiguration config = new RedisStandaloneConfiguration("server", 6379);
    return new JedisConnectionFactory(config);
  }
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="redis:write-to-master-read-from-replica"><a class="anchor" href="index.html#redis:write-to-master-read-from-replica"></a>10.4.4. Write to Master, Read from Replica</h4>
<div class="paragraph">
<p>The Redis Master/Replica setup&#8201;&#8212;&#8201;without automatic failover (for automatic failover see: <a href="index.html#redis:sentinel">Sentinel</a>)&#8201;&#8212;&#8201;not only allows data to be safely stored at more nodes. It also allows, by using <a href="index.html#redis:connectors:lettuce">Lettuce</a>, reading data from replicas while pushing writes to the master. You can set the read/write strategy to be used by using <code>LettuceClientConfiguration</code>, as shown in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">@Configuration
class WriteToMasterReadFromReplicaConfiguration {

  @Bean
  public LettuceConnectionFactory redisConnectionFactory() {

    LettuceClientConfiguration clientConfig = LettuceClientConfiguration.builder()
      .readFrom(SLAVE_PREFERRED)
      .build();

    RedisStandaloneConfiguration serverConfig = new RedisStandaloneConfiguration("server", 6379);

    return new LettuceConnectionFactory(serverConfig, clientConfig);
  }
}</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
For environments reporting non-public addresses through the <code>INFO</code> command (for example, when using AWS), use <code>RedisStaticMasterReplicaConfiguration</code> instead of <code>RedisStandaloneConfiguration</code>. Please note that <code>RedisStaticMasterReplicaConfiguration</code> does not support Pub/Sub because of missing Pub/Sub message propagation across individual servers.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="redis:sentinel"><a class="anchor" href="index.html#redis:sentinel"></a>10.5. Redis Sentinel Support</h3>
<div class="paragraph">
<p>For dealing with high-availability Redis, Spring Data Redis has support for <a href="https://redis.io/topics/sentinel">Redis Sentinel</a>, using <code>RedisSentinelConfiguration</code>, as shown in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">/**
 * Jedis
 */
@Bean
public RedisConnectionFactory jedisConnectionFactory() {
  RedisSentinelConfiguration sentinelConfig = new RedisSentinelConfiguration()
  .master("mymaster")
  .sentinel("127.0.0.1", 26379)
  .sentinel("127.0.0.1", 26380);
  return new JedisConnectionFactory(sentinelConfig);
}

/**
 * Lettuce
 */
@Bean
public RedisConnectionFactory lettuceConnectionFactory() {
  RedisSentinelConfiguration sentinelConfig = new RedisSentinelConfiguration()
  .master("mymaster")
  .sentinel("127.0.0.1", 26379)
  .sentinel("127.0.0.1", 26380);
  return new LettuceConnectionFactory(sentinelConfig);
}</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p><code>RedisSentinelConfiguration</code> can also be defined with a <code>PropertySource</code>, which lets you set the following properties:</p>
</div>
<div class="ulist">
<div class="title">Configuration Properties</div>
<ul>
<li>
<p><code>spring.redis.sentinel.master</code>: name of the master node.</p>
</li>
<li>
<p><code>spring.redis.sentinel.nodes</code>: Comma delimited list of host:port pairs.</p>
</li>
<li>
<p><code>spring.redis.sentinel.password</code>: The password to apply when authenticating with Redis Sentinel</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Sometimes, direct interaction with one of the Sentinels is required. Using <code>RedisConnectionFactory.getSentinelConnection()</code> or <code>RedisConnection.getSentinelCommands()</code> gives you access to the first active Sentinel configured.</p>
</div>
</div>
<div class="sect2">
<h3 id="redis:template"><a class="anchor" href="index.html#redis:template"></a>10.6. Working with Objects through RedisTemplate</h3>
<div class="paragraph">
<p>Most users are likely to use <code>RedisTemplate</code> and its corresponding package, <code>org.springframework.data.redis.core</code>. The template is, in fact, the central class of the Redis module, due to its rich feature set. The template offers a high-level abstraction for Redis interactions. While <code>RedisConnection</code> offers low-level methods that accept and return binary values (<code>byte</code> arrays), the template takes care of serialization and connection management, freeing the user from dealing with such details.</p>
</div>
<div class="paragraph">
<p>Moreover, the template provides operations views (following the grouping from the Redis command <a href="https://redis.io/commands">reference</a>) that offer rich, generified interfaces for working against a certain type or certain key (through the <code>KeyBound</code> interfaces) as described in the following table:</p>
</div>
<table class="tableblock frame-all grid-all" style="width: 80%;">
<caption class="title">Table 2. Operational views</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 66.6667%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Interface</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top" colspan="2"><p class="tableblock"><em>Key Type Operations</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>GeoOperations</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Redis geospatial operations, such as <code>GEOADD</code>, <code>GEORADIUS</code>,&#8230;&#8203;</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>HashOperations</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Redis hash operations</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>HyperLogLogOperations</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Redis HyperLogLog operations, such as <code>PFADD</code>, <code>PFCOUNT</code>,&#8230;&#8203;</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ListOperations</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Redis list operations</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SetOperations</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Redis set operations</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ValueOperations</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Redis string (or value) operations</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ZSetOperations</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Redis zset (or sorted set) operations</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" colspan="2"><p class="tableblock"><em>Key Bound Operations</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>BoundGeoOperations</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Redis key bound geospatial operations</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>BoundHashOperations</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Redis hash key bound operations</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>BoundKeyOperations</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Redis key bound operations</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>BoundListOperations</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Redis list key bound operations</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>BoundSetOperations</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Redis set key bound operations</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>BoundValueOperations</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Redis string (or value) key bound operations</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>BoundZSetOperations</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Redis zset (or sorted set) key bound operations</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Once configured, the template is thread-safe and can be reused across multiple instances.</p>
</div>
<div class="paragraph">
<p><code>RedisTemplate</code> uses a Java-based serializer for most of its operations. This means that any object written or read by the template is serialized and deserialized through Java. You can change the serialization mechanism on the template, and the Redis module offers several implementations, which are available in the <code>org.springframework.data.redis.serializer</code> package. See <a href="index.html#redis:serializer">Serializers</a> for more information. You can also set any of the serializers to null and use RedisTemplate with raw byte arrays by setting the <code>enableDefaultSerializer</code> property to <code>false</code>. Note that the template requires all keys to be non-null. However, values can be null as long as the underlying serializer accepts them. Read the Javadoc of each serializer for more information.</p>
</div>
<div class="paragraph">
<p>For cases where you need a certain template view, declare the view as a dependency and inject the template. The container automatically performs the conversion, eliminating the <code>opsFor[X]</code> calls, as shown in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="xml" class="language-xml hljs">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;beans xmlns="http://www.springframework.org/schema/beans"
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xmlns:p="http://www.springframework.org/schema/p"
  xsi:schemaLocation="http://www.springframework.org/schema/beans https://www.springframework.org/schema/beans/spring-beans.xsd"&gt;

  &lt;bean id="jedisConnectionFactory" class="org.springframework.data.redis.connection.jedis.JedisConnectionFactory" p:use-pool="true"/&gt;
  &lt;!-- redis template definition --&gt;
  &lt;bean id="redisTemplate" class="org.springframework.data.redis.core.RedisTemplate" p:connection-factory-ref="jedisConnectionFactory"/&gt;
  ...

&lt;/beans&gt;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">public class Example {

  // inject the actual template
  @Autowired
  private RedisTemplate&lt;String, String&gt; template;

  // inject the template as ListOperations
  @Resource(name="redisTemplate")
  private ListOperations&lt;String, String&gt; listOps;

  public void addLink(String userId, URL url) {
    listOps.leftPush(userId, url.toExternalForm());
  }
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="redis:string"><a class="anchor" href="index.html#redis:string"></a>10.7. String-focused Convenience Classes</h3>
<div class="paragraph">
<p>Since it is quite common for the keys and values stored in Redis to be <code>java.lang.String</code>, the Redis modules provides two extensions to <code>RedisConnection</code> and <code>RedisTemplate</code>, respectively the <code>StringRedisConnection</code> (and its <code>DefaultStringRedisConnection</code> implementation) and <code>StringRedisTemplate</code> as a convenient one-stop solution for intensive String operations. In addition to being bound to <code>String</code> keys, the template and the connection use the <code>StringRedisSerializer</code> underneath, which means the stored keys and values are human-readable (assuming the same encoding is used both in Redis and your code). The following listings show an example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="xml" class="language-xml hljs">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;beans xmlns="http://www.springframework.org/schema/beans"
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xmlns:p="http://www.springframework.org/schema/p"
  xsi:schemaLocation="http://www.springframework.org/schema/beans https://www.springframework.org/schema/beans/spring-beans.xsd"&gt;

  &lt;bean id="jedisConnectionFactory" class="org.springframework.data.redis.connection.jedis.JedisConnectionFactory" p:use-pool="true"/&gt;

  &lt;bean id="stringRedisTemplate" class="org.springframework.data.redis.core.StringRedisTemplate" p:connection-factory-ref="jedisConnectionFactory"/&gt;
  ...
&lt;/beans&gt;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">public class Example {

  @Autowired
  private StringRedisTemplate redisTemplate;

  public void addLink(String userId, URL url) {
    redisTemplate.opsForList().leftPush(userId, url.toExternalForm());
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>As with the other Spring templates, <code>RedisTemplate</code> and <code>StringRedisTemplate</code> let you talk directly to Redis through the <code>RedisCallback</code> interface. This feature gives complete control to you, as it talks directly to the <code>RedisConnection</code>. Note that the callback receives an instance of <code>StringRedisConnection</code> when a <code>StringRedisTemplate</code> is used. The following example shows how to use the <code>RedisCallback</code> interface:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">public void useCallback() {

  redisTemplate.execute(new RedisCallback&lt;Object&gt;() {
    public Object doInRedis(RedisConnection connection) throws DataAccessException {
      Long size = connection.dbSize();
      // Can cast to StringRedisConnection if using a StringRedisTemplate
      ((StringRedisConnection)connection).set("key", "value");
    }
   });
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="redis:serializer"><a class="anchor" href="index.html#redis:serializer"></a>10.8. Serializers</h3>
<div class="paragraph">
<p>From the framework perspective, the data stored in Redis is only bytes. While Redis itself supports various types, for the most part, these refer to the way the data is stored rather than what it represents. It is up to the user to decide whether the information gets translated into strings or any other objects.</p>
</div>
<div class="paragraph">
<p>In Spring Data, the conversion between the user (custom) types and raw data (and vice-versa) is handled Redis in the <code>org.springframework.data.redis.serializer</code> package.</p>
</div>
<div class="paragraph">
<p>This package contains two types of serializers that, as the name implies, take care of the serialization process:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Two-way serializers based on <code>RedisSerializer</code>.</p>
</li>
<li>
<p>Element readers and writers that use <code>RedisElementReader</code> and <code>RedisElementWriter</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The main difference between these variants is that <code>RedisSerializer</code> primarily serializes to <code>byte[]</code> while readers and writers use <code>ByteBuffer</code>.</p>
</div>
<div class="paragraph">
<p>Multiple implementations are available (including two that have been already mentioned in this documentation):</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>JdkSerializationRedisSerializer</code>, which is used by default for <code>RedisCache</code> and <code>RedisTemplate</code>.</p>
</li>
<li>
<p>the <code>StringRedisSerializer</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>However one can use <code>OxmSerializer</code> for Object/XML mapping through Spring <a href="https://docs.spring.io/spring/docs/5.3.1/spring-framework-reference/data-access.html#oxm">OXM</a> support or <code>Jackson2JsonRedisSerializer</code> or <code>GenericJackson2JsonRedisSerializer</code> for storing data in <a href="https://en.wikipedia.org/wiki/JSON">JSON</a> format.</p>
</div>
<div class="paragraph">
<p>Do note that the storage format is not limited only to values. It can be used for keys, values, or hashes without any restrictions.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>By default, <code>RedisCache</code> and <code>RedisTemplate</code> are configured to use Java native serialization. Java native serialization is known for allowing the running of remote code caused by payloads that exploit vulnerable libraries and classes injecting unverified bytecode. Manipulated input could lead to unwanted code being run in the application during the deserialization step. As a consequence, do not use serialization in untrusted environments. In general, we strongly recommend any other message format (such as JSON) instead.</p>
</div>
<div class="paragraph">
<p>If you are concerned about security vulnerabilities due to Java serialization, consider the general-purpose serialization filter mechanism at the core JVM level, originally developed for JDK 9 but backported to JDK 8, 7, and 6:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://blogs.oracle.com/java-platform-group/entry/incoming_filter_serialization_data_a">Filter Incoming Serialization Data</a>.</p>
</li>
<li>
<p><a href="https://openjdk.java.net/jeps/290">JEP 290</a>.</p>
</li>
<li>
<p><a href="https://www.owasp.org/index.php/Deserialization_of_untrusted_data">OWASP: Deserialization of untrusted data</a>.</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="redis.hashmappers.root"><a class="anchor" href="index.html#redis.hashmappers.root"></a>10.9. Hash mapping</h3>
<div class="paragraph">
<p>Data can be stored by using various data structures within Redis. <code>Jackson2JsonRedisSerializer</code> can convert objects in <a href="https://en.wikipedia.org/wiki/JSON">JSON</a> format. Ideally, JSON can be stored as a value by using plain keys. You can achieve a more sophisticated mapping of structured objects by using Redis hashes. Spring Data Redis offers various strategies for mapping data to hashes (depending on the use case):</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Direct mapping, by using <code>HashOperations</code> and a <a href="index.html#redis:serializer">serializer</a></p>
</li>
<li>
<p>Using <a href="index.html#redis.repositories">Redis Repositories</a></p>
</li>
<li>
<p>Using <code>HashMapper</code> and <code>HashOperations</code></p>
</li>
</ul>
</div>
<div class="sect3">
<h4>10.9.1. Hash Mappers</h4>
<div class="paragraph">
<p>Hash mappers are converters of map objects to a <code>Map&lt;K, V&gt;</code> and back. <code>HashMapper</code> is intended for using with Redis Hashes.</p>
</div>
<div class="paragraph">
<p>Multiple implementations are available:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>BeanUtilsHashMapper</code> using Spring&#8217;s <a href="../../../../../../spring/docs/5.3.1/javadoc-api/org/springframework/beans/BeanUtils.html">BeanUtils</a>.</p>
</li>
<li>
<p><code>ObjectHashMapper</code> using <a href="index.html#redis.repositories.mapping">Object-to-Hash Mapping</a>.</p>
</li>
<li>
<p><a href="index.html#redis.hashmappers.jackson2"><code>Jackson2HashMapper</code></a> using <a href="https://github.com/FasterXML/jackson">FasterXML Jackson</a>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The following example shows one way to implement hash mapping:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">public class Person {
  String firstname;
  String lastname;

  // …
}

public class HashMapping {

  @Autowired
  HashOperations&lt;String, byte[], byte[]&gt; hashOperations;

  HashMapper&lt;Object, byte[], byte[]&gt; mapper = new ObjectHashMapper();

  public void writeHash(String key, Person person) {

    Map&lt;byte[], byte[]&gt; mappedHash = mapper.toHash(person);
    hashOperations.putAll(key, mappedHash);
  }

  public Person loadHash(String key) {

    Map&lt;byte[], byte[]&gt; loadedHash = hashOperations.entries("key");
    return (Person) mapper.fromHash(loadedHash);
  }
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="redis.hashmappers.jackson2"><a class="anchor" href="index.html#redis.hashmappers.jackson2"></a>10.9.2. Jackson2HashMapper</h4>
<div class="paragraph">
<p><code>Jackson2HashMapper</code> provides Redis Hash mapping for domain objects by using <a href="https://github.com/FasterXML/jackson">FasterXML Jackson</a>.
<code>Jackson2HashMapper</code> can map top-level properties as Hash field names and, optionally, flatten the structure.
Simple types map to simple values. Complex types (nested objects, collections, maps, and so on) are represented as nested JSON.</p>
</div>
<div class="paragraph">
<p>Flattening creates individual hash entries for all nested properties and resolves complex types into simple types, as far as possible.</p>
</div>
<div class="paragraph">
<p>Consider the following class and the data structure it contains:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">public class Person {
  String firstname;
  String lastname;
  Address address;
  Date date;
  LocalDateTime localDateTime;
}

public class Address {
  String city;
  String country;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following table shows how the data in the preceding class would appear in normal mapping:</p>
</div>
<table class="tableblock frame-all grid-all" style="width: 80%;">
<caption class="title">Table 3. Normal Mapping</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 66.6667%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Hash Field</th>
<th class="tableblock halign-left valign-top">Value</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">firstname</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Jon</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">lastname</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Snow</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">address</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{ "city" : "Castle Black", "country" : "The North" }</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">date</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>1561543964015</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">localDateTime</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>2018-01-02T12:13:14</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The following table shows how the data in the preceding class would appear in flat mapping:</p>
</div>
<table class="tableblock frame-all grid-all" style="width: 80%;">
<caption class="title">Table 4. Flat Mapping</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 66.6667%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Hash Field</th>
<th class="tableblock halign-left valign-top">Value</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">firstname</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Jon</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">lastname</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Snow</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">address.city</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Castle Black</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">address.country</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>The North</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">date</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>1561543964015</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">localDateTime</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>2018-01-02T12:13:14</code></p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Flattening requires all property names to not interfere with the JSON path. Using dots or brackets in map keys or as property names is not supported when you use flattening. The resulting hash cannot be mapped back into an Object.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<code>java.util.Date</code> and <code>java.util.Calendar</code> are represented with milliseconds. JSR-310 Date/Time types are serialized to their <code>toString</code> form if <code>jackson-datatype-jsr310</code> is on the class path.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="pubsub"><a class="anchor" href="index.html#pubsub"></a>10.10. Redis Messaging (Pub/Sub)</h3>
<div class="paragraph">
<p>Spring Data provides dedicated messaging integration for Redis, similar in functionality and naming to the JMS integration in Spring Framework.</p>
</div>
<div class="paragraph">
<p>Redis messaging can be roughly divided into two areas of functionality:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Publication or production of messages</p>
</li>
<li>
<p>Subscription or consumption of messages</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This is an example of the pattern often called Publish/Subscribe (Pub/Sub for short). The <code>RedisTemplate</code> class is used for message production. For asynchronous reception similar to Java EE&#8217;s message-driven bean style, Spring Data provides a dedicated message listener container that is used to create Message-Driven POJOs (MDPs) and, for synchronous reception, the <code>RedisConnection</code> contract.</p>
</div>
<div class="paragraph">
<p>The <code>org.springframework.data.redis.connection</code> and <code>org.springframework.data.redis.listener</code> packages provide the core functionality for Redis messaging.</p>
</div>
<div class="sect3">
<h4 id="redis:pubsub:publish"><a class="anchor" href="index.html#redis:pubsub:publish"></a>10.10.1. Publishing (Sending Messages)</h4>
<div class="paragraph">
<p>To publish a message, you can use, as with the other operations, either the low-level <code>RedisConnection</code> or the high-level <code>RedisTemplate</code>. Both entities offer the <code>publish</code> method, which accepts the message and the destination channel as arguments. While <code>RedisConnection</code> requires raw data (array of bytes), the <code>RedisTemplate</code> lets arbitrary objects be passed in as messages, as shown in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">// send message through connection RedisConnection con = ...
byte[] msg = ...
byte[] channel = ...
con.publish(msg, channel); // send message through RedisTemplate
RedisTemplate template = ...
template.convertAndSend("hello!", "world");</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="redis:pubsub:subscribe"><a class="anchor" href="index.html#redis:pubsub:subscribe"></a>10.10.2. Subscribing (Receiving Messages)</h4>
<div class="paragraph">
<p>On the receiving side, one can subscribe to one or multiple channels either by naming them directly or by using pattern matching. The latter approach is quite useful, as it not only lets multiple subscriptions be created with one command but can also listen on channels not yet created at subscription time (as long as they match the pattern).</p>
</div>
<div class="paragraph">
<p>At the low-level, <code>RedisConnection</code> offers the <code>subscribe</code> and <code>pSubscribe</code> methods that map the Redis commands for subscribing by channel or by pattern, respectively. Note that multiple channels or patterns can be used as arguments. To change the subscription of a connection or query whether it is listening, <code>RedisConnection</code> provides the <code>getSubscription</code> and <code>isSubscribed</code> methods.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Subscription commands in Spring Data Redis are blocking. That is, calling subscribe on a connection causes the current thread to block as it starts waiting for messages. The thread is released only if the subscription is canceled, which happens when another thread invokes <code>unsubscribe</code> or <code>pUnsubscribe</code> on the <strong>same</strong> connection. See &#8220;<a href="index.html#redis:pubsub:subscribe:containers">Message Listener Containers</a>&#8221; (later in this document) for a solution to this problem.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>As mentioned earlier, once subscribed, a connection starts waiting for messages. Only commands that add new subscriptions, modify existing subscriptions, and cancel existing subscriptions are allowed. Invoking anything other than <code>subscribe</code>, <code>pSubscribe</code>, <code>unsubscribe</code>, or <code>pUnsubscribe</code> throws an exception.</p>
</div>
<div class="paragraph">
<p>In order to subscribe to messages, one needs to implement the <code>MessageListener</code> callback. Each time a new message arrives, the callback gets invoked and the user code gets run by the <code>onMessage</code> method. The interface gives access not only to the actual message but also to the channel it has been received through and the pattern (if any) used by the subscription to match the channel. This information lets the callee differentiate between various messages not just by content but also examining additional details.</p>
</div>
<div class="sect4">
<h5 id="redis:pubsub:subscribe:containers"><a class="anchor" href="index.html#redis:pubsub:subscribe:containers"></a>Message Listener Containers</h5>
<div class="paragraph">
<p>Due to its blocking nature, low-level subscription is not attractive, as it requires connection and thread management for every single listener. To alleviate this problem, Spring Data offers <code>RedisMessageListenerContainer</code>, which does all the heavy lifting. If you are familiar with EJB and JMS, you should find the concepts familiar, as it is designed to be as close as possible to the support in Spring Framework and its message-driven POJOs (MDPs).</p>
</div>
<div class="paragraph">
<p><code>RedisMessageListenerContainer</code> acts as a message listener container. It is used to receive messages from a Redis channel and drive the <code>MessageListener</code> instances that are injected into it. The listener container is responsible for all threading of message reception and dispatches into the listener for processing. A message listener container is the intermediary between an MDP and a messaging provider and takes care of registering to receive messages, resource acquisition and release, exception conversion, and the like. This lets you as an application developer write the (possibly complex) business logic associated with receiving a message (and reacting to it) and delegates boilerplate Redis infrastructure concerns to the framework.</p>
</div>
<div class="paragraph">
<p>Furthermore, to minimize the application footprint, <code>RedisMessageListenerContainer</code> lets one connection and one thread be shared by multiple listeners even though they do not share a subscription. Thus, no matter how many listeners or channels an application tracks, the runtime cost remains the same throughout its lifetime. Moreover, the container allows runtime configuration changes so that you can add or remove listeners while an application is running without the need for a restart. Additionally, the container uses a lazy subscription approach, using a <code>RedisConnection</code> only when needed. If all the listeners are unsubscribed, cleanup is automatically performed, and the thread is released.</p>
</div>
<div class="paragraph">
<p>To help with the asynchronous nature of messages, the container requires a <code>java.util.concurrent.Executor</code> (or Spring&#8217;s <code>TaskExecutor</code>) for dispatching the messages. Depending on the load, the number of listeners, or the runtime environment, you should change or tweak the executor to better serve your needs. In particular, in managed environments (such as app servers), it is highly recommended to pick a proper <code>TaskExecutor</code> to take advantage of its runtime.</p>
</div>
</div>
<div class="sect4">
<h5 id="redis:pubsub:subscribe:adapter"><a class="anchor" href="index.html#redis:pubsub:subscribe:adapter"></a>The MessageListenerAdapter</h5>
<div class="paragraph">
<p>The <code>MessageListenerAdapter</code> class is the final component in Spring&#8217;s asynchronous messaging support. In a nutshell, it lets you expose almost <strong>any</strong> class as a MDP (though there are some constraints).</p>
</div>
<div class="paragraph">
<p>Consider the following interface definition:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">public interface MessageDelegate {
  void handleMessage(String message);
  void handleMessage(Map message); void handleMessage(byte[] message);
  void handleMessage(Serializable message);
  // pass the channel/pattern as well
  void handleMessage(Serializable message, String channel);
 }</code></pre>
</div>
</div>
<div class="paragraph">
<p>Notice that, although the interface does not extend the <code>MessageListener</code> interface, it can still be used as a MDP by using the <code>MessageListenerAdapter</code> class. Notice also how the various message handling methods are strongly typed according to the <strong>contents</strong> of the various <code>Message</code> types that they can receive and handle. In addition, the channel or pattern to which a message is sent can be passed in to the method as the second argument of type <code>String</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">public class DefaultMessageDelegate implements MessageDelegate {
  // implementation elided for clarity...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Notice how the above implementation of the <code>MessageDelegate</code> interface (the above <code>DefaultMessageDelegate</code> class) has <strong>no</strong> Redis dependencies at all. It truly is a POJO that we make into an MDP with the following configuration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="xml" class="language-xml hljs">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
 &lt;beans xmlns="http://www.springframework.org/schema/beans"
   xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
   xmlns:redis="http://www.springframework.org/schema/redis"
   xsi:schemaLocation="http://www.springframework.org/schema/beans https://www.springframework.org/schema/beans/spring-beans.xsd
   http://www.springframework.org/schema/redis https://www.springframework.org/schema/redis/spring-redis.xsd"&gt;

&lt;!-- the default ConnectionFactory --&gt;
&lt;redis:listener-container&gt;
  &lt;!-- the method attribute can be skipped as the default method name is "handleMessage" --&gt;
  &lt;redis:listener ref="listener" method="handleMessage" topic="chatroom" /&gt;
&lt;/redis:listener-container&gt;

&lt;bean id="listener" class="redisexample.DefaultMessageDelegate"/&gt;
 ...
&lt;beans&gt;</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The listener topic can be either a channel (for example, <code>topic="chatroom"</code>) or a pattern (for example, <code>topic="*room"</code>)
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The preceding example uses the Redis namespace to declare the message listener container and automatically register the POJOs as listeners. The full blown beans definition follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="xml" class="language-xml hljs">&lt;bean id="messageListener" class="org.springframework.data.redis.listener.adapter.MessageListenerAdapter"&gt;
  &lt;constructor-arg&gt;
    &lt;bean class="redisexample.DefaultMessageDelegate"/&gt;
  &lt;/constructor-arg&gt;
&lt;/bean&gt;

&lt;bean id="redisContainer" class="org.springframework.data.redis.listener.RedisMessageListenerContainer"&gt;
  &lt;property name="connectionFactory" ref="connectionFactory"/&gt;
  &lt;property name="messageListeners"&gt;
    &lt;map&gt;
      &lt;entry key-ref="messageListener"&gt;
        &lt;bean class="org.springframework.data.redis.listener.ChannelTopic"&gt;
          &lt;constructor-arg value="chatroom"/&gt;
        &lt;/bean&gt;
      &lt;/entry&gt;
    &lt;/map&gt;
  &lt;/property&gt;
&lt;/bean&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Each time a message is received, the adapter automatically and transparently performs translation (using the configured <code>RedisSerializer</code>) between the low-level format and the required object type. Any exception caused by the method invocation is caught and handled by the container (by default, exceptions get logged).</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="redis.streams"><a class="anchor" href="index.html#redis.streams"></a>10.11. Redis Streams</h3>
<div class="paragraph">
<p>Redis Streams model a log data structure in an abstract approach. Typically, logs are append-only data structures and are consumed from the beginning on, at a random position, or by streaming new messages.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Learn more about Redis Streams in the <a href="https://redis.io/topics/streams-intro">Redis reference documentation</a>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Redis Streams can be roughly divided into two areas of functionality:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Appending records</p>
</li>
<li>
<p>Consuming records</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Although this pattern has similarities to <a href="index.html#pubsub">Pub/Sub</a>, the main difference lies in the persistence of messages and how they are consumed.</p>
</div>
<div class="paragraph">
<p>While Pub/Sub relies on the broadcasting of transient messages (i.e. if you don&#8217;t listen, you miss a message), Redis Stream use a persistent, append-only data type that retains messages until the stream is trimmed. Another difference in consumption is that Pub/Sub registers a server-side subscription. Redis pushes arriving messages to the client while Redis Streams require active polling.</p>
</div>
<div class="paragraph">
<p>The <code>org.springframework.data.redis.connection</code> and <code>org.springframework.data.redis.stream</code> packages provide the core functionality for Redis Streams.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Redis Stream support is currently only available through the <a href="index.html#redis:connectors:lettuce">Lettuce client</a> as it is not yet supported by <a href="index.html#redis:connectors:jedis">Jedis</a>.
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="redis.streams.send"><a class="anchor" href="index.html#redis.streams.send"></a>10.11.1. Appending</h4>
<div class="paragraph">
<p>To send a record, you can use, as with the other operations, either the low-level <code>RedisConnection</code> or the high-level <code>StreamOperations</code>. Both entities offer the <code>add</code> (<code>xAdd</code>) method, which accepts the record and the destination stream as arguments. While <code>RedisConnection</code> requires raw data (array of bytes), the <code>StreamOperations</code> lets arbitrary objects be passed in as records, as shown in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">// append message through connection
RedisConnection con = …
byte[] stream = …
ByteRecord record = StreamRecords.rawBytes(…).withStreamKey(stream);
con.xAdd(record);

// append message through RedisTemplate
RedisTemplate template = …
StringRecord record = StreamRecords.string(…).withStreamKey("my-stream");
template.streamOps().add(record);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Stream records carry a <code>Map</code>, key-value tuples, as their payload. Appending a record to a stream returns the <code>RecordId</code> that can be used as further reference.</p>
</div>
</div>
<div class="sect3">
<h4 id="redis.streams.receive"><a class="anchor" href="index.html#redis.streams.receive"></a>10.11.2. Consuming</h4>
<div class="paragraph">
<p>On the consuming side, one can consume one or multiple streams. Redis Streams provide read commands that allow consumption of the stream from an arbitrary position (random access) within the known stream content and beyond the stream end to consume new stream record.</p>
</div>
<div class="paragraph">
<p>At the low-level, <code>RedisConnection</code> offers the <code>xRead</code> and <code>xReadGroup</code> methods that map the Redis commands for reading and reading within a consumer group, respectively. Note that multiple streams can be used as arguments.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Subscription commands in Redis can be blocking. That is, calling <code>xRead</code> on a connection causes the current thread to block as it starts waiting for messages. The thread is released only if the read command times out or receives a message.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To consume stream messages, one can either poll for messages in application code, or use one of the two <a href="index.html#redis.streams.receive.containers">Asynchronous reception through Message Listener Containers</a>, the imperative or the reactive one. Each time a new records arrives, the container notifies the application code.</p>
</div>
<div class="sect4">
<h5 id="redis.streams.receive.synchronous"><a class="anchor" href="index.html#redis.streams.receive.synchronous"></a>Synchronous reception</h5>
<div class="paragraph">
<p>While stream consumption is typically associated with asynchronous processing, it is possible to consume messages synchronously. The overloaded <code>StreamOperations.read(…)</code> methods provide this functionality. During a synchronous receive, the calling thread potentially blocks until a message becomes available. The property <code>StreamReadOptions.block</code> specifies how long the receiver should wait before giving up waiting for a message.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">// Read message through RedisTemplate
RedisTemplate template = …

List&lt;MapRecord&lt;K, HK, HV&gt;&gt; messages = template.streamOps().read(StreamReadOptions.empty().count(2),
				StreamOffset.latest("my-stream"));

List&lt;MapRecord&lt;K, HK, HV&gt;&gt; messages = template.streamOps().read(Consumer.from("my-group", "my-consumer"),
				StreamReadOptions.empty().count(2),
				StreamOffset.create("my-stream", ReadOffset.lastConsumed()))</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="redis.streams.receive.containers"><a class="anchor" href="index.html#redis.streams.receive.containers"></a>Asynchronous reception through Message Listener Containers</h5>
<div class="paragraph">
<p>Due to its blocking nature, low-level polling is not attractive, as it requires connection and thread management for every single consumer. To alleviate this problem, Spring Data offers message listeners, which do all the heavy lifting. If you are familiar with EJB and JMS, you should find the concepts familiar, as it is designed to be as close as possible to the support in Spring Framework and its message-driven POJOs (MDPs).</p>
</div>
<div class="paragraph">
<p>Spring Data ships with two implementations tailored to the used programming model:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>StreamMessageListenerContainer</code> acts as message listener container for imperative programming models. It is used to consume records from a Redis Stream and drive the <code>StreamListener</code> instances that are injected into it.</p>
</li>
<li>
<p><code>StreamReceiver</code> provides a reactive variant of a message listener. It is used to consume messages from a Redis Stream as potentially infinite stream and emit stream messages through a <code>Flux</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><code>StreamMessageListenerContainer</code> and <code>StreamReceiver</code> are responsible for all threading of message reception and dispatch into the listener for processing. A message listener container/receiver is the intermediary between an MDP and a messaging provider and takes care of registering to receive messages, resource acquisition and release, exception conversion, and the like. This lets you as an application developer write the (possibly complex) business logic associated with receiving a message (and reacting to it) and delegates boilerplate Redis infrastructure concerns to the framework.</p>
</div>
<div class="paragraph">
<p>Both containers allow runtime configuration changes so that you can add or remove subscriptions while an application is running without the need for a restart. Additionally, the container uses a lazy subscription approach, using a <code>RedisConnection</code> only when needed. If all the listeners are unsubscribed, it automatically performs a cleanup, and the thread is released.</p>
</div>
<div class="sect5">
<h6>Imperative <code>StreamMessageListenerContainer</code></h6>
<div class="paragraph">
<p>In a fashion similar to a Message-Driven Bean (MDB) in the EJB world, the Stream-Driven POJO (SDP) acts as a receiver for Stream messages. The one restriction on an SDP is that it must implement the <code>org.springframework.data.redis.stream.StreamListener</code> interface. Please also be aware that in the case where your POJO receives messages on multiple threads, it is important to ensure that your implementation is thread-safe.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">class ExampleStreamListener implements StreamListener&lt;String, MapRecord&lt;String, String, String&gt;&gt; {

	@Override
	public void onMessage(MapRecord&lt;String, String, String&gt; message) {

		System.out.println("MessageId: " + message.getId());
		System.out.println("Stream: " + message.getStream());
		System.out.println("Body: " + message.getValue());
	}
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>StreamListener</code> represents a functional interface so implementations can be rewritten using their Lambda form:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">message -&gt; {

    System.out.println("MessageId: " + message.getId());
    System.out.println("Stream: " + message.getStream());
    System.out.println("Body: " + message.getValue());
};</code></pre>
</div>
</div>
<div class="paragraph">
<p>Once you’ve implemented your <code>StreamListener</code>, it’s time to create a message listener container and register a subscription:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">RedisConnectionFactory connectionFactory = …
StreamListener&lt;String, MapRecord&lt;String, String, String&gt;&gt; streamListener = …

StreamMessageListenerContainerOptions&lt;String, MapRecord&lt;String, String, String&gt;&gt; containerOptions = StreamMessageListenerContainerOptions
			.builder().pollTimeout(Duration.ofMillis(100)).build();

StreamMessageListenerContainer&lt;String, MapRecord&lt;String, String, String&gt;&gt; container = StreamMessageListenerContainer.create(connectionFactory,
				containerOptions);

Subscription subscription = container.receive(StreamOffset.fromStart("my-stream"), streamListener);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Please refer to the Javadoc of the various message listener containers for a full description of the features supported by each implementation.</p>
</div>
</div>
<div class="sect5">
<h6>Reactive <code>StreamReceiver</code></h6>
<div class="paragraph">
<p>Reactive consumption of streaming data sources typically happens through a <code>Flux</code> of events or messages. The reactive receiver implementation is provided with <code>StreamReceiver</code> and its overloaded <code>receive(…)</code> messages. The reactive approach requires fewer infrastructure resources such as threads in comparison to <code>StreamMessageListenerContainer</code> as it is leveraging threading resources provided by the driver. The receiving stream is a demand-driven publisher of <code>StreamMessage</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">Flux&lt;MapRecord&lt;String, String, String&gt;&gt; messages = …

return messages.doOnNext(it -&gt; {
    System.out.println("MessageId: " + message.getId());
    System.out.println("Stream: " + message.getStream());
    System.out.println("Body: " + message.getValue());
});</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now we need to create the <code>StreamReceiver</code> and register a subscription to consume stream messages:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">ReactiveRedisConnectionFactory connectionFactory = …

StreamReceiverOptions&lt;String, MapRecord&lt;String, String, String&gt;&gt; options = StreamReceiverOptions.builder().pollTimeout(Duration.ofMillis(100))
				.build();
StreamReceiver&lt;String, MapRecord&lt;String, String, String&gt;&gt; receiver = StreamReceiver.create(connectionFactory, options);

Flux&lt;MapRecord&lt;String, String, String&gt;&gt; messages = receiver.receive(StreamOffset.fromStart("my-stream"));</code></pre>
</div>
</div>
<div class="paragraph">
<p>Please refer to the Javadoc of the various message listener containers for a full description of the features supported by each implementation.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Demand-driven consumption uses backpressure signals to activate and deactivate polling. <code>StreamReceiver</code> subscriptions pause polling if the demand is satisfied until subscribers signal further demand. Depending on the <code>ReadOffset</code> strategy, this can cause messages to be skipped.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect4">
<h5 id="redis.streams.acknowledge"><a class="anchor" href="index.html#redis.streams.acknowledge"></a><code>Acknowledge</code> strategies</h5>
<div class="paragraph">
<p>When you read with messages via a <code>Consumer Group</code>, the server will remember that a given message was delivered and add it to the Pending Entries List (PEL). A list of messages delivered but not yet acknowledged.<br>
Messages have to be acknowledged via <code>StreamOperations.acknowledge</code> in order to be removed from the Pending Entries List as shown in the snippet below.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">StreamMessageListenerContainer&lt;String, MapRecord&lt;String, String, String&gt;&gt; container = ...

container.receive(Consumer.from("my-group", "my-consumer"), <i class="conum" data-value="1"></i><b>(1)</b>
	StreamOffset.create("my-stream", ReadOffset.lastConsumed()),
    msg -&gt; {

	    // ...
	    redisTemplate.opsForStream().acknowledge("my-group", msg); <i class="conum" data-value="2"></i><b>(2)</b>
    });</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Read as <em>my-consumer</em> from group <em>my-group</em>. Received messages are not acknowledged.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Acknowledged the message after processing.</td>
</tr>
</table>
</div>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
To auto acknowledge messages on receive use <code>receiveAutoAck</code> instead of <code>receive</code>.
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="redis.streams.receive.readoffset"><a class="anchor" href="index.html#redis.streams.receive.readoffset"></a><code>ReadOffset</code> strategies</h5>
<div class="paragraph">
<p>Stream read operations accept a read offset specification to consume messages from the given offset on. <code>ReadOffset</code> represents the read offset specification. Redis supports 3 variants of offsets, depending on whether you consume the stream standalone or within a consumer group:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>ReadOffset.latest()</code> – Read the latest message.</p>
</li>
<li>
<p><code>ReadOffset.from(…)</code> – Read after a specific message Id.</p>
</li>
<li>
<p><code>ReadOffset.lastConsumed()</code> – Read after the last consumed message Id (consumer-group only).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In the context of a message container-based consumption, we need to advance (or increment) the read offset when consuming a message. Advancing depends on the requested <code>ReadOffset</code> and consumption mode (with/without consumer groups). The following matrix explains how containers advance <code>ReadOffset</code>:</p>
</div>
<table class="tableblock frame-all grid-all fit-content">
<caption class="title">Table 5. ReadOffset Advancing</caption>
<colgroup>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Read offset</th>
<th class="tableblock halign-left valign-top">Standalone</th>
<th class="tableblock halign-left valign-top">Consumer Group</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Latest</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Read latest message</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Read latest message</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specific Message Id</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Use last seen message as the next MessageId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Use last seen message as the next MessageId</p></td>
</tr>
</tbody>
<tfoot>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Last Consumed</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Use last seen message as the next MessageId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Last consumed message as per consumer group</p></td>
</tr>
</tfoot>
</table>
<div class="paragraph">
<p>Reading from a specific message id and the last consumed message can be considered safe operations that ensure consumption of all messages that were appended to the stream.
Using the latest message for read can skip messages that were added to the stream while the poll operation was in the state of dead time. Polling introduces a dead time in which messages can arrive between individual polling commands. Stream consumption is not a linear contiguous read but split into repeating <code>XREAD</code> calls.</p>
</div>
</div>
<div class="sect4">
<h5 id="redis.streams.receive.serialization"><a class="anchor" href="index.html#redis.streams.receive.serialization"></a>Serialization</h5>
<div class="paragraph">
<p>Any Record sent to the stream needs to be serialized to its binary format. Due to the streams closeness to the hash data structure the stream key, field names and values use the according serializers configured on the <code>RedisTemplate</code>.</p>
</div>
<table class="tableblock frame-all grid-all fit-content">
<caption class="title">Table 6. Stream Serialization</caption>
<colgroup>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Stream Property</th>
<th class="tableblock halign-left valign-top">Serializer</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">key</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">keySerializer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">used for <code>Record#getStream()</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">field</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">hashKeySerializer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">used for each map key in the payload</p></td>
</tr>
</tbody>
<tfoot>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">value</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">hashValueSerializer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">used for each map value in the payload</p></td>
</tr>
</tfoot>
</table>
<div class="paragraph">
<p>Please make sure to review <code>RedisSerializer</code>s in use and note that if you decide to not use any serializer you need to make sure those values are binary already.</p>
</div>
</div>
<div class="sect4">
<h5 id="redis.streams.hashing"><a class="anchor" href="index.html#redis.streams.hashing"></a>Object Mapping</h5>
<div class="sect5">
<h6>Simple Values</h6>
<div class="paragraph">
<p><code>StreamOperations</code> allows to append simple values, via <code>ObjectRecord</code>, directly to the stream without having to put those values into a <code>Map</code> structure.
The value will then be assigned to an <em>payload</em> field and can be extracted when reading back the value.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">ObjectRecord&lt;String, String&gt; record = StreamRecords.newRecord()
    .in("my-stream")
    .ofObject("my-value");

redisTemplate()
    .opsForStream()
    .add(record); <i class="conum" data-value="1"></i><b>(1)</b>

List&lt;ObjectRecord&lt;String, String&gt;&gt; records = redisTemplate()
    .opsForStream()
    .read(String.class, StreamOffset.fromStart("my-stream"));</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>XADD my-stream * "_class" "java.lang.String" "_raw" "my-value"</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><code>ObjectRecord</code>s pass through the very same serialization process as the all other records, thus the Record can also obtained using the untyped read operation returning a <code>MapRecord</code>.</p>
</div>
</div>
<div class="sect5">
<h6>Complex Values</h6>
<div class="paragraph">
<p>Adding a complex value to the stream can be done in 3 ways:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Convert to simple value using eg. a String JSON representation.</p>
</li>
<li>
<p>Serialize the value with a suitable <code>RedisSerializer</code>.</p>
</li>
<li>
<p>Convert the value into a <code>Map</code> suitable for serialization using a <code>HashMapper</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The first variant is the most straight forward one but neglects the field value capabilities offered by the stream structure, still the values in the stream will be readable for other consumers.
The 2nd option holds the same benefits as the first one, but may lead to a very specific consumer limitations as the all consumers must implement the very same serialization mechanism.
The <code>HashMapper</code> approach is the a bit more complex one making use of the steams hash structure, but flattening the source. Still other consumers remain able to read the records as long as suitable serializer combinations are chosen.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
HashMappers convert the payload to a <code>Map</code> with specific types. Make sure to use Hash-Key and Hash-Value serializers that are capable of (de-)serializing the hash.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">ObjectRecord&lt;String, User&gt; record = StreamRecords.newRecord()
    .in("user-logon")
    .ofObject(new User("night", "angel"));

redisTemplate()
    .opsForStream()
    .add(record); <i class="conum" data-value="1"></i><b>(1)</b>

List&lt;ObjectRecord&lt;String, User&gt;&gt; records = redisTemplate()
    .opsForStream()
    .read(User.class, StreamOffset.fromStart("user-logon"));</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>XADD user-logon * "_class" "com.example.User" "firstname" "night" "lastname" "angel"</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><code>StreamOperations</code> use by default <a href="index.html#redis.repositories.mapping">ObjectHashMapper</a>.
You may provide a <code>HashMapper</code> suitable for your requirements when obtaining <code>StreamOperations</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">redisTemplate()
    .opsForStream(new Jackson2HashMapper(true))
    .add(record); <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>XADD user-logon * "firstname" "night" "@class" "com.example.User" "lastname" "angel"</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>A <code>StreamMessageListenerContainer</code> may not be aware of any <code>@TypeAlias</code> used on domain types as those need to be resolved through a <code>MappingContext</code>.
Make sure to initialize <code>RedisMappingContext</code> with a <code>initialEntitySet</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">@Bean
RedisMappingContext redisMappingContext() {
    RedisMappingContext ctx = new RedisMappingContext();
    ctx.setInitialEntitySet(Collections.singleton(Person.class));
    return ctx;
}

@Bean
RedisConverter redisConverter(RedisMappingContext mappingContext) {
    return new MappingRedisConverter(mappingContext);
}

@Bean
ObjectHashMapper hashMapper(RedisConverter converter) {
    return new ObjectHashMapper(converter);
}

@Bean
StreamMessageListenerContainer streamMessageListenerContainer(RedisConnectionFactory connectionFactory, ObjectHashMapper hashMapper) {
    StreamMessageListenerContainerOptions&lt;String, ObjectRecord&lt;String, Object&gt;&gt; options = StreamMessageListenerContainerOptions.builder()
            .objectMapper(hashMapper)
            .build();

    return StreamMessageListenerContainer.create(connectionFactory, options);
}</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="tx"><a class="anchor" href="index.html#tx"></a>10.12. Redis Transactions</h3>
<div class="paragraph">
<p>Redis provides support for <a href="https://redis.io/topics/transactions">transactions</a> through the <code>multi</code>, <code>exec</code>, and <code>discard</code> commands. These operations are available on <code>RedisTemplate</code>. However, <code>RedisTemplate</code> is not guaranteed to run all the operations in the transaction with the same connection.</p>
</div>
<div class="paragraph">
<p>Spring Data Redis provides the <code>SessionCallback</code> interface for use when multiple operations need to be performed with the same <code>connection</code>, such as when using Redis transactions. The following example uses the <code>multi</code> method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">//execute a transaction
List&lt;Object&gt; txResults = redisTemplate.execute(new SessionCallback&lt;List&lt;Object&gt;&gt;() {
  public List&lt;Object&gt; execute(RedisOperations operations) throws DataAccessException {
    operations.multi();
    operations.opsForSet().add("key", "value1");

    // This will contain the results of all operations in the transaction
    return operations.exec();
  }
});
System.out.println("Number of items added to set: " + txResults.get(0));</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>RedisTemplate</code> uses its value, hash key, and hash value serializers to deserialize all results of <code>exec</code> before returning. There is an additional <code>exec</code> method that lets you pass a custom serializer for transaction results.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
As of version 1.1, an important change has been made to the <code>exec</code> methods of <code>RedisConnection</code> and <code>RedisTemplate</code>. Previously, these methods returned the results of transactions directly from the connectors. This means that the data types often differed from those returned from the methods of <code>RedisConnection</code>. For example, <code>zAdd</code> returns a boolean indicating whether the element has been added to the sorted set. Most connectors return this value as a long, and Spring Data Redis performs the conversion. Another common difference is that most connectors return a status reply (usually the string, <code>OK</code>) for operations such as <code>set</code>. These replies are typically discarded by Spring Data Redis. Prior to 1.1, these conversions were not performed on the results of <code>exec</code>. Also, results were not deserialized in <code>RedisTemplate</code>, so they often included raw byte arrays. If this change breaks your application, set <code>convertPipelineAndTxResults</code> to <code>false</code> on your <code>RedisConnectionFactory</code> to disable this behavior.
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="tx.spring"><a class="anchor" href="index.html#tx.spring"></a>10.12.1. @Transactional Support</h4>
<div class="paragraph">
<p>By default, transaction Support is disabled and has to be explicitly enabled for each <code>RedisTemplate</code> in use by setting <code>setEnableTransactionSupport(true)</code>. Doing so forces binding the current <code>RedisConnection</code> to the current <code>Thread</code> that is triggering <code>MULTI</code>. If the transaction finishes without errors, <code>EXEC</code> is called. Otherwise <code>DISCARD</code> is called. Once in <code>MULTI</code>, <code>RedisConnection</code> queues write operations. All <code>readonly</code> operations, such as <code>KEYS</code>, are piped to a fresh (non-thread-bound) <code>RedisConnection</code>.</p>
</div>
<div class="paragraph">
<p>The following example shows how to configure transaction management:</p>
</div>
<div class="exampleblock">
<div class="title">Example 3. Configuration enabling Transaction Management</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">@Configuration
@EnableTransactionManagement                                 <i class="conum" data-value="1"></i><b>(1)</b>
public class RedisTxContextConfiguration {

  @Bean
  public StringRedisTemplate redisTemplate() {
    StringRedisTemplate template = new StringRedisTemplate(redisConnectionFactory());
    // explicitly enable transaction support
    template.setEnableTransactionSupport(true);              <i class="conum" data-value="2"></i><b>(2)</b>
    return template;
  }

  @Bean
  public RedisConnectionFactory redisConnectionFactory() {
    // jedis || Lettuce
  }

  @Bean
  public PlatformTransactionManager transactionManager() throws SQLException {
    return new DataSourceTransactionManager(dataSource());   <i class="conum" data-value="3"></i><b>(3)</b>
  }

  @Bean
  public DataSource dataSource() throws SQLException {
    // ...
  }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Configures a Spring Context to enable <a href="https://docs.spring.io/spring/docs/5.3.1/spring-framework-reference/data-access.html#transaction-declarative">declarative transaction management</a>.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Configures <code>RedisTemplate</code> to participate in transactions by binding connections to the current thread.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Transaction management requires a <code>PlatformTransactionManager</code>. Spring Data Redis does not ship with a <code>PlatformTransactionManager</code> implementation. Assuming your application uses JDBC, Spring Data Redis can participate in transactions by using existing transaction managers.</td>
</tr>
</table>
</div>
</div>
</div>
<div class="paragraph">
<p>The following examples each demonstrate a usage constraint:</p>
</div>
<div class="exampleblock">
<div class="title">Example 4. Usage Constraints</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">// must be performed on thread-bound connection
template.opsForValue().set("thing1", "thing2");

// read operation must be run on a free (not transaction-aware) connection
template.keys("*");

// returns null as values set within a transaction are not visible
template.opsForValue().get("thing1");</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="pipeline"><a class="anchor" href="index.html#pipeline"></a>10.13. Pipelining</h3>
<div class="paragraph">
<p>Redis provides support for <a href="https://redis.io/topics/pipelining">pipelining</a>, which involves sending multiple commands to the server without waiting for the replies and then reading the replies in a single step. Pipelining can improve performance when you need to send several commands in a row, such as adding many elements to the same List.</p>
</div>
<div class="paragraph">
<p>Spring Data Redis provides several <code>RedisTemplate</code> methods for running commands in a pipeline. If you do not care about the results of the pipelined operations, you can use the standard <code>execute</code> method, passing <code>true</code> for the <code>pipeline</code> argument. The <code>executePipelined</code> methods run the provided <code>RedisCallback</code> or <code>SessionCallback</code> in a pipeline and return the results, as shown in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">//pop a specified number of items from a queue
List&lt;Object&gt; results = stringRedisTemplate.executePipelined(
  new RedisCallback&lt;Object&gt;() {
    public Object doInRedis(RedisConnection connection) throws DataAccessException {
      StringRedisConnection stringRedisConn = (StringRedisConnection)connection;
      for(int i=0; i&lt; batchSize; i++) {
        stringRedisConn.rPop("myqueue");
      }
    return null;
  }
});</code></pre>
</div>
</div>
<div class="paragraph">
<p>The preceding example runs a bulk right pop of items from a queue in a pipeline. The <code>results</code> <code>List</code> contains all of the popped items. <code>RedisTemplate</code> uses its value, hash key, and hash value serializers to deserialize all results before returning, so the returned items in the preceding example are Strings. There are additional <code>executePipelined</code> methods that let you pass a custom serializer for pipelined results.</p>
</div>
<div class="paragraph">
<p>Note that the value returned from the <code>RedisCallback</code> is required to be <code>null</code>, as this value is discarded in favor of returning the results of the pipelined commands.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The Lettuce driver supports fine grained flush control that allows to either flush commands as they appear, buffer or send them at connection close.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">LettuceConnectionFactory factory = // ...
factory.setPipeliningFlushPolicy(PipeliningFlushPolicy.buffered(3)); <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Buffer locally and flush after every 3rd command.</td>
</tr>
</table>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
As of version 1.1, an important change has been made to the <code>exec</code> methods of <code>RedisConnection</code> and <code>RedisTemplate</code>. Previously, these methods returned the results of transactions directly from the connectors. This means that the data types often differed from those returned from the methods of <code>RedisConnection</code>. For example, <code>zAdd</code> returns a boolean indicating whether the element has been added to the sorted set. Most connectors return this value as a long, and Spring Data Redis performs the conversion. Another common difference is that most connectors return a status reply (usually the string, <code>OK</code>) for operations such as <code>set</code>. These replies are typically discarded by Spring Data Redis. Prior to 1.1, these conversions were not performed on the results of <code>exec</code>. Also, results were not deserialized in <code>RedisTemplate</code>, so they often included raw byte arrays. If this change breaks your application, set <code>convertPipelineAndTxResults</code> to <code>false</code> on your <code>RedisConnectionFactory</code> to disable this behavior.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="scripting"><a class="anchor" href="index.html#scripting"></a>10.14. Redis Scripting</h3>
<div class="paragraph">
<p>Redis versions 2.6 and higher provide support for running Lua scripts through the <a href="https://redis.io/commands/eval">eval</a> and <a href="https://redis.io/commands/evalsha">evalsha</a> commands. Spring Data Redis provides a high-level abstraction for running scripts that handles serialization and automatically uses the Redis script cache.</p>
</div>
<div class="paragraph">
<p>Scripts can be run by calling the <code>execute</code> methods of <code>RedisTemplate</code> and <code>ReactiveRedisTemplate</code>. Both use a configurable <code>ScriptExecutor</code> (or <code>ReactiveScriptExecutor</code>) to run the provided script. By default, the <code>ScriptExecutor</code> (or <code>ReactiveScriptExecutor</code>) takes care of serializing the provided keys and arguments and deserializing the script result. This is done through the key and value serializers of the template. There is an additional overload that lets you pass custom serializers for the script arguments and the result.</p>
</div>
<div class="paragraph">
<p>The default <code>ScriptExecutor</code> optimizes performance by retrieving the SHA1 of the script and attempting first to run <code>evalsha</code>, falling back to <code>eval</code> if the script is not yet present in the Redis script cache.</p>
</div>
<div class="paragraph">
<p>The following example runs a common &#8220;check-and-set&#8221; scenario by using a Lua script. This is an ideal use case for a Redis script, as it requires that running a set of commands atomically, and the behavior of one command is influenced by the result of another.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">@Bean
public RedisScript&lt;Boolean&gt; script() {

  ScriptSource scriptSource = new ResourceScriptSource(new ClassPathResource("META-INF/scripts/checkandset.lua"));
  return RedisScript.of(scriptSource, Boolean.class);
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">public class Example {

  @Autowired
  RedisScript&lt;Boolean&gt; script;

  public boolean checkAndSet(String expectedValue, String newValue) {
    return redisTemplate.execute(script, singletonList("key"), asList(expectedValue, newValue));
  }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="lua" class="language-lua hljs">-- checkandset.lua
local current = redis.call('GET', KEYS[1])
if current == ARGV[1]
  then redis.call('SET', KEYS[1], ARGV[2])
  return true
end
return false</code></pre>
</div>
</div>
<div class="paragraph">
<p>The preceding code configures a <code>RedisScript</code> pointing to a file called <code>checkandset.lua</code>, which is expected to return a boolean value. The script <code>resultType</code> should be one of <code>Long</code>, <code>Boolean</code>, <code>List</code>, or a deserialized value type. It can also be <code>null</code> if the script returns a throw-away status (specifically, <code>OK</code>).</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
It is ideal to configure a single instance of <code>DefaultRedisScript</code> in your application context to avoid re-calculation of the script&#8217;s SHA1 on every script run.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The <code>checkAndSet</code> method above then runs the scripts. Scripts can be run within a <code>SessionCallback</code> as part of a transaction or pipeline. See &#8220;<a href="index.html#tx">Redis Transactions</a>&#8221; and &#8220;<a href="index.html#pipeline">Pipelining</a>&#8221; for more information.</p>
</div>
<div class="paragraph">
<p>The scripting support provided by Spring Data Redis also lets you schedule Redis scripts for periodic running by using the Spring Task and Scheduler abstractions. See the <a href="https://projects.spring.io/spring-framework/">Spring Framework</a> documentation for more details.</p>
</div>
</div>
<div class="sect2">
<h3 id="redis:support"><a class="anchor" href="index.html#redis:support"></a>10.15. Support Classes</h3>
<div class="paragraph">
<p>Package <code>org.springframework.data.redis.support</code> offers various reusable components that rely on Redis as a backing store. Currently, the package contains various JDK-based interface implementations on top of Redis, such as <a href="https://download.oracle.com/javase/8/docs/api/java/util/concurrent/atomic/package-summary.html">atomic</a> counters and JDK <a href="https://download.oracle.com/javase/8/docs/api/java/util/Collection.html">Collections</a>.</p>
</div>
<div class="paragraph">
<p>The atomic counters make it easy to wrap Redis key incrementation while the collections allow easy management of Redis keys with minimal storage exposure or API leakage. In particular, the <code>RedisSet</code> and <code>RedisZSet</code> interfaces offer easy access to the set operations supported by Redis, such as <code>intersection</code> and <code>union</code>. <code>RedisList</code> implements the <code>List</code>, <code>Queue</code>, and <code>Deque</code> contracts (and their equivalent blocking siblings) on top of Redis, exposing the storage as a FIFO (First-In-First-Out), LIFO (Last-In-First-Out) or capped collection with minimal configuration. The following example shows the configuration for a bean that uses a <code>RedisList</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="xml" class="language-xml hljs">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;beans xmlns="http://www.springframework.org/schema/beans"
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xmlns:p="http://www.springframework.org/schema/p" xsi:schemaLocation="
  http://www.springframework.org/schema/beans https://www.springframework.org/schema/beans/spring-beans.xsd"&gt;

  &lt;bean id="queue" class="org.springframework.data.redis.support.collections.DefaultRedisList"&gt;
    &lt;constructor-arg ref="redisTemplate"/&gt;
    &lt;constructor-arg value="queue-key"/&gt;
  &lt;/bean&gt;

&lt;/beans&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following example shows a Java configuration example for a <code>Deque</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">public class AnotherExample {

  // injected
  private Deque&lt;String&gt; queue;

  public void addTag(String tag) {
    queue.push(tag);
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>As shown in the preceding example, the consuming code is decoupled from the actual storage implementation. In fact, there is no indication that Redis is used underneath. This makes moving from development to production environments transparent and highly increases testability (the Redis implementation can be replaced with an in-memory one).</p>
</div>
<div class="sect3">
<h4 id="redis:support:cache-abstraction"><a class="anchor" href="index.html#redis:support:cache-abstraction"></a>10.15.1. Support for the Spring Cache Abstraction</h4>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Changed in 2.0
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Spring Redis provides an implementation for the Spring <a href="https://docs.spring.io/spring/docs/5.3.1/spring-framework-reference/integration.html#cache">cache abstraction</a> through the <code>org.springframework.data.redis.cache</code> package. To use Redis as a backing implementation, add <code>RedisCacheManager</code> to your configuration, as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">@Bean
public RedisCacheManager cacheManager(RedisConnectionFactory connectionFactory) {
	return RedisCacheManager.create(connectionFactory);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>RedisCacheManager</code> behavior can be configured with <code>RedisCacheManagerBuilder</code>, letting you set the default <code>RedisCacheConfiguration</code>, transaction behavior, and predefined caches.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">RedisCacheManager cm = RedisCacheManager.builder(connectionFactory)
	.cacheDefaults(defaultCacheConfig())
	.withInitialCacheConfigurations(singletonMap("predefined", defaultCacheConfig().disableCachingNullValues()))
	.transactionAware()
	.build();</code></pre>
</div>
</div>
<div class="paragraph">
<p>As shown in the preceding example, <code>RedisCacheManager</code> allows definition of configurations on a per-cache basis.</p>
</div>
<div class="paragraph">
<p>The behavior of <code>RedisCache</code> created with <code>RedisCacheManager</code> is defined with <code>RedisCacheConfiguration</code>. The configuration lets you set key expiration times, prefixes, and <code>RedisSerializer</code> implementations for converting to and from the binary storage format, as shown in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">RedisCacheConfiguration config = RedisCacheConfiguration.defaultCacheConfig()
    .entryTtl(Duration.ofSeconds(1))
	.disableCachingNullValues();</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>RedisCacheManager</code> defaults to a lock-free <code>RedisCacheWriter</code> for reading and writing binary values. Lock-free caching improves throughput. The lack of entry locking can lead to overlapping, non-atomic commands for the <code>putIfAbsent</code> and <code>clean</code> methods, as those require multiple commands to be sent to Redis. The locking counterpart prevents command overlap by setting an explicit lock key and checking against presence of this key, which leads to additional requests and potential command wait times.</p>
</div>
<div class="paragraph">
<p>It is possible to opt in to the locking behavior as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">RedisCacheManager cm = RedisCacheManager.build(RedisCacheWriter.lockingRedisCacheWriter())
	.cacheDefaults(defaultCacheConfig())
	...</code></pre>
</div>
</div>
<div class="paragraph">
<p>By default, any <code>key</code> for a cache entry gets prefixed with the actual cache name followed by two colons.
This behavior can be changed to a static as well as a computed prefix.</p>
</div>
<div class="paragraph">
<p>The following example shows how to set a static prefix:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">// static key prefix
RedisCacheConfiguration.defaultCacheConfig().prefixKeysWith("( ͡° ᴥ ͡°)");

The following example shows how to set a computed prefix:

// computed key prefix
RedisCacheConfiguration.defaultCacheConfig().computePrefixWith(cacheName -&gt; "¯\_(ツ)_/¯" + cacheName);</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following table lists the default settings for <code>RedisCacheManager</code>:</p>
</div>
<table class="tableblock frame-all grid-all" style="width: 80%;">
<caption class="title">Table 7. <code>RedisCacheManager</code> defaults</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 66.6667%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Setting</th>
<th class="tableblock halign-left valign-top">Value</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cache Writer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Non-locking</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cache Configuration</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>RedisCacheConfiguration#defaultConfiguration</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Initial Caches</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">None</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Transaction Aware</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The following table lists the default settings for <code>RedisCacheConfiguration</code>:</p>
</div>
<table class="tableblock frame-all grid-all" style="width: 80%;">
<caption class="title">Table 8. RedisCacheConfiguration defaults</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 66.6667%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Key Expiration</th>
<th class="tableblock halign-left valign-top">None</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cache <code>null</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Prefix Keys</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Default Prefix</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The actual cache name</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Key Serializer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>StringRedisSerializer</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Value Serializer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>JdkSerializationRedisSerializer</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Conversion Service</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>DefaultFormattingConversionService</code> with default cache key converters</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>By default <code>RedisCache</code>, statistics are disabled.
Use <code>RedisCacheManagerBuilder.enableStatistics()</code> to collect local <em>hits</em> and <em>misses</em> through <code>RedisCache#getStatistics()</code>, returning a snapshot of the collected data.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="redis:reactive"><a class="anchor" href="index.html#redis:reactive"></a>11. Reactive Redis support</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This section covers reactive Redis support and how to get started. Reactive Redis support naturally has certain overlaps with <a href="index.html#redis">imperative Redis support</a>.</p>
</div>
<div class="sect2">
<h3 id="redis:reactive:requirements"><a class="anchor" href="index.html#redis:reactive:requirements"></a>11.1. Redis Requirements</h3>
<div class="paragraph">
<p>Spring Data Redis currently integrates with <a href="https://github.com/lettuce-io/lettuce-core">Lettuce</a> as the only reactive Java connector. <a href="https://projectreactor.io/">Project Reactor</a> is used as reactive composition library.</p>
</div>
</div>
<div class="sect2">
<h3 id="redis:reactive:connectors"><a class="anchor" href="index.html#redis:reactive:connectors"></a>11.2. Connecting to Redis by Using a Reactive Driver</h3>
<div class="paragraph">
<p>One of the first tasks when using Redis and Spring is to connect to the store through the IoC container. To do that, a Java connector (or binding) is required. No matter the library you choose, you must use the <code>org.springframework.data.redis.connection</code> package and its <code>ReactiveRedisConnection</code> and <code>ReactiveRedisConnectionFactory</code> interfaces to work with and retrieve active <code>connections</code> to Redis.</p>
</div>
<div class="sect3">
<h4 id="redis:reactive:connectors:operation-modes"><a class="anchor" href="index.html#redis:reactive:connectors:operation-modes"></a>11.2.1. Redis Operation Modes</h4>
<div class="paragraph">
<p>Redis can be run as a standalone server, with <a href="index.html#redis:sentinel">Redis Sentinel</a>, or in <a href="index.html#cluster">Redis Cluster</a> mode.
<a href="https://github.com/lettuce-io/lettuce-core">Lettuce</a> supports all of the previously mentioned connection types.</p>
</div>
</div>
<div class="sect3">
<h4 id="redis:reactive:connectors:connection"><a class="anchor" href="index.html#redis:reactive:connectors:connection"></a>11.2.2. <code>ReactiveRedisConnection</code> and <code>ReactiveRedisConnectionFactory</code></h4>
<div class="paragraph">
<p><code>ReactiveRedisConnection</code> is the core of Redis communication, as it handles the communication with the Redis back-end. It also automatically translates the underlying driver exceptions to Spring&#8217;s consistent DAO exception <a href="https://docs.spring.io/spring/docs/5.3.1/spring-framework-reference/data-access.html#dao-exceptions">hierarchy</a>, so you can switch the connectors without any code changes, as the operation semantics remain the same.</p>
</div>
<div class="paragraph">
<p><code>ReactiveRedisConnectionFactory</code> creates active <code>ReactiveRedisConnection</code> instances. In addition, the factories act as <code>PersistenceExceptionTranslator</code> instances, meaning that, once declared, they let you do transparent exception translation&#8201;&#8212;&#8201;for example, exception translation through the use of the <code>@Repository</code> annotation and AOP. For more information, see the dedicated <a href="https://docs.spring.io/spring/docs/5.3.1/spring-framework-reference/data-access.html#orm-exception-translation">section</a> in the Spring Framework documentation.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Depending on the underlying configuration, the factory can return a new connection or an existing connection (in case a pool or shared native connection is used).
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
The easiest way to work with a <code>ReactiveRedisConnectionFactory</code> is to configure the appropriate connector through the IoC container and inject it into the using class.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="redis:reactive:connectors:lettuce"><a class="anchor" href="index.html#redis:reactive:connectors:lettuce"></a>11.2.3. Configuring a Lettuce Connector</h4>
<div class="paragraph">
<p><a href="https://github.com/lettuce-io/lettuce-core">Lettuce</a> is supported by Spring Data Redis through the <code>org.springframework.data.redis.connection.lettuce</code> package.</p>
</div>
<div class="paragraph">
<p>You can set up <code>ReactiveRedisConnectionFactory</code> for Lettuce as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">@Bean
public ReactiveRedisConnectionFactory connectionFactory() {
  return new LettuceConnectionFactory("localhost", 6379);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following example shows a more sophisticated configuration, including SSL and timeouts, that uses <code>LettuceClientConfigurationBuilder</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">@Bean
public ReactiveRedisConnectionFactory lettuceConnectionFactory() {

  LettuceClientConfiguration clientConfig = LettuceClientConfiguration.builder()
    .useSsl().and()
    .commandTimeout(Duration.ofSeconds(2))
    .shutdownTimeout(Duration.ZERO)
    .build();

  return new LettuceConnectionFactory(new RedisStandaloneConfiguration("localhost", 6379), clientConfig);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>For more detailed client configuration tweaks, see <a href="../../../2.4.1/api/org/springframework/data/redis/connection/lettuce/LettuceClientConfiguration.html"><code>LettuceClientConfiguration</code></a>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="redis:reactive:template"><a class="anchor" href="index.html#redis:reactive:template"></a>11.3. Working with Objects through ReactiveRedisTemplate</h3>
<div class="paragraph">
<p>Most users are likely to use <code>ReactiveRedisTemplate</code> and its corresponding package, <code>org.springframework.data.redis.core</code>. Due to its rich feature set, the template is, in fact, the central class of the Redis module. The template offers a high-level abstraction for Redis interactions. While <code>ReactiveRedisConnection</code> offers low-level methods that accept and return binary values (<code>ByteBuffer</code>), the template takes care of serialization and connection management, freeing you from dealing with such details.</p>
</div>
<div class="paragraph">
<p>Moreover, the template provides operation views (following the grouping from Redis command <a href="https://redis.io/commands">reference</a>) that offer rich, generified interfaces for working against a certain type as described in the following table:</p>
</div>
<table class="tableblock frame-all grid-all" style="width: 80%;">
<caption class="title">Table 9. Operational views</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 66.6667%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Interface</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top" colspan="2"><p class="tableblock"><em>Key Type Operations</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ReactiveGeoOperations</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Redis geospatial operations such as <code>GEOADD</code>, <code>GEORADIUS</code>, and others)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ReactiveHashOperations</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Redis hash operations</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ReactiveHyperLogLogOperations</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Redis HyperLogLog operations such as (<code>PFADD</code>, <code>PFCOUNT</code>, and others)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ReactiveListOperations</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Redis list operations</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ReactiveSetOperations</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Redis set operations</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ReactiveValueOperations</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Redis string (or value) operations</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ReactiveZSetOperations</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Redis zset (or sorted set) operations</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Once configured, the template is thread-safe and can be reused across multiple instances.</p>
</div>
<div class="paragraph">
<p><code>ReactiveRedisTemplate</code> uses a Java-based serializer for most of its operations. This means that any object written or read by the template is serialized or deserialized through <code>RedisElementWriter</code> or <code>RedisElementReader</code>. The serialization context is passed to the template upon construction, and the Redis module offers several implementations available in the <code>org.springframework.data.redis.serializer</code> package. See <a href="index.html#redis:serializer">Serializers</a> for more information.</p>
</div>
<div class="paragraph">
<p>The following example shows a <code>ReactiveRedisTemplate</code> being used to return a <code>Mono</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">@Configuration
class RedisConfiguration {

  @Bean
  ReactiveRedisTemplate&lt;String, String&gt; reactiveRedisTemplate(ReactiveRedisConnectionFactory factory) {
    return new ReactiveRedisTemplate&lt;&gt;(factory, RedisSerializationContext.string());
  }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">public class Example {

  @Autowired
  private ReactiveRedisTemplate&lt;String, String&gt; template;

  public Mono&lt;Long&gt; addLink(String userId, URL url) {
    return template.opsForList().leftPush(userId, url.toExternalForm());
  }
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="redis:reactive:string"><a class="anchor" href="index.html#redis:reactive:string"></a>11.4. String-focused Convenience Classes</h3>
<div class="paragraph">
<p>Since it is quite common for keys and values stored in Redis to be a <code>java.lang.String</code>, the Redis module provides a String-based extension to <code>ReactiveRedisTemplate</code>: <code>ReactiveStringRedisTemplate</code>. It is a convenient one-stop solution for intensive <code>String</code> operations. In addition to being bound to <code>String</code> keys, the template uses the String-based <code>RedisSerializationContext</code>, which means the stored keys and values are human readable (assuming the same encoding is used in both Redis and your code). The following example shows <code>ReactiveStringRedisTemplate</code> in use:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">@Configuration
class RedisConfiguration {

  @Bean
  ReactiveStringRedisTemplate reactiveRedisTemplate(ReactiveRedisConnectionFactory factory) {
    return new ReactiveStringRedisTemplate&lt;&gt;(factory);
  }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">public class Example {

  @Autowired
  private ReactiveStringRedisTemplate redisTemplate;

  public Mono&lt;Long&gt; addLink(String userId, URL url) {
    return redisTemplate.opsForList().leftPush(userId, url.toExternalForm());
  }
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="redis:reactive:pubsub"><a class="anchor" href="index.html#redis:reactive:pubsub"></a>11.5. Redis Messaging/PubSub</h3>
<div class="paragraph">
<p>Spring Data provides dedicated messaging integration for Redis, very similar in functionality and naming to the JMS integration in Spring Framework; in fact, users familiar with the JMS support in Spring should feel right at home.</p>
</div>
<div class="paragraph">
<p>Redis messaging can be roughly divided into two areas of functionality, namely the production or publication and consumption or subscription of messages, hence the shortcut pubsub (Publish/Subscribe). The <code>ReactiveRedisTemplate</code> class is used for message production. For asynchronous reception, Spring Data provides a dedicated message listener container that is used consume a stream of messages.
For the purpose of just subscribing <code>ReactiveRedisTemplate</code> offers stripped down alternatives to utilizing a listener container.</p>
</div>
<div class="paragraph">
<p>The package <code>org.springframework.data.redis.connection</code> and <code>org.springframework.data.redis.listener</code> provide the core functionality for using Redis messaging.</p>
</div>
<div class="sect3">
<h4 id="redis:reactive:pubsub:publish"><a class="anchor" href="index.html#redis:reactive:pubsub:publish"></a>11.5.1. Sending/Publishing messages</h4>
<div class="paragraph">
<p>To publish a message, one can use, as with the other operations, either the low-level <code>ReactiveRedisConnection</code> or the high-level <code>ReactiveRedisTemplate</code>. Both entities offer a publish method that accepts as an argument the message that needs to be sent as well as the destination channel. While <code>ReactiveRedisConnection</code> requires raw-data, the <code>ReactiveRedisTemplate</code> allow arbitrary objects to be passed in as messages:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">// send message through ReactiveRedisConnection
ByteBuffer msg = …
ByteBuffer channel = …
Mono&lt;Long&gt; publish = con.publish(msg, channel);

// send message through ReactiveRedisTemplate
ReactiveRedisTemplate template = …
Mono&lt;Long&gt; publish = template.convertAndSend("channel", "message");</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="redis:reactive:pubsub:subscribe"><a class="anchor" href="index.html#redis:reactive:pubsub:subscribe"></a>11.5.2. Receiving/Subscribing for messages</h4>
<div class="paragraph">
<p>On the receiving side, one can subscribe to one or multiple channels either by naming them directly or by using pattern matching. The latter approach is quite useful as it not only allows multiple subscriptions to be created with one command but to also listen on channels not yet created at subscription time (as long as they match the pattern).</p>
</div>
<div class="paragraph">
<p>At the low-level, <code>ReactiveRedisConnection</code> offers <code>subscribe</code> and <code>pSubscribe</code> methods that map the Redis commands for subscribing by channel respectively by pattern. Note that multiple channels or patterns can be used as arguments. To change a subscription, simply query the channels and patterns of <code>ReactiveSubscription</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Reactive subscription commands in Spring Data Redis are non-blocking and may end without emitting an element.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>As mentioned above, once subscribed a connection starts waiting for messages. No other commands can be invoked on it except for adding new subscriptions or modifying/canceling the existing ones. Commands other than <code>subscribe</code>, <code>pSubscribe</code>, <code>unsubscribe</code>, or <code>pUnsubscribe</code> are illegal and will cause an exception.</p>
</div>
<div class="paragraph">
<p>In order to receive messages, one needs to obtain the message stream. Note that a subscription only publishes messages for channels and patterns that are registered with that particular subscription. The message stream itself is a hot sequence that produces elements without regard to demand. Make sure to register sufficient demand to not exhaust the message buffer.</p>
</div>
<div class="sect4">
<h5 id="redis:reactive:pubsub:subscribe:containers"><a class="anchor" href="index.html#redis:reactive:pubsub:subscribe:containers"></a>Message Listener Containers</h5>
<div class="paragraph">
<p>Spring Data offers <code>ReactiveRedisMessageListenerContainer</code> which does all the heavy lifting of conversion and subscription state management on behalf of the user.</p>
</div>
<div class="paragraph">
<p><code>ReactiveRedisMessageListenerContainer</code> acts as a message listener container. It is used to receive messages from a Redis channel and expose a stream of messages that emits channel messages with deserialization applied. It takes care of registering to receive messages, resource acquisition and release, exception conversion and the like. This allows you as an application developer to write the (possibly complex) business logic associated with receiving a message (and reacting to it), and delegates boilerplate Redis infrastructure concerns to the framework. Message streams register a subscription in Redis upon publisher subscription and unregister if the subscription gets canceled.</p>
</div>
<div class="paragraph">
<p>Furthermore, to minimize the application footprint, <code>ReactiveRedisMessageListenerContainer</code> allows one connection and one thread to be shared by multiple listeners even though they do not share a subscription. Thus no matter how many listeners or channels an application tracks, the runtime cost will remain the same through out its lifetime. Moreover, the container allows runtime configuration changes so one can add or remove listeners while an application is running without the need for restart. Additionally, the container uses a lazy subscription approach, using a <code>ReactiveRedisConnection</code> only when needed - if all the listeners are unsubscribed, cleanup is automatically performed.</p>
</div>
<div class="paragraph">
<p>The message listener container itself does not require external threading resources. It uses the driver threads to publish messages.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">ReactiveRedisConnectionFactory factory = …
ReactiveRedisMessageListenerContainer container = new ReactiveRedisMessageListenerContainer(factory);

Flux&lt;ChannelMessage&lt;String, String&gt;&gt; stream = container.receive(ChannelTopic.of("my-channel"));</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="redis:reactive:pubsub:subscribe:template"><a class="anchor" href="index.html#redis:reactive:pubsub:subscribe:template"></a>Subscribing via template API</h5>
<div class="paragraph">
<p>As mentioned above you can directly use <code>ReactiveRedisTemplate</code> to subscribe to channels / patterns. This approach
offers a straight forward, though limited solution as you lose the option to add subscriptions after the initial
ones. Nevertheless you still can control the message stream via the returned <code>Flux</code> using eg. <code>take(Duration)</code>. When
done reading, on error or cancellation all bound resources are freed again.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">redisTemplate.listenToChannel("channel1", "channel2").doOnNext(msg -&gt; {
    // message processing ...
}).subscribe();</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="redis:reactive:scripting"><a class="anchor" href="index.html#redis:reactive:scripting"></a>11.6. Reactive Scripting</h3>
<div class="paragraph">
<p>You can run Redis scripts with the reactive infrastructure by using the <code>ReactiveScriptExecutor</code>, which is best accessed through <code>ReactiveRedisTemplate</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">public class Example {

  @Autowired
  private ReactiveRedisTemplate&lt;String, String&gt; template;

  public Flux&lt;Long&gt; theAnswerToLife() {

    DefaultRedisScript&lt;Long&gt; script = new DefaultRedisScript&lt;&gt;();
    script.setLocation(new ClassPathResource("META-INF/scripts/42.lua"));
    script.setResultType(Long.class);

    return reactiveTemplate.execute(script);
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>See to the <a href="index.html#scripting">scripting section</a> for more details on scripting commands.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="cluster"><a class="anchor" href="index.html#cluster"></a>12. Redis Cluster</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Working with <a href="https://redis.io/topics/cluster-spec">Redis Cluster</a> requires Redis Server version 3.0+. See the <a href="https://redis.io/topics/cluster-tutorial">Cluster Tutorial</a> for more information.</p>
</div>
<div class="sect2">
<h3>12.1. Enabling Redis Cluster</h3>
<div class="paragraph">
<p>Cluster support is based on the same building blocks as non-clustered communication. <code>RedisClusterConnection</code>, an extension to <code>RedisConnection</code>, handles the communication with the Redis Cluster and translates errors into the Spring DAO exception hierarchy.
<code>RedisClusterConnection</code> instances are created with the <code>RedisConnectionFactory</code>, which has to be set up with the associated <code>RedisClusterConfiguration</code>, as shown in the following example:</p>
</div>
<div class="exampleblock">
<div class="title">Example 5. Sample RedisConnectionFactory Configuration for Redis Cluster</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">@Component
@ConfigurationProperties(prefix = "spring.redis.cluster")
public class ClusterConfigurationProperties {

    /*
     * spring.redis.cluster.nodes[0] = 127.0.0.1:7379
     * spring.redis.cluster.nodes[1] = 127.0.0.1:7380
     * ...
     */
    List&lt;String&gt; nodes;

    /**
     * Get initial collection of known cluster nodes in format {@code host:port}.
     *
     * @return
     */
    public List&lt;String&gt; getNodes() {
        return nodes;
    }

    public void setNodes(List&lt;String&gt; nodes) {
        this.nodes = nodes;
    }
}

@Configuration
public class AppConfig {

    /**
     * Type safe representation of application.properties
     */
    @Autowired ClusterConfigurationProperties clusterProperties;

    public @Bean RedisConnectionFactory connectionFactory() {

        return new JedisConnectionFactory(
            new RedisClusterConfiguration(clusterProperties.getNodes()));
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p><code>RedisClusterConfiguration</code> can also be defined through <code>PropertySource</code> and has the following properties:</p>
</div>
<div class="ulist">
<div class="title">Configuration Properties</div>
<ul>
<li>
<p><code>spring.redis.cluster.nodes</code>: Comma-delimited list of host:port pairs.</p>
</li>
<li>
<p><code>spring.redis.cluster.max-redirects</code>: Number of allowed cluster redirections.</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The initial configuration points driver libraries to an initial set of cluster nodes. Changes resulting from live cluster reconfiguration are kept only in the native driver and are not written back to the configuration.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="cluster.working.with.cluster"><a class="anchor" href="index.html#cluster.working.with.cluster"></a>12.2. Working With Redis Cluster Connection</h3>
<div class="paragraph">
<p>As mentioned earlier, Redis Cluster behaves differently from single-node Redis or even a Sentinel-monitored master-replica environment. This is because the automatic sharding maps a key to one of 16384 slots, which are distributed across the nodes. Therefore, commands that involve more than one key must assert all keys map to the exact same slot to avoid cross-slot errors.
A single cluster node serves only a dedicated set of keys. Commands issued against one particular server return results only for those keys served by that server. As a simple example, consider the <code>KEYS</code> command. When issued to a server in a cluster environment, it returns only the keys served by the node the request is sent to and not necessarily all keys within the cluster. So, to get all keys in a cluster environment, you must read the keys from all the known master nodes.</p>
</div>
<div class="paragraph">
<p>While redirects for specific keys to the corresponding slot-serving node are handled by the driver libraries, higher-level functions, such as collecting information across nodes or sending commands to all nodes in the cluster, are covered by <code>RedisClusterConnection</code>. Picking up the keys example from earlier, this means that the <code>keys(pattern)</code> method picks up every master node in the cluster and simultaneously runs the <code>KEYS</code> command on every master node while picking up the results and returning the cumulated set of keys. To just request the keys of a single node <code>RedisClusterConnection</code> provides overloads for those methods (for example, <code>keys(node, pattern)</code>).</p>
</div>
<div class="paragraph">
<p>A <code>RedisClusterNode</code> can be obtained from <code>RedisClusterConnection.clusterGetNodes</code> or it can be constructed by using either the host and the port or the node Id.</p>
</div>
<div class="paragraph">
<p>The following example shows a set of commands being run across the cluster:</p>
</div>
<div class="exampleblock">
<div class="title">Example 6. Sample of Running Commands Across the Cluster</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="text" class="language-text hljs"><a href="../../../../../../cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="7f0d1a1b160c521c13163f4e4d48514f514f514e">[email&#160;protected]</a>:7379 &gt; cluster nodes

6b38bb... 127.0.0.1:7379 master - 0 0 25 connected 0-5460                      <i class="conum" data-value="1"></i><b>(1)</b>
7bb78c... 127.0.0.1:7380 master - 0 1449730618304 2 connected 5461-10922       <i class="conum" data-value="2"></i><b>(2)</b>
164888... 127.0.0.1:7381 master - 0 1449730618304 3 connected 10923-16383      <i class="conum" data-value="3"></i><b>(3)</b>
b8b5ee... 127.0.0.1:7382 slave 6b38bb... 0 1449730618304 25 connected          <i class="conum" data-value="4"></i><b>(4)</b></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">RedisClusterConnection connection = connectionFactory.getClusterConnnection();

connection.set("thing1", value);                                               <i class="conum" data-value="5"></i><b>(5)</b>
connection.set("thing2", value);                                               <i class="conum" data-value="6"></i><b>(6)</b>

connection.keys("*");                                                          <i class="conum" data-value="7"></i><b>(7)</b>

connection.keys(NODE_7379, "*");                                               <i class="conum" data-value="8"></i><b>(8)</b>
connection.keys(NODE_7380, "*");                                               <i class="conum" data-value="9"></i><b>(9)</b>
connection.keys(NODE_7381, "*");                                               <i class="conum" data-value="10"></i><b>(10)</b>
connection.keys(NODE_7382, "*");                                               <i class="conum" data-value="11"></i><b>(11)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Master node serving slots 0 to 5460 replicated to replica at 7382</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Master node serving slots 5461 to 10922</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Master node serving slots 10923 to 16383</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Replica node holding replicants of the master at 7379</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Request routed to node at 7381 serving slot 12182</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>Request routed to node at 7379 serving slot 5061</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>Request routed to nodes at 7379, 7380, 7381 &#8594; [thing1, thing2]</td>
</tr>
<tr>
<td><i class="conum" data-value="8"></i><b>8</b></td>
<td>Request routed to node at 7379 &#8594; [thing2]</td>
</tr>
<tr>
<td><i class="conum" data-value="9"></i><b>9</b></td>
<td>Request routed to node at 7380 &#8594; []</td>
</tr>
<tr>
<td><i class="conum" data-value="10"></i><b>10</b></td>
<td>Request routed to node at 7381 &#8594; [thing1]</td>
</tr>
<tr>
<td><i class="conum" data-value="11"></i><b>11</b></td>
<td>Request routed to node at 7382 &#8594; [thing2]</td>
</tr>
</table>
</div>
</div>
</div>
<div class="paragraph">
<p>When all keys map to the same slot, the native driver library automatically serves cross-slot requests, such as <code>MGET</code>. However, once this is not the case, <code>RedisClusterConnection</code> runs multiple parallel <code>GET</code> commands against the slot-serving nodes and again returns an accumulated result. This is less performant than the single-slot approach and, therefore, should be used with care. If in doubt, consider pinning keys to the same slot by providing a prefix in curly brackets, such as <code>{my-prefix}.thing1</code> and <code>{my-prefix}.thing2</code>, which will both map to the same slot number. The following example shows cross-slot request handling:</p>
</div>
<div class="exampleblock">
<div class="title">Example 7. Sample of Cross-Slot Request Handling</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="text" class="language-text hljs"><a href="../../../../../../cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="ff8d9a9b968cd29c9396bfcecdc8d1cfd1cfd1ce">[email&#160;protected]</a>:7379 &gt; cluster nodes

6b38bb... 127.0.0.1:7379 master - 0 0 25 connected 0-5460                      <i class="conum" data-value="1"></i><b>(1)</b>
7bb...</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">RedisClusterConnection connection = connectionFactory.getClusterConnnection();

connection.set("thing1", value);           // slot: 12182
connection.set("{thing1}.thing2", value);  // slot: 12182
connection.set("thing2", value);           // slot:  5461

connection.mGet("thing1", "{thing1}.thing2");                                  <i class="conum" data-value="2"></i><b>(2)</b>

connection.mGet("thing1", "thing2");                                           <i class="conum" data-value="3"></i><b>(3)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Same Configuration as in the sample before.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Keys map to same slot &#8594; 127.0.0.1:7381 MGET thing1 {thing1}.thing2</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Keys map to different slots and get split up into single slot ones routed to the according nodes<br>
&#8594; 127.0.0.1:7379 GET thing2<br>
&#8594; 127.0.0.1:7381 GET thing1</td>
</tr>
</table>
</div>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
The preceding examples demonstrate the general strategy followed by Spring Data Redis. Be aware that some operations might require loading huge amounts of data into memory to compute the desired command. Additionally, not all cross-slot requests can safely be ported to multiple single slot requests and error if misused (for example, <code>PFCOUNT</code>).
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="cluster.redistemplate"><a class="anchor" href="index.html#cluster.redistemplate"></a>12.3. Working with <code>RedisTemplate</code> and <code>ClusterOperations</code></h3>
<div class="paragraph">
<p>See the <a href="index.html#redis:template">Working with Objects through RedisTemplate</a> section for information about the general purpose, configuration, and usage of <code>RedisTemplate</code>.</p>
</div>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<i class="fa icon-caution" title="Caution"></i>
</td>
<td class="content">
Be careful when setting up <code>RedisTemplate#keySerializer</code> using any of the JSON <code>RedisSerializers</code>, as changing JSON structure has immediate influence on hash slot calculation.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><code>RedisTemplate</code> provides access to cluster-specific operations through the <code>ClusterOperations</code> interface, which can be obtained from <code>RedisTemplate.opsForCluster()</code>. This lets you explicitly run commands on a single node within the cluster while retaining the serialization and deserialization features configured for the template. It also provides administrative commands (such as <code>CLUSTER MEET</code>) or more high-level operations (for example, resharding).</p>
</div>
<div class="paragraph">
<p>The following example shows how to access <code>RedisClusterConnection</code> with <code>RedisTemplate</code>:</p>
</div>
<div class="exampleblock">
<div class="title">Example 8. Accessing <code>RedisClusterConnection</code> with <code>RedisTemplate</code></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="text" class="language-text hljs">ClusterOperations clusterOps = redisTemplate.opsForCluster();
clusterOps.shutdown(NODE_7379);                                              <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Shut down node at 7379 and cross fingers there is a replica in place that can take over.</td>
</tr>
</table>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="redis.repositories"><a class="anchor" href="index.html#redis.repositories"></a>13. Redis Repositories</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Working with Redis Repositories lets you seamlessly convert and store domain objects in Redis Hashes, apply custom mapping strategies, and use secondary indexes.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Redis Repositories require at least Redis Server version 2.8.0 and do not work with transactions. Make sure to use a <code>RedisTemplate</code> with <a href="index.html#tx.spring">disabled transaction support</a>.
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="redis.repositories.usage"><a class="anchor" href="index.html#redis.repositories.usage"></a>13.1. Usage</h3>
<div class="paragraph">
<p>Spring Data Redis lets you easily implement domain entities, as shown in the following example:</p>
</div>
<div class="exampleblock">
<div class="title">Example 9. Sample Person Entity</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">@RedisHash("people")
public class Person {

  @Id String id;
  String firstname;
  String lastname;
  Address address;
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>We have a pretty simple domain object here. Note that it has a <code>@RedisHash</code> annotation on its type and a property named <code>id</code> that is annotated with <code>org.springframework.data.annotation.Id</code>. Those two items are responsible for creating the actual key used to persist the hash.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Properties annotated with <code>@Id</code> as well as those named <code>id</code> are considered as the identifier properties. Those with the annotation are favored over others.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To now actually have a component responsible for storage and retrieval, we need to define a repository interface, as shown in the following example:</p>
</div>
<div class="exampleblock">
<div class="title">Example 10. Basic Repository Interface To Persist Person Entities</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">public interface PersonRepository extends CrudRepository&lt;Person, String&gt; {

}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>As our repository extends <code>CrudRepository</code>, it provides basic CRUD and finder operations. The thing we need in between to glue things together is the corresponding Spring configuration, shown in the following example:</p>
</div>
<div class="exampleblock">
<div class="title">Example 11. JavaConfig for Redis Repositories</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">@Configuration
@EnableRedisRepositories
public class ApplicationConfig {

  @Bean
  public RedisConnectionFactory connectionFactory() {
    return new JedisConnectionFactory();
  }

  @Bean
  public RedisTemplate&lt;?, ?&gt; redisTemplate() {

    RedisTemplate&lt;byte[], byte[]&gt; template = new RedisTemplate&lt;byte[], byte[]&gt;();
    return template;
  }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Given the preceding setup, we can inject <code>PersonRepository</code> into our components, as shown in the following example:</p>
</div>
<div class="exampleblock">
<div class="title">Example 12. Access to Person Entities</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">@Autowired PersonRepository repo;

public void basicCrudOperations() {

  Person rand = new Person("rand", "al'thor");
  rand.setAddress(new Address("emond's field", "andor"));

  repo.save(rand);                                         <i class="conum" data-value="1"></i><b>(1)</b>

  repo.findOne(rand.getId());                              <i class="conum" data-value="2"></i><b>(2)</b>

  repo.count();                                            <i class="conum" data-value="3"></i><b>(3)</b>

  repo.delete(rand);                                       <i class="conum" data-value="4"></i><b>(4)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Generates a new <code>id</code> if the current value is <code>null</code> or reuses an already set <code>id</code> value and stores properties of type <code>Person</code> inside the Redis Hash with a key that has a pattern of <code>keyspace:id</code>&#8201;&#8212;&#8201;in this case, it might be <code>people:5d67b7e1-8640-4475-beeb-c666fab4c0e5</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Uses the provided <code>id</code> to retrieve the object stored at <code>keyspace:id</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Counts the total number of entities available within the keyspace, <code>people</code>, defined by <code>@RedisHash</code> on <code>Person</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Removes the key for the given object from Redis.</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="mapping.fundamentals"><a class="anchor" href="index.html#mapping.fundamentals"></a>13.2. Object Mapping Fundamentals</h3>
<div class="paragraph">
<p>This section covers the fundamentals of Spring Data object mapping, object creation, field and property access, mutability and immutability.
Note, that this section only applies to Spring Data modules that do not use the object mapping of the underlying data store (like JPA).
Also be sure to consult the store-specific sections for store-specific object mapping, like indexes, customizing column or field names or the like.</p>
</div>
<div class="paragraph">
<p>Core responsibility of the Spring Data object mapping is to create instances of domain objects and map the store-native data structures onto those.
This means we need two fundamental steps:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Instance creation by using one of the constructors exposed.</p>
</li>
<li>
<p>Instance population to materialize all exposed properties.</p>
</li>
</ol>
</div>
<div class="sect3">
<h4 id="mapping.object-creation"><a class="anchor" href="index.html#mapping.object-creation"></a>13.2.1. Object creation</h4>
<div class="paragraph">
<p>Spring Data automatically tries to detect a persistent entity&#8217;s constructor to be used to materialize objects of that type.
The resolution algorithm works as follows:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>If there&#8217;s a no-argument constructor, it will be used.
Other constructors will be ignored.</p>
</li>
<li>
<p>If there&#8217;s a single constructor taking arguments, it will be used.</p>
</li>
<li>
<p>If there are multiple constructors taking arguments, the one to be used by Spring Data will have to be annotated with <code>@PersistenceConstructor</code>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The value resolution assumes constructor argument names to match the property names of the entity, i.e. the resolution will be performed as if the property was to be populated, including all customizations in mapping (different datastore column or field name etc.).
This also requires either parameter names information available in the class file or an <code>@ConstructorProperties</code> annotation being present on the constructor.</p>
</div>
<div class="paragraph">
<p>The value resolution can be customized by using Spring Framework&#8217;s <code>@Value</code> value annotation using a store-specific SpEL expression.
Please consult the section on store specific mappings for further details.</p>
</div>
<div id="mapping.object-creation.details" class="sidebarblock">
<div class="content">
<div class="title">Object creation internals</div>
<div class="paragraph">
<p>To avoid the overhead of reflection, Spring Data object creation uses a factory class generated at runtime by default, which will call the domain classes constructor directly.
I.e. for this example type:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">class Person {
  Person(String firstname, String lastname) { … }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>we will create a factory class semantically equivalent to this one at runtime:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">class PersonObjectInstantiator implements ObjectInstantiator {

  Object newInstance(Object... args) {
    return new Person((String) args[0], (String) args[1]);
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This gives us a roundabout 10% performance boost over reflection.
For the domain class to be eligible for such optimization, it needs to adhere to a set of constraints:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>it must not be a private class</p>
</li>
<li>
<p>it must not be a non-static inner class</p>
</li>
<li>
<p>it must not be a CGLib proxy class</p>
</li>
<li>
<p>the constructor to be used by Spring Data must not be private</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If any of these criteria match, Spring Data will fall back to entity instantiation via reflection.</p>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="mapping.property-population"><a class="anchor" href="index.html#mapping.property-population"></a>13.2.2. Property population</h4>
<div class="paragraph">
<p>Once an instance of the entity has been created, Spring Data populates all remaining persistent properties of that class.
Unless already populated by the entity&#8217;s constructor (i.e. consumed through its constructor argument list), the identifier property will be populated first to allow the resolution of cyclic object references.
After that, all non-transient properties that have not already been populated by the constructor are set on the entity instance.
For that we use the following algorithm:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>If the property is immutable but exposes a <code>with…</code> method (see below), we use the <code>with…</code> method to create a new entity instance with the new property value.</p>
</li>
<li>
<p>If property access (i.e. access through getters and setters) is defined, we&#8217;re invoking the setter method.</p>
</li>
<li>
<p>If the property is mutable we set the field directly.</p>
</li>
<li>
<p>If the property is immutable we&#8217;re using the constructor to be used by persistence operations (see <a href="index.html#mapping.object-creation">Object creation</a>) to create a copy of the instance.</p>
</li>
<li>
<p>By default, we set the field value directly.</p>
</li>
</ol>
</div>
<div id="mapping.property-population.details" class="sidebarblock">
<div class="content">
<div class="title">Property population internals</div>
<div class="paragraph">
<p>Similarly to our <a href="index.html#mapping.object-creation.details">optimizations in object construction</a> we also use Spring Data runtime generated accessor classes to interact with the entity instance.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">class Person {

  private final Long id;
  private String firstname;
  private @AccessType(Type.PROPERTY) String lastname;

  Person() {
    this.id = null;
  }

  Person(Long id, String firstname, String lastname) {
    // Field assignments
  }

  Person withId(Long id) {
    return new Person(id, this.firstname, this.lastame);
  }

  void setLastname(String lastname) {
    this.lastname = lastname;
  }
}</code></pre>
</div>
</div>
<div class="exampleblock">
<div class="title">Example 13. A generated Property Accessor</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">class PersonPropertyAccessor implements PersistentPropertyAccessor {

  private static final MethodHandle firstname;              <i class="conum" data-value="2"></i><b>(2)</b>

  private Person person;                                    <i class="conum" data-value="1"></i><b>(1)</b>

  public void setProperty(PersistentProperty property, Object value) {

    String name = property.getName();

    if ("firstname".equals(name)) {
      firstname.invoke(person, (String) value);             <i class="conum" data-value="2"></i><b>(2)</b>
    } else if ("id".equals(name)) {
      this.person = person.withId((Long) value);            <i class="conum" data-value="3"></i><b>(3)</b>
    } else if ("lastname".equals(name)) {
      this.person.setLastname((String) value);              <i class="conum" data-value="4"></i><b>(4)</b>
    }
  }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>PropertyAccessor&#8217;s hold a mutable instance of the underlying object. This is, to enable mutations of otherwise immutable properties.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>By default, Spring Data uses field-access to read and write property values. As per visibility rules of <code>private</code> fields, <code>MethodHandles</code> are used to interact with fields.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The class exposes a <code>withId(…)</code> method that&#8217;s used to set the identifier, e.g. when an instance is inserted into the datastore and an identifier has been generated. Calling <code>withId(…)</code> creates a new <code>Person</code> object. All subsequent mutations will take place in the new instance leaving the previous untouched.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Using property-access allows direct method invocations without using <code>MethodHandles</code>.</td>
</tr>
</table>
</div>
</div>
</div>
<div class="paragraph">
<p>This gives us a roundabout 25% performance boost over reflection.
For the domain class to be eligible for such optimization, it needs to adhere to a set of constraints:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Types must not reside in the default or under the <code>java</code> package.</p>
</li>
<li>
<p>Types and their constructors must be <code>public</code></p>
</li>
<li>
<p>Types that are inner classes must be <code>static</code>.</p>
</li>
<li>
<p>The used Java Runtime must allow for declaring classes in the originating <code>ClassLoader</code>. Java 9 and newer impose certain limitations.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>By default, Spring Data attempts to use generated property accessors and falls back to reflection-based ones if a limitation is detected.</p>
</div>
</div>
</div>
<div class="paragraph">
<p>Let&#8217;s have a look at the following entity:</p>
</div>
<div class="exampleblock">
<div class="title">Example 14. A sample entity</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">class Person {

  private final @Id Long id;                                                <i class="conum" data-value="1"></i><b>(1)</b>
  private final String firstname, lastname;                                 <i class="conum" data-value="2"></i><b>(2)</b>
  private final LocalDate birthday;
  private final int age;                                                    <i class="conum" data-value="3"></i><b>(3)</b>

  private String comment;                                                   <i class="conum" data-value="4"></i><b>(4)</b>
  private @AccessType(Type.PROPERTY) String remarks;                        <i class="conum" data-value="5"></i><b>(5)</b>

  static Person of(String firstname, String lastname, LocalDate birthday) { <i class="conum" data-value="6"></i><b>(6)</b>

    return new Person(null, firstname, lastname, birthday,
      Period.between(birthday, LocalDate.now()).getYears());
  }

  Person(Long id, String firstname, String lastname, LocalDate birthday, int age) { <i class="conum" data-value="6"></i><b>(6)</b>

    this.id = id;
    this.firstname = firstname;
    this.lastname = lastname;
    this.birthday = birthday;
    this.age = age;
  }

  Person withId(Long id) {                                                  <i class="conum" data-value="1"></i><b>(1)</b>
    return new Person(id, this.firstname, this.lastname, this.birthday, this.age);
  }

  void setRemarks(String remarks) {                                         <i class="conum" data-value="5"></i><b>(5)</b>
    this.remarks = remarks;
  }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The identifier property is final but set to <code>null</code> in the constructor.
The class exposes a <code>withId(…)</code> method that&#8217;s used to set the identifier, e.g. when an instance is inserted into the datastore and an identifier has been generated.
The original <code>Person</code> instance stays unchanged as a new one is created.
The same pattern is usually applied for other properties that are store managed but might have to be changed for persistence operations.
The wither method is optional as the persistence constructor (see 6) is effectively a copy constructor and setting the property will be translated into creating a fresh instance with the new identifier value applied.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The <code>firstname</code> and <code>lastname</code> properties are ordinary immutable properties potentially exposed through getters.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The <code>age</code> property is an immutable but derived one from the <code>birthday</code> property.
With the design shown, the database value will trump the defaulting as Spring Data uses the only declared constructor.
Even if the intent is that the calculation should be preferred, it&#8217;s important that this constructor also takes <code>age</code> as parameter (to potentially ignore it) as otherwise the property population step will attempt to set the age field and fail due to it being immutable and no <code>with…</code> method being present.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>The <code>comment</code> property is mutable is populated by setting its field directly.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>The <code>remarks</code> properties are mutable and populated by setting the <code>comment</code> field directly or by invoking the setter method for</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>The class exposes a factory method and a constructor for object creation.
The core idea here is to use factory methods instead of additional constructors to avoid the need for constructor disambiguation through <code>@PersistenceConstructor</code>.
Instead, defaulting of properties is handled within the factory method.</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="mapping.general-recommendations"><a class="anchor" href="index.html#mapping.general-recommendations"></a>13.2.3. General recommendations</h4>
<div class="ulist">
<ul>
<li>
<p><em>Try to stick to immutable objects</em>&#8201;&#8212;&#8201;Immutable objects are straightforward to create as materializing an object is then a matter of calling its constructor only.
Also, this avoids your domain objects to be littered with setter methods that allow client code to manipulate the objects state.
If you need those, prefer to make them package protected so that they can only be invoked by a limited amount of co-located types.
Constructor-only materialization is up to 30% faster than properties population.</p>
</li>
<li>
<p><em>Provide an all-args constructor</em>&#8201;&#8212;&#8201;Even if you cannot or don&#8217;t want to model your entities as immutable values, there&#8217;s still value in providing a constructor that takes all properties of the entity as arguments, including the mutable ones, as this allows the object mapping to skip the property population for optimal performance.</p>
</li>
<li>
<p><em>Use factory methods instead of overloaded constructors to avoid <code>@PersistenceConstructor</code></em>&#8201;&#8212;&#8201;With an all-argument constructor needed for optimal performance, we usually want to expose more application use case specific constructors that omit things like auto-generated identifiers etc.
It&#8217;s an established pattern to rather use static factory methods to expose these variants of the all-args constructor.</p>
</li>
<li>
<p><em>Make sure you adhere to the constraints that allow the generated instantiator and property accessor classes to be used</em>&#8201;&#8212;&#8201;</p>
</li>
<li>
<p><em>For identifiers to be generated, still use a final field in combination with an all-arguments persistence constructor (preferred) or a <code>with…</code> method</em>&#8201;&#8212;&#8201;</p>
</li>
<li>
<p><em>Use Lombok to avoid boilerplate code</em>&#8201;&#8212;&#8201;As persistence operations usually require a constructor taking all arguments, their declaration becomes a tedious repetition of boilerplate parameter to field assignments that can best be avoided by using Lombok&#8217;s <code>@AllArgsConstructor</code>.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="mapping.kotlin"><a class="anchor" href="index.html#mapping.kotlin"></a>13.2.4. Kotlin support</h4>
<div class="paragraph">
<p>Spring Data adapts specifics of Kotlin to allow object creation and mutation.</p>
</div>
<div class="sect4">
<h5>Kotlin object creation</h5>
<div class="paragraph">
<p>Kotlin classes are supported to be instantiated , all classes are immutable by default and require explicit property declarations to define mutable properties.
Consider the following <code>data</code> class <code>Person</code>:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="kotlin" class="language-kotlin hljs">data class Person(val id: String, val name: String)</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The class above compiles to a typical class with an explicit constructor.We can customize this class by adding another constructor and annotate it with <code>@PersistenceConstructor</code> to indicate a constructor preference:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="kotlin" class="language-kotlin hljs">data class Person(var id: String, val name: String) {

    @PersistenceConstructor
    constructor(id: String) : this(id, "unknown")
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Kotlin supports parameter optionality by allowing default values to be used if a parameter is not provided.
When Spring Data detects a constructor with parameter defaulting, then it leaves these parameters absent if the data store does not provide a value (or simply returns <code>null</code>) so Kotlin can apply parameter defaulting.Consider the following class that applies parameter defaulting for <code>name</code></p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="kotlin" class="language-kotlin hljs">data class Person(var id: String, val name: String = "unknown")</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Every time the <code>name</code> parameter is either not part of the result or its value is <code>null</code>, then the <code>name</code> defaults to <code>unknown</code>.</p>
</div>
</div>
<div class="sect4">
<h5>Property population of Kotlin data classes</h5>
<div class="paragraph">
<p>In Kotlin, all classes are immutable by default and require explicit property declarations to define mutable properties.
Consider the following <code>data</code> class <code>Person</code>:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="kotlin" class="language-kotlin hljs">data class Person(val id: String, val name: String)</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>This class is effectively immutable.
It allows creating new instances as Kotlin generates a <code>copy(…)</code> method that creates new object instances copying all property values from the existing object and applying property values provided as arguments to the method.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="redis.repositories.mapping"><a class="anchor" href="index.html#redis.repositories.mapping"></a>13.3. Object-to-Hash Mapping</h3>
<div class="paragraph">
<p>The Redis Repository support persists Objects to Hashes. This requires an Object-to-Hash conversion which is done by a <code>RedisConverter</code>. The default implementation uses <code>Converter</code> for mapping property values to and from Redis native <code>byte[]</code>.</p>
</div>
<div class="paragraph">
<p>Given the <code>Person</code> type from the previous sections, the default mapping looks like the following:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="text" class="language-text hljs">_class = org.example.Person                 <i class="conum" data-value="1"></i><b>(1)</b>
id = e2c7dcee-b8cd-4424-883e-736ce564363e
firstname = rand                            <i class="conum" data-value="2"></i><b>(2)</b>
lastname = al’thor
address.city = emond's field                <i class="conum" data-value="3"></i><b>(3)</b>
address.country = andor</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <code>_class</code> attribute is included on the root level as well as on any nested interface or abstract types.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Simple property values are mapped by path.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Properties of complex types are mapped by their dot path.</td>
</tr>
</table>
</div>
</div>
</div>
<div class="paragraph">
<p>The following table describes the default mapping rules:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 10. Default Mapping Rules</caption>
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 33.3333%;">
<col style="width: 50.0001%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Sample</th>
<th class="tableblock halign-left valign-top">Mapped Value</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Simple Type<br>
(for example, String)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String firstname = "rand";</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">firstname = "rand"</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Complex Type<br>
(for example, Address)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Address address = new Address("emond&#8217;s field");</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">address.city = "emond&#8217;s field"</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">List<br>
of Simple Type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">List&lt;String&gt; nicknames = asList("dragon reborn", "lews therin");</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">nicknames.[0] = "dragon reborn",<br>
nicknames.[1] = "lews therin"</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Map<br>
of Simple Type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Map&lt;String, String&gt; atts = asMap({"eye-color", "grey"}, {"&#8230;&#8203;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">atts.[eye-color] = "grey",<br>
atts.[hair-color] = "&#8230;&#8203;</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">List<br>
of Complex Type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">List&lt;Address&gt; addresses = asList(new Address("em&#8230;&#8203;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">addresses.[0].city = "emond&#8217;s field",<br>
addresses.[1].city = "&#8230;&#8203;</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Map<br>
of Complex Type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Map&lt;String, Address&gt; addresses = asMap({"home", new Address("em&#8230;&#8203;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">addresses.[home].city = "emond&#8217;s field",<br>
addresses.[work].city = "&#8230;&#8203;</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<i class="fa icon-caution" title="Caution"></i>
</td>
<td class="content">
Due to the flat representation structure, Map keys need to be simple types, such as <code>String</code> or <code>Number</code>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Mapping behavior can be customized by registering the corresponding <code>Converter</code> in <code>RedisCustomConversions</code>. Those converters can take care of converting from and to a single <code>byte[]</code> as well as <code>Map&lt;String,byte[]&gt;</code>. The first one is suitable for (for example) converting a complex type to (for example) a binary JSON representation that still uses the default mappings hash structure. The second option offers full control over the resulting hash.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Writing objects to a Redis hash deletes the content from the hash and re-creates the whole hash, so data that has not been mapped is lost.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The following example shows two sample byte array converters:</p>
</div>
<div class="exampleblock">
<div class="title">Example 15. Sample byte[] Converters</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">@WritingConverter
public class AddressToBytesConverter implements Converter&lt;Address, byte[]&gt; {

  private final Jackson2JsonRedisSerializer&lt;Address&gt; serializer;

  public AddressToBytesConverter() {

    serializer = new Jackson2JsonRedisSerializer&lt;Address&gt;(Address.class);
    serializer.setObjectMapper(new ObjectMapper());
  }

  @Override
  public byte[] convert(Address value) {
    return serializer.serialize(value);
  }
}

@ReadingConverter
public class BytesToAddressConverter implements Converter&lt;byte[], Address&gt; {

  private final Jackson2JsonRedisSerializer&lt;Address&gt; serializer;

  public BytesToAddressConverter() {

    serializer = new Jackson2JsonRedisSerializer&lt;Address&gt;(Address.class);
    serializer.setObjectMapper(new ObjectMapper());
  }

  @Override
  public Address convert(byte[] value) {
    return serializer.deserialize(value);
  }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Using the preceding byte array <code>Converter</code> produces output similar to the following:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="text" class="language-text hljs">_class = org.example.Person
id = e2c7dcee-b8cd-4424-883e-736ce564363e
firstname = rand
lastname = al’thor
address = { city : "emond's field", country : "andor" }</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The following example shows two examples of <code>Map</code> converters:</p>
</div>
<div class="exampleblock">
<div class="title">Example 16. Sample Map&lt;String,byte[]&gt; Converters</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">@WritingConverter
public class AddressToMapConverter implements Converter&lt;Address, Map&lt;String,byte[]&gt;&gt; {

  @Override
  public Map&lt;String,byte[]&gt; convert(Address source) {
    return singletonMap("ciudad", source.getCity().getBytes());
  }
}

@ReadingConverter
public class MapToAddressConverter implements Converter&lt;Address, Map&lt;String, byte[]&gt;&gt; {

  @Override
  public Address convert(Map&lt;String,byte[]&gt; source) {
    return new Address(new String(source.get("ciudad")));
  }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Using the preceding Map <code>Converter</code> produces output similar to the following:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="text" class="language-text hljs">_class = org.example.Person
id = e2c7dcee-b8cd-4424-883e-736ce564363e
firstname = rand
lastname = al’thor
ciudad = "emond's field"</code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Custom conversions have no effect on index resolution. <a href="index.html#redis.repositories.indexes">Secondary Indexes</a> are still created, even for custom converted types.
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4>13.3.1. Customizing Type Mapping</h4>
<div class="paragraph">
<p>If you want to avoid writing the entire Java class name as type information and would rather like to use a key, you can use the <code>@TypeAlias</code> annotation on the entity class being persisted. If you need to customize the mapping even more, look at the <a href="../../../../../commons/docs/current/api/org/springframework/data/convert/TypeInformationMapper.html"><code>TypeInformationMapper</code></a> interface. An instance of that interface can be configured at the <code>DefaultRedisTypeMapper</code>, which can be configured on <code>MappingRedisConverter</code>.</p>
</div>
<div class="paragraph">
<p>The following example shows how to define a type alias for an entity:</p>
</div>
<div class="exampleblock">
<div class="title">Example 17. Defining <code>@TypeAlias</code> for an entity</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">@TypeAlias("pers")
class Person {

}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The resulting document contains <code>pers</code> as the value in a <code>_class</code> field.</p>
</div>
<div class="sect4">
<h5>Configuring Custom Type Mapping</h5>
<div class="paragraph">
<p>The following example demonstrates how to configure a custom <code>RedisTypeMapper</code> in <code>MappingRedisConverter</code>:</p>
</div>
<div class="exampleblock">
<div class="title">Example 18. Configuring a custom <code>RedisTypeMapper</code> via Spring Java Config</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">class CustomRedisTypeMapper extends DefaultRedisTypeMapper {
  //implement custom type mapping here
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">@Configuration
class SampleRedisConfiguration {

  @Bean
  public MappingRedisConverter redisConverter(RedisMappingContext mappingContext,
        RedisCustomConversions customConversions, ReferenceResolver referenceResolver) {

    MappingRedisConverter mappingRedisConverter = new MappingRedisConverter(mappingContext, null, referenceResolver,
            customTypeMapper());

    mappingRedisConverter.setCustomConversions(customConversions);

    return mappingRedisConverter;
  }

  @Bean
  public RedisTypeMapper customTypeMapper() {
    return new CustomRedisTypeMapper();
  }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="redis.repositories.keyspaces"><a class="anchor" href="index.html#redis.repositories.keyspaces"></a>13.4. Keyspaces</h3>
<div class="paragraph">
<p>Keyspaces define prefixes used to create the actual key for the Redis Hash.
By default, the prefix is set to <code>getClass().getName()</code>. You can alter this default by setting <code>@RedisHash</code> on the aggregate root level or by setting up a programmatic configuration. However, the annotated keyspace supersedes any other configuration.</p>
</div>
<div class="paragraph">
<p>The following example shows how to set the keyspace configuration with the <code>@EnableRedisRepositories</code> annotation:</p>
</div>
<div class="exampleblock">
<div class="title">Example 19. Keyspace Setup via <code>@EnableRedisRepositories</code></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">@Configuration
@EnableRedisRepositories(keyspaceConfiguration = MyKeyspaceConfiguration.class)
public class ApplicationConfig {

  //... RedisConnectionFactory and RedisTemplate Bean definitions omitted

  public static class MyKeyspaceConfiguration extends KeyspaceConfiguration {

    @Override
    protected Iterable&lt;KeyspaceSettings&gt; initialConfiguration() {
      return Collections.singleton(new KeyspaceSettings(Person.class, "people"));
    }
  }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The following example shows how to programmatically set the keyspace:</p>
</div>
<div class="exampleblock">
<div class="title">Example 20. Programmatic Keyspace setup</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">@Configuration
@EnableRedisRepositories
public class ApplicationConfig {

  //... RedisConnectionFactory and RedisTemplate Bean definitions omitted

  @Bean
  public RedisMappingContext keyValueMappingContext() {
    return new RedisMappingContext(
      new MappingConfiguration(new IndexConfiguration(), new MyKeyspaceConfiguration()));
  }

  public static class MyKeyspaceConfiguration extends KeyspaceConfiguration {

    @Override
    protected Iterable&lt;KeyspaceSettings&gt; initialConfiguration() {
      return Collections.singleton(new KeyspaceSettings(Person.class, "people"));
    }
  }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="redis.repositories.indexes"><a class="anchor" href="index.html#redis.repositories.indexes"></a>13.5. Secondary Indexes</h3>
<div class="paragraph">
<p><a href="https://redis.io/topics/indexes">Secondary indexes</a> are used to enable lookup operations based on native Redis structures. Values are written to the according indexes on every save and are removed when objects are deleted or <a href="index.html#redis.repositories.expirations">expire</a>.</p>
</div>
<div class="sect3">
<h4 id="redis.repositories.indexes.simple"><a class="anchor" href="index.html#redis.repositories.indexes.simple"></a>13.5.1. Simple Property Index</h4>
<div class="paragraph">
<p>Given the sample <code>Person</code> entity shown earlier, we can create an index for <code>firstname</code> by annotating the property with <code>@Indexed</code>, as shown in the following example:</p>
</div>
<div class="exampleblock">
<div class="title">Example 21. Annotation driven indexing</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">@RedisHash("people")
public class Person {

  @Id String id;
  @Indexed String firstname;
  String lastname;
  Address address;
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Indexes are built up for actual property values. Saving two Persons (for example, "rand" and "aviendha") results in setting up indexes similar to the following:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="text" class="language-text hljs">SADD people:firstname:rand e2c7dcee-b8cd-4424-883e-736ce564363e
SADD people:firstname:aviendha a9d4b3a0-50d3-4538-a2fc-f7fc2581ee56</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>It is also possible to have indexes on nested elements. Assume <code>Address</code> has a <code>city</code> property that is annotated with <code>@Indexed</code>. In that case, once <code>person.address.city</code> is not <code>null</code>, we have Sets for each city, as shown in the following example:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="text" class="language-text hljs">SADD people:address.city:tear e2c7dcee-b8cd-4424-883e-736ce564363e</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Furthermore, the programmatic setup lets you define indexes on map keys and list properties, as shown in the following example:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">@RedisHash("people")
public class Person {

  // ... other properties omitted

  Map&lt;String,String&gt; attributes;      <i class="conum" data-value="1"></i><b>(1)</b>
  Map&lt;String Person&gt; relatives;       <i class="conum" data-value="2"></i><b>(2)</b>
  List&lt;Address&gt; addresses;            <i class="conum" data-value="3"></i><b>(3)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>SADD people:attributes.map-key:map-value e2c7dcee-b8cd-4424-883e-736ce564363e</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td><code>SADD people:relatives.map-key.firstname:tam e2c7dcee-b8cd-4424-883e-736ce564363e</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td><code>SADD people:addresses.city:tear e2c7dcee-b8cd-4424-883e-736ce564363e</code></td>
</tr>
</table>
</div>
</div>
</div>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<i class="fa icon-caution" title="Caution"></i>
</td>
<td class="content">
Indexes cannot be resolved on <a href="index.html#redis.repositories.references">References</a>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>As with keyspaces, you can configure indexes without needing to annotate the actual domain type, as shown in the following example:</p>
</div>
<div class="exampleblock">
<div class="title">Example 22. Index Setup with @EnableRedisRepositories</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">@Configuration
@EnableRedisRepositories(indexConfiguration = MyIndexConfiguration.class)
public class ApplicationConfig {

  //... RedisConnectionFactory and RedisTemplate Bean definitions omitted

  public static class MyIndexConfiguration extends IndexConfiguration {

    @Override
    protected Iterable&lt;IndexDefinition&gt; initialConfiguration() {
      return Collections.singleton(new SimpleIndexDefinition("people", "firstname"));
    }
  }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Again, as with keyspaces, you can programmatically configure indexes, as shown in the following example:</p>
</div>
<div class="exampleblock">
<div class="title">Example 23. Programmatic Index setup</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">@Configuration
@EnableRedisRepositories
public class ApplicationConfig {

  //... RedisConnectionFactory and RedisTemplate Bean definitions omitted

  @Bean
  public RedisMappingContext keyValueMappingContext() {
    return new RedisMappingContext(
      new MappingConfiguration(
        new KeyspaceConfiguration(), new MyIndexConfiguration()));
  }

  public static class MyIndexConfiguration extends IndexConfiguration {

    @Override
    protected Iterable&lt;IndexDefinition&gt; initialConfiguration() {
      return Collections.singleton(new SimpleIndexDefinition("people", "firstname"));
    }
  }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="redis.repositories.indexes.geospatial"><a class="anchor" href="index.html#redis.repositories.indexes.geospatial"></a>13.5.2. Geospatial Index</h4>
<div class="paragraph">
<p>Assume the <code>Address</code> type contains a <code>location</code> property of type <code>Point</code> that holds the geo coordinates of the particular address. By annotating the property with <code>@GeoIndexed</code>, Spring Data Redis adds those values by using Redis <code>GEO</code> commands, as shown in the following example:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">@RedisHash("people")
public class Person {

  Address address;

  // ... other properties omitted
}

public class Address {

  @GeoIndexed Point location;

  // ... other properties omitted
}

public interface PersonRepository extends CrudRepository&lt;Person, String&gt; {

  List&lt;Person&gt; findByAddressLocationNear(Point point, Distance distance);     <i class="conum" data-value="1"></i><b>(1)</b>
  List&lt;Person&gt; findByAddressLocationWithin(Circle circle);                    <i class="conum" data-value="2"></i><b>(2)</b>
}

Person rand = new Person("rand", "al'thor");
rand.setAddress(new Address(new Point(13.361389D, 38.115556D)));

repository.save(rand);                                                        <i class="conum" data-value="3"></i><b>(3)</b>

repository.findByAddressLocationNear(new Point(15D, 37D), new Distance(200)); <i class="conum" data-value="4"></i><b>(4)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Query method declaration on a nested property, using <code>Point</code> and <code>Distance</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Query method declaration on a nested property, using <code>Circle</code> to search within.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td><code>GEOADD people:address:location 13.361389 38.115556 e2c7dcee-b8cd-4424-883e-736ce564363e</code></td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td><code>GEORADIUS people:address:location 15.0 37.0 200.0 km</code></td>
</tr>
</table>
</div>
</div>
</div>
<div class="paragraph">
<p>In the preceding example the, longitude and latitude values are stored by using <code>GEOADD</code> that use the object&#8217;s <code>id</code> as the member&#8217;s name. The finder methods allow usage of <code>Circle</code> or <code>Point, Distance</code> combinations for querying those values.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
It is <strong>not</strong> possible to combine <code>near</code> and <code>within</code> with other criteria.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="query-by-example"><a class="anchor" href="index.html#query-by-example"></a>13.6. Query by Example</h3>
<div class="sect3">
<h4 id="query-by-example.introduction"><a class="anchor" href="index.html#query-by-example.introduction"></a>13.6.1. Introduction</h4>
<div class="paragraph">
<p>This chapter provides an introduction to Query by Example and explains how to use it.</p>
</div>
<div class="paragraph">
<p>Query by Example (QBE) is a user-friendly querying technique with a simple interface.
It allows dynamic query creation and does not require you to write queries that contain field names.
In fact, Query by Example does not require you to write queries by using store-specific query languages at all.</p>
</div>
</div>
<div class="sect3">
<h4 id="query-by-example.usage"><a class="anchor" href="index.html#query-by-example.usage"></a>13.6.2. Usage</h4>
<div class="paragraph">
<p>The Query by Example API consists of three parts:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Probe: The actual example of a domain object with populated fields.</p>
</li>
<li>
<p><code>ExampleMatcher</code>: The <code>ExampleMatcher</code> carries details on how to match particular fields.
It can be reused across multiple Examples.</p>
</li>
<li>
<p><code>Example</code>: An <code>Example</code> consists of the probe and the <code>ExampleMatcher</code>.
It is used to create the query.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Query by Example is well suited for several use cases:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Querying your data store with a set of static or dynamic constraints.</p>
</li>
<li>
<p>Frequent refactoring of the domain objects without worrying about breaking existing queries.</p>
</li>
<li>
<p>Working independently from the underlying data store API.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Query by Example also has several limitations:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>No support for nested or grouped property constraints, such as <code>firstname = ?0 or (firstname = ?1 and lastname = ?2)</code>.</p>
</li>
<li>
<p>Only supports starts/contains/ends/regex matching for strings and exact matching for other property types.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Before getting started with Query by Example, you need to have a domain object.
To get started, create an interface for your repository, as shown in the following example:</p>
</div>
<div class="exampleblock">
<div class="title">Example 24. Sample Person object</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">public class Person {

  @Id
  private String id;
  private String firstname;
  private String lastname;
  private Address address;

  // … getters and setters omitted
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The preceding example shows a simple domain object.
You can use it to create an <code>Example</code>.
By default, fields having <code>null</code> values are ignored, and strings are matched by using the store specific defaults.
Examples can be built by either using the <code>of</code> factory method or by using <a href="index.html#query-by-example.matchers"><code>ExampleMatcher</code></a>. <code>Example</code> is immutable.
The following listing shows a simple Example:</p>
</div>
<div class="exampleblock">
<div class="title">Example 25. Simple Example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">Person person = new Person();                         <i class="conum" data-value="1"></i><b>(1)</b>
person.setFirstname("Dave");                          <i class="conum" data-value="2"></i><b>(2)</b>

Example&lt;Person&gt; example = Example.of(person);         <i class="conum" data-value="3"></i><b>(3)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Create a new instance of the domain object.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Set the properties to query.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Create the <code>Example</code>.</td>
</tr>
</table>
</div>
</div>
</div>
<div class="paragraph">
<p>You can run the example queries by using repositories.
To do so, let your repository interface extend <code>QueryByExampleExecutor&lt;T&gt;</code>.
The following listing shows an excerpt from the <code>QueryByExampleExecutor</code> interface:</p>
</div>
<div class="exampleblock">
<div class="title">Example 26. The <code>QueryByExampleExecutor</code></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">public interface QueryByExampleExecutor&lt;T&gt; {

  &lt;S extends T&gt; S findOne(Example&lt;S&gt; example);

  &lt;S extends T&gt; Iterable&lt;S&gt; findAll(Example&lt;S&gt; example);

  // … more functionality omitted.
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="query-by-example.matchers"><a class="anchor" href="index.html#query-by-example.matchers"></a>13.6.3. Example Matchers</h4>
<div class="paragraph">
<p>Examples are not limited to default settings.
You can specify your own defaults for string matching, null handling, and property-specific settings by using the <code>ExampleMatcher</code>, as shown in the following example:</p>
</div>
<div class="exampleblock">
<div class="title">Example 27. Example matcher with customized matching</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">Person person = new Person();                          <i class="conum" data-value="1"></i><b>(1)</b>
person.setFirstname("Dave");                           <i class="conum" data-value="2"></i><b>(2)</b>

ExampleMatcher matcher = ExampleMatcher.matching()     <i class="conum" data-value="3"></i><b>(3)</b>
  .withIgnorePaths("lastname")                         <i class="conum" data-value="4"></i><b>(4)</b>
  .withIncludeNullValues()                             <i class="conum" data-value="5"></i><b>(5)</b>
  .withStringMatcherEnding();                          <i class="conum" data-value="6"></i><b>(6)</b>

Example&lt;Person&gt; example = Example.of(person, matcher); <i class="conum" data-value="7"></i><b>(7)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Create a new instance of the domain object.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Set properties.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Create an <code>ExampleMatcher</code> to expect all values to match.
It is usable at this stage even without further configuration.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Construct a new <code>ExampleMatcher</code> to ignore the <code>lastname</code> property path.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Construct a new <code>ExampleMatcher</code> to ignore the <code>lastname</code> property path and to include null values.</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>Construct a new <code>ExampleMatcher</code> to ignore the <code>lastname</code> property path, to include null values, and to perform suffix string matching.</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>Create a new <code>Example</code> based on the domain object and the configured <code>ExampleMatcher</code>.</td>
</tr>
</table>
</div>
</div>
</div>
<div class="paragraph">
<p>By default, the <code>ExampleMatcher</code> expects all values set on the probe to match.
If you want to get results matching any of the predicates defined implicitly, use <code>ExampleMatcher.matchingAny()</code>.</p>
</div>
<div class="paragraph">
<p>You can specify behavior for individual properties (such as "firstname" and "lastname" or, for nested properties, "address.city").
You can tune it with matching options and case sensitivity, as shown in the following example:</p>
</div>
<div class="exampleblock">
<div class="title">Example 28. Configuring matcher options</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">ExampleMatcher matcher = ExampleMatcher.matching()
  .withMatcher("firstname", endsWith())
  .withMatcher("lastname", startsWith().ignoreCase());
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Another way to configure matcher options is to use lambdas (introduced in Java 8).
This approach creates a callback that asks the implementor to modify the matcher.
You need not return the matcher, because configuration options are held within the matcher instance.
The following example shows a matcher that uses lambdas:</p>
</div>
<div class="exampleblock">
<div class="title">Example 29. Configuring matcher options with lambdas</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">ExampleMatcher matcher = ExampleMatcher.matching()
  .withMatcher("firstname", match -&gt; match.endsWith())
  .withMatcher("firstname", match -&gt; match.startsWith());
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Queries created by <code>Example</code> use a merged view of the configuration.
Default matching settings can be set at the <code>ExampleMatcher</code> level, while individual settings can be applied to particular property paths.
Settings that are set on <code>ExampleMatcher</code> are inherited by property path settings unless they are defined explicitly.
Settings on a property patch have higher precedence than default settings.
The following table describes the scope of the various <code>ExampleMatcher</code> settings:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 11. Scope of <code>ExampleMatcher</code> settings</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 66.6667%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Setting</th>
<th class="tableblock halign-left valign-top">Scope</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Null-handling</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ExampleMatcher</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">String matching</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ExampleMatcher</code> and property path</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ignoring properties</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Property path</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Case sensitivity</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ExampleMatcher</code> and property path</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Value transformation</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Property path</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="query-by-example.running"><a class="anchor" href="index.html#query-by-example.running"></a>13.6.4. Running an Example</h4>
<div class="paragraph">
<p>The following example uses Query by Example against a repository:</p>
</div>
<div class="exampleblock">
<div class="title">Example 30. Query by Example using a Repository</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">interface PersonRepository extends QueryByExampleExecutor&lt;Person&gt; {
}

class PersonService {

  @Autowired PersonRepository personRepository;

  List&lt;Person&gt; findPeople(Person probe) {
    return personRepository.findAll(Example.of(probe));
  }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Redis Repositories support, with their secondary indexes, a subset of Spring Data&#8217;s Query by Example features.
In particular, only exact, case-sensitive, and non-null values are used to construct a query.</p>
</div>
<div class="paragraph">
<p>Secondary indexes use set-based operations (Set intersection, Set union) to determine matching keys. Adding a property to the query that is not indexed returns no result, because no index exists. Query by Example support inspects indexing configuration to include only properties in the query that are covered by an index. This is to prevent accidental inclusion of non-indexed properties.</p>
</div>
<div class="paragraph">
<p>Case-insensitive queries and unsupported <code>StringMatcher</code> instances are rejected at runtime.</p>
</div>
<div class="paragraph">
<p>The following list shows the supported Query by Example options:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Case-sensitive, exact matching of simple and nested properties</p>
</li>
<li>
<p>Any/All match modes</p>
</li>
<li>
<p>Value transformation of the criteria value</p>
</li>
<li>
<p>Exclusion of <code>null</code> values from the criteria</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The following list shows properties not supported by Query by Example:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Case-insensitive matching</p>
</li>
<li>
<p>Regex, prefix/contains/suffix String-matching</p>
</li>
<li>
<p>Querying of Associations, Collection, and Map-like properties</p>
</li>
<li>
<p>Inclusion of <code>null</code> values from the criteria</p>
</li>
<li>
<p><code>findAll</code> with sorting</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="redis.repositories.expirations"><a class="anchor" href="index.html#redis.repositories.expirations"></a>13.7. Time To Live</h3>
<div class="paragraph">
<p>Objects stored in Redis may be valid only for a certain amount of time. This is especially useful for persisting short-lived objects in Redis without having to remove them manually when they reach their end of life. The expiration time in seconds can be set with <code>@RedisHash(timeToLive=&#8230;&#8203;)</code> as well as by using <code>KeyspaceSettings</code> (see <a href="index.html#redis.repositories.keyspaces">Keyspaces</a>).</p>
</div>
<div class="paragraph">
<p>More flexible expiration times can be set by using the <code>@TimeToLive</code> annotation on either a numeric property or a method. However, do not apply <code>@TimeToLive</code> on both a method and a property within the same class. The following example shows the <code>@TimeToLive</code> annotation on a property and on a method:</p>
</div>
<div class="exampleblock">
<div class="title">Example 31. Expirations</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">public class TimeToLiveOnProperty {

  @Id
  private String id;

  @TimeToLive
  private Long expiration;
}

public class TimeToLiveOnMethod {

  @Id
  private String id;

  @TimeToLive
  public long getTimeToLive() {
  	return new Random().nextLong();
  }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Annotating a property explicitly with <code>@TimeToLive</code> reads back the actual <code>TTL</code> or <code>PTTL</code> value from Redis. -1 indicates that the object has no associated expiration.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The repository implementation ensures subscription to <a href="https://redis.io/topics/notifications">Redis keyspace notifications</a> via <code>RedisMessageListenerContainer</code>.</p>
</div>
<div class="paragraph">
<p>When the expiration is set to a positive value, the corresponding <code>EXPIRE</code> command is run. In addition to persisting the original, a phantom copy is persisted in Redis and set to expire five minutes after the original one. This is done to enable the Repository support to publish <code>RedisKeyExpiredEvent</code>, holding the expired value in Spring&#8217;s <code>ApplicationEventPublisher</code> whenever a key expires, even though the original values have already been removed. Expiry events are received on all connected applications that use Spring Data Redis repositories.</p>
</div>
<div class="paragraph">
<p>By default, the key expiry listener is disabled when initializing the application. The startup mode can be adjusted in <code>@EnableRedisRepositories</code> or <code>RedisKeyValueAdapter</code> to start the listener with the application or upon the first insert of an entity with a TTL. See <a href="../../../2.4.1/api/org/springframework/data/redis/core/RedisKeyValueAdapter.EnableKeyspaceEvents.html"><code>EnableKeyspaceEvents</code></a> for possible values.</p>
</div>
<div class="paragraph">
<p>The <code>RedisKeyExpiredEvent</code> holds a copy of the expired domain object as well as the key.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Delaying or disabling the expiry event listener startup impacts <code>RedisKeyExpiredEvent</code> publishing. A disabled event listener does not publish expiry events. A delayed startup can cause loss of events because of the delayed listener initialization.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The keyspace notification message listener alters <code>notify-keyspace-events</code> settings in Redis, if those are not already set. Existing settings are not overridden, so you must set up those settings correctly (or leave them empty). Note that <code>CONFIG</code> is disabled on AWS ElastiCache, and enabling the listener leads to an error.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Redis Pub/Sub messages are not persistent. If a key expires while the application is down, the expiry event is not processed, which may lead to secondary indexes containing references to the expired object.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<code>@EnableKeyspaceEvents(shadowCopy = OFF)</code> disable storage of phantom copies and reduces data size within Redis. <code>RedisKeyExpiredEvent</code> will only contain the <code>id</code> of the expired key.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="redis.repositories.references"><a class="anchor" href="index.html#redis.repositories.references"></a>13.8. Persisting References</h3>
<div class="paragraph">
<p>Marking properties with <code>@Reference</code> allows storing a simple key reference instead of copying values into the hash itself.
On loading from Redis, references are resolved automatically and mapped back into the object, as shown in the following example:</p>
</div>
<div class="exampleblock">
<div class="title">Example 32. Sample Property Reference</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="text" class="language-text hljs">_class = org.example.Person
id = e2c7dcee-b8cd-4424-883e-736ce564363e
firstname = rand
lastname = al’thor
mother = people:a9d4b3a0-50d3-4538-a2fc-f7fc2581ee56      <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Reference stores the whole key (<code>keyspace:id</code>) of the referenced object.</td>
</tr>
</table>
</div>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Referenced Objects are not persisted when the referencing object is saved. You must persist changes on referenced objects separately, since only the reference is stored. Indexes set on properties of referenced types are not resolved.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="redis.repositories.partial-updates"><a class="anchor" href="index.html#redis.repositories.partial-updates"></a>13.9. Persisting Partial Updates</h3>
<div class="paragraph">
<p>In some cases, you need not load and rewrite the entire entity just to set a new value within it. A session timestamp for the last active time might be such a scenario where you want to alter one property.
<code>PartialUpdate</code> lets you define <code>set</code> and <code>delete</code> actions on existing objects while taking care of updating potential expiration times of both the entity itself and index structures. The following example shows a partial update:</p>
</div>
<div class="exampleblock">
<div class="title">Example 33. Sample Partial Update</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">PartialUpdate&lt;Person&gt; update = new PartialUpdate&lt;Person&gt;("e2c7dcee", Person.class)
  .set("firstname", "mat")                                                           <i class="conum" data-value="1"></i><b>(1)</b>
  .set("address.city", "emond's field")                                              <i class="conum" data-value="2"></i><b>(2)</b>
  .del("age");                                                                       <i class="conum" data-value="3"></i><b>(3)</b>

template.update(update);

update = new PartialUpdate&lt;Person&gt;("e2c7dcee", Person.class)
  .set("address", new Address("caemlyn", "andor"))                                   <i class="conum" data-value="4"></i><b>(4)</b>
  .set("attributes", singletonMap("eye-color", "grey"));                             <i class="conum" data-value="5"></i><b>(5)</b>

template.update(update);

update = new PartialUpdate&lt;Person&gt;("e2c7dcee", Person.class)
  .refreshTtl(true);                                                                 <i class="conum" data-value="6"></i><b>(6)</b>
  .set("expiration", 1000);

template.update(update);</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Set the simple <code>firstname</code> property to <code>mat</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Set the simple 'address.city' property to 'emond&#8217;s field' without having to pass in the entire object. This does not work when a custom conversion is registered.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Remove the <code>age</code> property.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Set complex <code>address</code> property.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Set a map of values, which removes the previously existing map and replaces the values with the given ones.</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>Automatically update the server expiration time when altering <a href="index.html#redis.repositories.expirations">Time To Live</a>.</td>
</tr>
</table>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Updating complex objects as well as map (or other collection) structures requires further interaction with Redis to determine existing values, which means that rewriting the entire entity might be faster.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="redis.repositories.queries"><a class="anchor" href="index.html#redis.repositories.queries"></a>13.10. Queries and Query Methods</h3>
<div class="paragraph">
<p>Query methods allow automatic derivation of simple finder queries from the method name, as shown in the following example:</p>
</div>
<div class="exampleblock">
<div class="title">Example 34. Sample Repository finder Method</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">public interface PersonRepository extends CrudRepository&lt;Person, String&gt; {

  List&lt;Person&gt; findByFirstname(String firstname);
}</code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Please make sure properties used in finder methods are set up for indexing.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Query methods for Redis repositories support only queries for entities and collections of entities with paging.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Using derived query methods might not always be sufficient to model the queries to run. <code>RedisCallback</code> offers more control over the actual matching of index structures or even custom indexes. To do so, provide a <code>RedisCallback</code> that returns a single or <code>Iterable</code> set of <code>id</code> values, as shown in the following example:</p>
</div>
<div class="exampleblock">
<div class="title">Example 35. Sample finder using RedisCallback</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">String user = //...

List&lt;RedisSession&gt; sessionsByUser = template.find(new RedisCallback&lt;Set&lt;byte[]&gt;&gt;() {

  public Set&lt;byte[]&gt; doInRedis(RedisConnection connection) throws DataAccessException {
    return connection
      .sMembers("sessions:securityContext.authentication.principal.username:" + user);
  }}, RedisSession.class);</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The following table provides an overview of the keywords supported for Redis and what a method containing that keyword essentially translates to:</p>
</div>
<div class="exampleblock">
<div class="content">
<table class="tableblock frame-all grid-all fit-content">
<caption class="title">Table 12. Supported keywords inside method names</caption>
<colgroup>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Keyword</th>
<th class="tableblock halign-left valign-top">Sample</th>
<th class="tableblock halign-left valign-top">Redis snippet</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>And</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>findByLastnameAndFirstname</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SINTER …:firstname:rand …:lastname:al’thor</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Or</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>findByLastnameOrFirstname</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SUNION …:firstname:rand …:lastname:al’thor</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Is, Equals</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>findByFirstname</code>, <code>findByFirstnameIs</code>, <code>findByFirstnameEquals</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SINTER …:firstname:rand</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>IsTrue</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>FindByAliveIsTrue</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SINTER …:alive:1</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>IsFalse</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>findByAliveIsFalse</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SINTER …:alive:0</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Top,First</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>findFirst10ByFirstname</code>,<code>findTop5ByFirstname</code></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="redis.repositories.cluster"><a class="anchor" href="index.html#redis.repositories.cluster"></a>13.11. Redis Repositories Running on a Cluster</h3>
<div class="paragraph">
<p>You can use the Redis repository support in a clustered Redis environment. See the &#8220;<a href="index.html#cluster">Redis Cluster</a>&#8221; section for <code>ConnectionFactory</code> configuration details. Still, some additional configuration must be done, because the default key distribution spreads entities and secondary indexes through out the whole cluster and its slots.</p>
</div>
<div class="paragraph">
<p>The following table shows the details of data on a cluster (based on previous examples):</p>
</div>
<table class="tableblock frame-all grid-all fit-content">
<colgroup>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Key</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Slot</th>
<th class="tableblock halign-left valign-top">Node</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">people:e2c7dcee-b8cd-4424-883e-736ce564363e</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">id for hash</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">15171</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">127.0.0.1:7381</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">people:a9d4b3a0-50d3-4538-a2fc-f7fc2581ee56</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">id for hash</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">7373</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">127.0.0.1:7380</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">people:firstname:rand</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">index</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1700</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">127.0.0.1:7379</p></td>
</tr>
</tbody>
</table>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>Some commands (such as <code>SINTER</code> and <code>SUNION</code>) can only be processed on the server side when all involved keys map to the same slot. Otherwise, computation has to be done on client side. Therefore, it is useful to pin keyspaces to a single slot, which lets make use of Redis server side computation right away. The following table shows what happens when you do (note the change in the slot column and the port value in the node column):</p>
</div>
<table class="tableblock frame-all grid-all fit-content">
<colgroup>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Key</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Slot</th>
<th class="tableblock halign-left valign-top">Node</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">{people}:e2c7dcee-b8cd-4424-883e-736ce564363e</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">id for hash</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2399</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">127.0.0.1:7379</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">{people}:a9d4b3a0-50d3-4538-a2fc-f7fc2581ee56</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">id for hash</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2399</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">127.0.0.1:7379</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">{people}:firstname:rand</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">index</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2399</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">127.0.0.1:7379</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Define and pin keyspaces by using <code>@RedisHash("{yourkeyspace}")</code> to specific slots when you use Redis cluster.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="redis.repositories.cdi-integration"><a class="anchor" href="index.html#redis.repositories.cdi-integration"></a>13.12. CDI Integration</h3>
<div class="paragraph">
<p>Instances of the repository interfaces are usually created by a container, for which Spring is the most natural choice when working with Spring Data. Spring offers sophisticated for creating bean instances. Spring Data Redis ships with a custom CDI extension that lets you use the repository abstraction in CDI environments. The extension is part of the JAR, so, to activate it, drop the Spring Data Redis JAR into your classpath.</p>
</div>
<div class="paragraph">
<p>You can then set up the infrastructure by implementing a CDI Producer for the <code>RedisConnectionFactory</code> and <code>RedisOperations</code>, as shown in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">class RedisOperationsProducer {


  @Produces
  RedisConnectionFactory redisConnectionFactory() {

    JedisConnectionFactory jedisConnectionFactory = new JedisConnectionFactory(new RedisStandaloneConfiguration());
    jedisConnectionFactory.afterPropertiesSet();

    return jedisConnectionFactory;
  }

  void disposeRedisConnectionFactory(@Disposes RedisConnectionFactory redisConnectionFactory) throws Exception {

    if (redisConnectionFactory instanceof DisposableBean) {
      ((DisposableBean) redisConnectionFactory).destroy();
    }
  }

  @Produces
  @ApplicationScoped
  RedisOperations&lt;byte[], byte[]&gt; redisOperationsProducer(RedisConnectionFactory redisConnectionFactory) {

    RedisTemplate&lt;byte[], byte[]&gt; template = new RedisTemplate&lt;byte[], byte[]&gt;();
    template.setConnectionFactory(redisConnectionFactory);
    template.afterPropertiesSet();

    return template;
  }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The necessary setup can vary, depending on your JavaEE environment.</p>
</div>
<div class="paragraph">
<p>The Spring Data Redis CDI extension picks up all available repositories as CDI beans and creates a proxy for a Spring Data repository whenever a bean of a repository type is requested by the container. Thus, obtaining an instance of a Spring Data repository is a matter of declaring an <code>@Injected</code> property, as shown in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">class RepositoryClient {

  @Inject
  PersonRepository repository;

  public void businessMethod() {
    List&lt;Person&gt; people = repository.findAll();
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>A Redis Repository requires <code>RedisKeyValueAdapter</code> and <code>RedisKeyValueTemplate</code> instances. These beans are created and managed by the Spring Data CDI extension if no provided beans are found. You can, however, supply your own beans to configure the specific properties of <code>RedisKeyValueAdapter</code> and <code>RedisKeyValueTemplate</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="redis.repositories.anatomy"><a class="anchor" href="index.html#redis.repositories.anatomy"></a>13.13. Redis Repositories Anatomy</h3>
<div class="paragraph">
<p>Redis as a store itself offers a very narrow low-level API leaving higher level functions, such as secondary indexes and
query operations, up to the user.</p>
</div>
<div class="paragraph">
<p>This section provides a more detailed view of commands issued by the repository abstraction for a better understanding of
potential performance implications.</p>
</div>
<div class="paragraph">
<p>Consider the following entity class as the starting point for all operations:</p>
</div>
<div class="exampleblock">
<div class="title">Example 36. Example entity</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">@RedisHash("people")
public class Person {

  @Id String id;
  @Indexed String firstname;
  String lastname;
  Address hometown;
}

public class Address {

  @GeoIndexed Point location;
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="redis.repositories.anatomy.insert"><a class="anchor" href="index.html#redis.repositories.anatomy.insert"></a>13.13.1. Insert new</h4>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">repository.save(new Person("rand", "al'thor"));</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="text" class="language-text hljs">HMSET "people:19315449-cda2-4f5c-b696-9cb8018fa1f9" "_class" "Person" "id" "19315449-cda2-4f5c-b696-9cb8018fa1f9" "firstname" "rand" "lastname" "al'thor" <i class="conum" data-value="1"></i><b>(1)</b>
SADD  "people" "19315449-cda2-4f5c-b696-9cb8018fa1f9"                           <i class="conum" data-value="2"></i><b>(2)</b>
SADD  "people:firstname:rand" "19315449-cda2-4f5c-b696-9cb8018fa1f9"            <i class="conum" data-value="3"></i><b>(3)</b>
SADD  "people:19315449-cda2-4f5c-b696-9cb8018fa1f9:idx" "people:firstname:rand" <i class="conum" data-value="4"></i><b>(4)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Save the flattened entry as hash.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Add the key of the hash written in &lt;1&gt; to the helper index of entities in the same keyspace.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Add the key of the hash written in &lt;2&gt; to the secondary index of firstnames with the properties value.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Add the index of &lt;3&gt; to the set of helper structures for entry to keep track of indexes to clean on delete/update.</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="redis.repositories.anatomy.replace"><a class="anchor" href="index.html#redis.repositories.anatomy.replace"></a>13.13.2. Replace existing</h4>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">repository.save(new Person("e82908cf-e7d3-47c2-9eec-b4e0967ad0c9", "Dragon Reborn", "al'thor"));</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="text" class="language-text hljs">DEL       "people:e82908cf-e7d3-47c2-9eec-b4e0967ad0c9"                           <i class="conum" data-value="1"></i><b>(1)</b>
HMSET     "people:e82908cf-e7d3-47c2-9eec-b4e0967ad0c9" "_class" "Person" "id" "e82908cf-e7d3-47c2-9eec-b4e0967ad0c9" "firstname" "Dragon Reborn" "lastname" "al'thor" <i class="conum" data-value="2"></i><b>(2)</b>
SADD      "people" "e82908cf-e7d3-47c2-9eec-b4e0967ad0c9"                         <i class="conum" data-value="3"></i><b>(3)</b>
SMEMBERS  "people:e82908cf-e7d3-47c2-9eec-b4e0967ad0c9:idx"                       <i class="conum" data-value="4"></i><b>(4)</b>
TYPE      "people:firstname:rand"                                                 <i class="conum" data-value="5"></i><b>(5)</b>
SREM      "people:firstname:rand" "e82908cf-e7d3-47c2-9eec-b4e0967ad0c9"          <i class="conum" data-value="6"></i><b>(6)</b>
DEL       "people:e82908cf-e7d3-47c2-9eec-b4e0967ad0c9:idx"                       <i class="conum" data-value="7"></i><b>(7)</b>
SADD      "people:firstname:Dragon Reborn" "e82908cf-e7d3-47c2-9eec-b4e0967ad0c9" <i class="conum" data-value="8"></i><b>(8)</b>
SADD      "people:e82908cf-e7d3-47c2-9eec-b4e0967ad0c9:idx" "people:firstname:Dragon Reborn" <i class="conum" data-value="9"></i><b>(9)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Remove the existing hash to avoid leftovers of hash keys potentially no longer present.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Save the flattened entry as hash.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Add the key of the hash written in &lt;1&gt; to the helper index of entities in the same keyspace.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Get existing index structures that might need to be updated.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Check if the index exists and what type it is (text, geo, …).</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>Remove a potentially existing key from the index.</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>Remove the helper holding index information.</td>
</tr>
<tr>
<td><i class="conum" data-value="8"></i><b>8</b></td>
<td>Add the key of the hash added in &lt;2&gt; to the secondary index of firstnames with the properties value.</td>
</tr>
<tr>
<td><i class="conum" data-value="9"></i><b>9</b></td>
<td>Add the index of &lt;6&gt; to the set of helper structures for entry to keep track of indexes to clean on delete/update.</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="redis.repositories.anatomy.geo"><a class="anchor" href="index.html#redis.repositories.anatomy.geo"></a>13.13.3. Save Geo Data</h4>
<div class="paragraph">
<p>Geo indexes follow the same rules as normal text based ones but use geo structure to store values. Saving an entity that
uses a Geo-indexed property results in the following commands:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="text" class="language-text hljs">GEOADD "people:hometown:location" "13.361389" "38.115556" "76900e94-b057-44bc-abcf-8126d51a621b"  <i class="conum" data-value="1"></i><b>(1)</b>
SADD   "people:76900e94-b057-44bc-abcf-8126d51a621b:idx" "people:hometown:location"               <i class="conum" data-value="2"></i><b>(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Add the key of the saved entry to the the geo index.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Keep track of the index structure.</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="redis.repositories.anatomy.index"><a class="anchor" href="index.html#redis.repositories.anatomy.index"></a>13.13.4. Find using simple index</h4>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">repository.findByFirstname("egwene");</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="text" class="language-text hljs">SINTER  "people:firstname:egwene"                     <i class="conum" data-value="1"></i><b>(1)</b>
HGETALL "people:d70091b5-0b9a-4c0a-9551-519e61bc9ef3" <i class="conum" data-value="2"></i><b>(2)</b>
HGETALL ...</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Fetch keys contained in the secondary index.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Fetch each key returned by &lt;1&gt; individually.</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="redis.repositories.anatomy.geo-index"><a class="anchor" href="index.html#redis.repositories.anatomy.geo-index"></a>13.13.5. Find using Geo Index</h4>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">repository.findByHometownLocationNear(new Point(15, 37), new Distance(200, KILOMETERS));</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="text" class="language-text hljs">GEORADIUS "people:hometown:location" "15.0" "37.0" "200.0" "km" <i class="conum" data-value="1"></i><b>(1)</b>
HGETALL   "people:76900e94-b057-44bc-abcf-8126d51a621b"         <i class="conum" data-value="2"></i><b>(2)</b>
HGETALL   ...</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Fetch keys contained in the secondary index.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Fetch each key returned by &lt;1&gt; individually.</td>
</tr>
</table>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<h1 id="appendixes" class="sect0"><a class="anchor" href="index.html#appendixes"></a>Appendixes</h1>
<div class="sect1">
<h2 id="appendix"><a class="anchor" href="index.html#appendix"></a>Appendix Document Structure</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The appendix contains various additional detail that complements the information in the rest of the reference documentation:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>&#8220;<a href="index.html#appendix:schema">Schema</a>&#8221; defines the schemas provided by Spring Data Redis.</p>
</li>
<li>
<p>&#8220;<a href="index.html#appendix:command-reference">Command Reference</a>&#8221; details which commands are supported by <code>RedisTemplate</code>.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="appendix:schema"><a class="anchor" href="index.html#appendix:schema"></a>Appendix A: Schema</h2>
<div class="sectionbody">
<div class="paragraph">
<p><a href="https://www.springframework.org/schema/redis/spring-redis-1.0.xsd">Spring Data Redis Schema (redis-namespace)</a></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="appendix:command-reference"><a class="anchor" href="index.html#appendix:command-reference"></a>Appendix B: Command Reference</h2>
<div class="sectionbody">
<div class="sect2">
<h3>Supported Commands</h3>
<table class="tableblock frame-all grid-all" style="width: 50%;">
<caption class="title">Table 13. Redis commands supported by <code>RedisTemplate</code></caption>
<colgroup>
<col style="width: 66.6666%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Command</th>
<th class="tableblock halign-center valign-top">Template Support</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">APPEND</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">X</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">AUTH</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">X</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">BGREWRITEAOF</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">X</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">BGSAVE</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">X</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">BITCOUNT</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">X</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">BITFIELD</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">X</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">BITOP</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">X</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">BLPOP</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">X</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">BRPOP</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">X</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">BRPOPLPUSH</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">X</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CLIENT KILL</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">X</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CLIENT GETNAME</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">X</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CLIENT LIST</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">X</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CLIENT SETNAME</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">X</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CLUSTER SLOTS</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">COMMAND</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">COMMAND COUNT</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">COMMAND GETKEYS</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">COMMAND INFO</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CONFIG GET</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">X</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CONFIG RESETSTAT</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">X</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CONFIG REWRITE</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CONFIG SET</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">X</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">DBSIZE</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">X</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">DEBUG OBJECT</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">DEBUG SEGFAULT</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">DECR</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">X</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">DECRBY</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">X</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">DEL</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">X</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">DISCARD</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">X</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">DUMP</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">X</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ECHO</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">X</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">EVAL</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">X</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">EVALSHA</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">X</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">EXEC</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">X</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">EXISTS</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">X</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">EXPIRE</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">X</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">EXPIREAT</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">X</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">FLUSHALL</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">X</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">FLUSHDB</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">X</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">GET</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">X</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">GETBIT</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">X</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">GETRANGE</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">X</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">GETSET</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">X</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">HDEL</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">X</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">HEXISTS</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">X</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">HGET</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">X</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">HGETALL</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">X</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">HINCRBY</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">X</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">HINCRBYFLOAT</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">X</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">HKEYS</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">X</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">HLEN</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">X</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">HMGET</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">X</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">HMSET</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">X</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">HSCAN</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">X</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">HSET</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">X</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">HSETNX</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">X</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">HVALS</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">X</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">INCR</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">X</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">INCRBY</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">X</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">INCRBYFLOAT</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">X</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">INFO</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">X</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">KEYS</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">X</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LASTSAVE</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">X</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LINDEX</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">X</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LINSERT</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">X</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LLEN</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">X</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LPOP</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">X</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LPUSH</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">X</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LPUSHX</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">X</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LRANGE</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">X</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LREM</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">X</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LSET</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">X</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LTRIM</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">X</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">MGET</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">X</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">MIGRATE</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">MONITOR</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">MOVE</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">X</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">MSET</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">X</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">MSETNX</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">X</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">MULTI</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">X</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OBJECT</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">PERSIST</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">X</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">PEXIPRE</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">X</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">PEXPIREAT</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">X</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">PFADD</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">X</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">PFCOUNT</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">X</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">PFMERGE</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">X</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">PING</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">X</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">PSETEX</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">X</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">PSUBSCRIBE</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">X</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">PTTL</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">X</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">PUBLISH</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">X</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">PUBSUB</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">PUBSUBSCRIBE</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">QUIT</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">X</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">RANDOMKEY</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">X</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">RENAME</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">X</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">RENAMENX</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">X</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">RESTORE</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">X</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ROLE</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">RPOP</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">X</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">RPOPLPUSH</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">X</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">RPUSH</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">X</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">RPUSHX</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">X</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SADD</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">X</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SAVE</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">X</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SCAN</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">X</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SCARD</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">X</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SCRIPT EXITS</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">X</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SCRIPT FLUSH</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">X</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SCRIPT KILL</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">X</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SCRIPT LOAD</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">X</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SDIFF</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">X</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SDIFFSTORE</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">X</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SELECT</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">X</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SENTINEL FAILOVER</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">X</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SENTINEL GET-MASTER-ADD-BY-NAME</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SENTINEL MASTER</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SENTINEL MASTERS</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">X</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SENTINEL MONITOR</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">X</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SENTINEL REMOVE</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">X</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SENTINEL RESET</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SENTINEL SET</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SENTINEL SLAVES</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">X</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SET</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">X</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SETBIT</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">X</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SETEX</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">X</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SETNX</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">X</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SETRANGE</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">X</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SHUTDOWN</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">X</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SINTER</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">X</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SINTERSTORE</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">X</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SISMEMBER</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">X</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SLAVEOF</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">X</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SLOWLOG</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SMEMBERS</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">X</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SMOVE</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">X</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SORT</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">X</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SPOP</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">X</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SRANDMEMBER</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">X</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SREM</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">X</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SSCAN</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">X</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">STRLEN</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">X</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SUBSCRIBE</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">X</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SUNION</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">X</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SUNIONSTORE</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">X</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SYNC</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">TIME</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">X</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">TTL</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">X</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">TYPE</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">X</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">UNSUBSCRIBE</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">X</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">UNWATCH</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">X</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">WATCH</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">X</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ZADD</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">X</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ZCARD</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">X</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ZCOUNT</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">X</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ZINCRBY</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">X</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ZINTERSTORE</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">X</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ZLEXCOUNT</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ZRANGE</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">X</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ZRANGEBYLEX</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ZREVRANGEBYLEX</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ZRANGEBYSCORE</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">X</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ZRANK</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">X</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ZREM</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">X</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ZREMRANGEBYLEX</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ZREMRANGEBYRANK</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">X</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ZREVRANGE</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">X</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ZREVRANGEBYSCORE</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">X</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ZREVRANK</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">X</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ZSCAN</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">X</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ZSCORE</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">X</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ZUNINONSTORE</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">X</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Version 2.4.1<br>
Last updated 2020-11-11 12:31:13 +0100
</div>
</div>
<link rel="stylesheet" href="js/highlight/styles/github.min.css">
<script data-cfasync="false" src="../../../../../../cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script><script src="js/highlight/highlight.min.js"></script>
<script>hljs.initHighlighting()</script>
<script type="text/javascript" src="js/tocbot/tocbot.min.js"></script>
<script type="text/javascript" src="js/toc.js"></script>
<script>if(window.parent==window){(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');ga('create','UA-2728886-23','auto',{'siteSpeedSampleRate':100});ga('send','pageview');}</script></body>
</html>