<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.2">
<meta name="author" content="Jens Schauder, Jay Bryant, Mark Paluch, Bastian Wilhelm">
<title>Spring Data JDBC - Reference Documentation</title>
<link rel="stylesheet" href="css/spring.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
</head>
<body class="book toc2 toc-left">
<div id="header">
<h1>Spring Data JDBC - Reference Documentation</h1>
<div class="details">
<span id="author" class="author">Jens Schauder, Jay Bryant, Mark Paluch, Bastian Wilhelm</span><br>
<span id="revnumber">version 2.1.1,</span>
<span id="revdate">2020-11-11</span>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel0">
<li><a href="index.html#preface">Preface</a>
<ul class="sectlevel1">
<li><a href="index.html#get-started:first-steps:spring">1. Learning Spring</a></li>
<li><a href="index.html#requirements">2. Requirements</a></li>
<li><a href="index.html#get-started:help">3. Additional Help Resources</a></li>
<li><a href="index.html#get-started:up-to-date">4. Following Development</a></li>
<li><a href="index.html#project">5. Project Metadata</a></li>
<li><a href="index.html#new-features">6. New &amp; Noteworthy</a>
<ul class="sectlevel2">
<li><a href="index.html#new-features.2-1-0">6.1. What&#8217;s New in Spring Data JDBC 2.1</a></li>
<li><a href="index.html#new-features.2-0-0">6.2. What&#8217;s New in Spring Data JDBC 2.0</a></li>
<li><a href="index.html#new-features.1-1-0">6.3. What&#8217;s New in Spring Data JDBC 1.1</a></li>
<li><a href="index.html#new-features.1-0-0">6.4. What&#8217;s New in Spring Data JDBC 1.0</a></li>
</ul>
</li>
<li><a href="index.html#dependencies">7. Dependencies</a>
<ul class="sectlevel2">
<li><a href="index.html#dependencies.spring-boot">7.1. Dependency Management with Spring Boot</a></li>
<li><a href="index.html#dependencies.spring-framework">7.2. Spring Framework</a></li>
</ul>
</li>
<li><a href="index.html#repositories">8. Working with Spring Data Repositories</a>
<ul class="sectlevel2">
<li><a href="index.html#repositories.core-concepts">8.1. Core concepts</a></li>
<li><a href="index.html#repositories.query-methods">8.2. Query Methods</a></li>
<li><a href="index.html#repositories.definition">8.3. Defining Repository Interfaces</a>
<ul class="sectlevel3">
<li><a href="index.html#repositories.definition-tuning">8.3.1. Fine-tuning Repository Definition</a></li>
<li><a href="index.html#repositories.multiple-modules">8.3.2. Using Repositories with Multiple Spring Data Modules</a></li>
</ul>
</li>
<li><a href="index.html#repositories.query-methods.details">8.4. Defining Query Methods</a>
<ul class="sectlevel3">
<li><a href="index.html#repositories.query-methods.query-lookup-strategies">8.4.1. Query Lookup Strategies</a></li>
<li><a href="index.html#repositories.query-methods.query-creation">8.4.2. Query Creation</a></li>
<li><a href="index.html#repositories.query-methods.query-property-expressions">8.4.3. Property Expressions</a></li>
<li><a href="index.html#repositories.special-parameters">8.4.4. Special parameter handling</a>
<ul class="sectlevel4">
<li><a href="index.html#repositories.paging-and-sorting">Paging and Sorting</a></li>
</ul>
</li>
<li><a href="index.html#repositories.limit-query-result">8.4.5. Limiting Query Results</a></li>
<li><a href="index.html#repositories.collections-and-iterables">8.4.6. Repository Methods Returning Collections or Iterables</a>
<ul class="sectlevel4">
<li><a href="index.html#repositories.collections-and-iterables.streamable">Using Streamable as Query Method Return Type</a></li>
<li><a href="index.html#repositories.collections-and-iterables.streamable-wrapper">Returning Custom Streamable Wrapper Types</a></li>
<li><a href="index.html#repositories.collections-and-iterables.vavr">Support for Vavr Collections</a></li>
</ul>
</li>
<li><a href="index.html#repositories.nullability">8.4.7. Null Handling of Repository Methods</a>
<ul class="sectlevel4">
<li><a href="index.html#repositories.nullability.annotations">Nullability Annotations</a></li>
<li><a href="index.html#repositories.nullability.kotlin">Nullability in Kotlin-based Repositories</a></li>
</ul>
</li>
<li><a href="index.html#repositories.query-streaming">8.4.8. Streaming Query Results</a></li>
<li><a href="index.html#repositories.query-async">8.4.9. Asynchronous Query Results</a></li>
</ul>
</li>
<li><a href="index.html#repositories.create-instances">8.5. Creating Repository Instances</a>
<ul class="sectlevel3">
<li><a href="index.html#repositories.create-instances.spring">8.5.1. XML Configuration</a>
<ul class="sectlevel4">
<li><a href="index.html#repositories.using-filters">Using Filters</a></li>
</ul>
</li>
<li><a href="index.html#repositories.create-instances.java-config">8.5.2. Java Configuration</a></li>
<li><a href="index.html#repositories.create-instances.standalone">8.5.3. Standalone Usage</a></li>
</ul>
</li>
<li><a href="index.html#repositories.custom-implementations">8.6. Custom Implementations for Spring Data Repositories</a>
<ul class="sectlevel3">
<li><a href="index.html#repositories.single-repository-behavior">8.6.1. Customizing Individual Repositories</a>
<ul class="sectlevel4">
<li><a href="index.html#repositories.configuration">Configuration</a></li>
</ul>
</li>
<li><a href="index.html#repositories.customize-base-repository">8.6.2. Customize the Base Repository</a></li>
</ul>
</li>
<li><a href="index.html#core.domain-events">8.7. Publishing Events from Aggregate Roots</a></li>
<li><a href="index.html#core.extensions">8.8. Spring Data Extensions</a>
<ul class="sectlevel3">
<li><a href="index.html#core.extensions.querydsl">8.8.1. Querydsl Extension</a></li>
<li><a href="index.html#core.web">8.8.2. Web support</a>
<ul class="sectlevel4">
<li><a href="index.html#core.web.basic">Basic Web Support</a></li>
<li><a href="index.html#core.web.pageables">Hypermedia Support for Pageables</a></li>
<li><a href="index.html#core.web.binding">Web Databinding Support</a></li>
<li><a href="index.html#core.web.type-safe">Querydsl Web Support</a></li>
</ul>
</li>
<li><a href="index.html#core.repository-populators">8.8.3. Repository Populators</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a href="index.html#reference">Reference Documentation</a>
<ul class="sectlevel1">
<li><a href="index.html#jdbc.repositories">9. JDBC Repositories</a>
<ul class="sectlevel2">
<li><a href="index.html#jdbc.why">9.1. Why Spring Data JDBC?</a></li>
<li><a href="index.html#jdbc.domain-driven-design">9.2. Domain Driven Design and Relational Databases.</a></li>
<li><a href="index.html#jdbc.getting-started">9.3. Getting Started</a></li>
<li><a href="index.html#jdbc.examples-repo">9.4. Examples Repository</a></li>
<li><a href="index.html#jdbc.java-config">9.5. Annotation-based Configuration</a>
<ul class="sectlevel3">
<li><a href="index.html#jdbc.dialects">9.5.1. Dialects</a></li>
</ul>
</li>
<li><a href="index.html#jdbc.entity-persistence">9.6. Persisting Entities</a>
<ul class="sectlevel3">
<li><a href="index.html#mapping.fundamentals">9.6.1. Object Mapping Fundamentals</a>
<ul class="sectlevel4">
<li><a href="index.html#mapping.object-creation">Object creation</a></li>
<li><a href="index.html#mapping.property-population">Property population</a></li>
<li><a href="index.html#mapping.general-recommendations">General recommendations</a></li>
<li><a href="index.html#mapping.kotlin">Kotlin support</a></li>
</ul>
</li>
<li><a href="index.html#jdbc.entity-persistence.types">9.6.2. Supported Types in Your Entity</a></li>
<li><a href="index.html#jdbc.entity-persistence.custom-converters">9.6.3. Custom converters</a>
<ul class="sectlevel4">
<li><a href="index.html#jdbc.entity-persistence.custom-converters.jdbc-value">JdbcValue</a></li>
</ul>
</li>
<li><a href="index.html#jdbc.entity-persistence.naming-strategy">9.6.4. <code>NamingStrategy</code></a></li>
<li><a href="index.html#jdbc.entity-persistence.custom-table-name">9.6.5. <code>Custom table names</code></a></li>
<li><a href="index.html#jdbc.entity-persistence.custom-column-name">9.6.6. <code>Custom column names</code></a></li>
<li><a href="index.html#jdbc.entity-persistence.embedded-entities">9.6.7. Embedded entities</a></li>
<li><a href="index.html#jdbc.entity-persistence.state-detection-strategies">9.6.8. Entity State Detection Strategies</a></li>
<li><a href="index.html#jdbc.entity-persistence.id-generation">9.6.9. ID Generation</a></li>
<li><a href="index.html#jdbc.entity-persistence.optimistic-locking">9.6.10. Optimistic Locking</a></li>
</ul>
</li>
<li><a href="index.html#jdbc.query-methods">9.7. Query Methods</a>
<ul class="sectlevel3">
<li><a href="index.html#jdbc.query-methods.strategies">9.7.1. Query Lookup Strategies</a></li>
<li><a href="index.html#jdbc.query-methods.at-query">9.7.2. Using <code>@Query</code></a></li>
<li><a href="index.html#jdbc.query-methods.named-query">9.7.3. Named Queries</a>
<ul class="sectlevel4">
<li><a href="index.html#jdbc.query-methods.at-query.custom-rowmapper">Custom <code>RowMapper</code></a></li>
<li><a href="index.html#jdbc.query-methods.at-query.modifying">Modifying Query</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="index.html#jdbc.mybatis">9.8. MyBatis Integration</a>
<ul class="sectlevel3">
<li><a href="index.html#jdbc.mybatis.configuration">9.8.1. Configuration</a></li>
<li><a href="index.html#jdbc.mybatis.conventions">9.8.2. Usage conventions</a></li>
</ul>
</li>
<li><a href="index.html#jdbc.events">9.9. Lifecycle Events</a></li>
<li><a href="index.html#entity-callbacks">9.10. Entity Callbacks</a>
<ul class="sectlevel3">
<li><a href="index.html#entity-callbacks.implement">9.10.1. Implementing Entity Callbacks</a></li>
<li><a href="index.html#entity-callbacks.register">9.10.2. Registering Entity Callbacks</a></li>
<li><a href="index.html#jdbc.entity-callbacks">9.10.3. Store-specific EntityCallbacks</a></li>
</ul>
</li>
<li><a href="index.html#jdbc.custom-converters">9.11. Custom Conversions</a>
<ul class="sectlevel3">
<li><a href="index.html#jdbc.custom-converters.writer">9.11.1. Writing a Property by Using a Registered Spring Converter</a></li>
<li><a href="index.html#jdbc.custom-converters.reader">9.11.2. Reading by Using a Spring Converter</a></li>
<li><a href="index.html#jdbc.custom-converters.configuration">9.11.3. Registering Spring Converters with the <code>JdbcConverter</code></a>
<ul class="sectlevel5">
<li><a href="index.html#customconversions.converter-disambiguation">Converter Disambiguation</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="index.html#jdbc.logging">9.12. Logging</a></li>
<li><a href="index.html#jdbc.transactions">9.13. Transactionality</a>
<ul class="sectlevel3">
<li><a href="index.html#jdbc.transaction.query-methods">9.13.1. Transactional Query Methods</a></li>
</ul>
</li>
<li><a href="index.html#auditing">9.14. Auditing</a>
<ul class="sectlevel3">
<li><a href="index.html#auditing.basics">9.14.1. Basics</a>
<ul class="sectlevel4">
<li><a href="index.html#auditing.annotations">Annotation-based Auditing Metadata</a></li>
<li><a href="index.html#auditing.interfaces">Interface-based Auditing Metadata</a></li>
<li><a href="index.html#auditing.auditor-aware"><code>AuditorAware</code></a></li>
<li><a href="index.html#auditing.reactive-auditor-aware"><code>ReactiveAuditorAware</code></a></li>
</ul>
</li>
</ul>
</li>
<li><a href="index.html#jdbc.auditing">9.15. JDBC Auditing</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="index.html#appendix">Appendix</a>
<ul class="sectlevel1">
<li><a href="index.html#glossary">Appendix A: Glossary</a></li>
<li><a href="index.html#repositories.namespace-reference">Appendix B: Namespace reference</a>
<ul class="sectlevel2">
<li><a href="index.html#populator.namespace-dao-config">The <code>&lt;repositories /&gt;</code> Element</a></li>
</ul>
</li>
<li><a href="index.html#populator.namespace-reference">Appendix C: Populators namespace reference</a>
<ul class="sectlevel2">
<li><a href="index.html#namespace-dao-config">The &lt;populator /&gt; element</a></li>
</ul>
</li>
<li><a href="index.html#repository-query-keywords">Appendix D: Repository query keywords</a>
<ul class="sectlevel2">
<li><a href="index.html#">Supported query keywords</a></li>
</ul>
</li>
<li><a href="index.html#repository-query-return-types">Appendix E: Repository query return types</a>
<ul class="sectlevel2">
<li><a href="index.html#">Supported Query Return Types</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>&#169; 2018-2020 The original authors.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Copies of this document may be made for your own use and for distribution to others, provided that you do not charge any fee for such copies and further provided that each copy contains this Copyright Notice, whether distributed in print or electronically.
</td>
</tr>
</table>
</div>
</div>
</div>
<h1 id="preface" class="sect0"><a class="anchor" href="index.html#preface"></a>Preface</h1>
<div class="openblock partintro">
<div class="content">
<div class="paragraph">
<p>The Spring Data JDBC project applies core Spring concepts to the development of solutions that use JDBC databases aligned with <a href="index.html#jdbc.domain-driven-design">Domain-driven design principles</a>.
We provide a &#8220;template&#8221; as a high-level abstraction for storing and querying aggregates.</p>
</div>
<div class="paragraph">
<p>This document is the reference guide for Spring Data JDBC Support.
It explains the concepts and semantics and syntax..</p>
</div>
<div class="paragraph">
<p>This section provides some basic introduction.
The rest of the document refers only to Spring Data JDBC features and assumes the user is familiar with SQL and Spring concepts.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="get-started:first-steps:spring"><a class="anchor" href="index.html#get-started:first-steps:spring"></a>1. Learning Spring</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Spring Data uses Spring framework&#8217;s <a href="https://docs.spring.io/spring/docs/5.3.1/spring-framework-reference/core.html">core</a> functionality, including:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://docs.spring.io/spring/docs/5.3.1/spring-framework-reference/core.html#beans">IoC</a> container</p>
</li>
<li>
<p><a href="https://docs.spring.io/spring/docs/5.3.1/spring-framework-reference/core.html#validation">type conversion system</a></p>
</li>
<li>
<p><a href="https://docs.spring.io/spring/docs/5.3.1/spring-framework-reference/core.html#expressions">expression language</a></p>
</li>
<li>
<p><a href="https://docs.spring.io/spring/docs/5.3.1/spring-framework-reference/integration.html#jmx">JMX integration</a></p>
</li>
<li>
<p><a href="https://docs.spring.io/spring/docs/5.3.1/spring-framework-reference/data-access.html#dao-exceptions">DAO exception hierarchy</a>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>While you need not know the Spring APIs, understanding the concepts behind them is important.
At a minimum, the idea behind Inversion of Control (IoC) should be familiar, and you should be familiar with whatever IoC container you choose to use.</p>
</div>
<div class="paragraph">
<p>The core functionality of the JDBC Aggregate support can be used directly, with no need to invoke the IoC services of the Spring Container.
This is much like <code>JdbcTemplate</code>, which can be used "'standalone'" without any other services of the Spring container.
To leverage all the features of Spring Data JDBC, such as the repository support, you need to configure some parts of the library to use Spring.</p>
</div>
<div class="paragraph">
<p>To learn more about Spring, you can refer to the comprehensive documentation that explains the Spring Framework in detail.
There are a lot of articles, blog entries, and books on the subject.
See the Spring framework <a href="https://spring.io/docs">home page</a> for more information.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="requirements"><a class="anchor" href="index.html#requirements"></a>2. Requirements</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The Spring Data JDBC binaries require JDK level 8.0 and above and <a href="https://spring.io/docs">Spring Framework</a> 5.3.1 and above.</p>
</div>
<div class="paragraph">
<p>In terms of databases, Spring Data JDBC requires a <a href="index.html#jdbc.dialects">dialect</a> to abstract common SQL functionality over vendor-specific flavours.
Spring Data JDBC includes direct support for the following databases:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>DB2</p>
</li>
<li>
<p>H2</p>
</li>
<li>
<p>HSQLDB</p>
</li>
<li>
<p>MariaDB</p>
</li>
<li>
<p>Microsoft SQL Server</p>
</li>
<li>
<p>MySQL</p>
</li>
<li>
<p>Oracle</p>
</li>
<li>
<p>Postgres</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If you use a different database then your application won’t startup. The <a href="index.html#jdbc.dialects">dialect</a> section contains further detail on how to proceed in such case.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="get-started:help"><a class="anchor" href="index.html#get-started:help"></a>3. Additional Help Resources</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Learning a new framework is not always straightforward.
In this section, we try to provide what we think is an easy-to-follow guide for starting with the Spring Data JDBC module.
However, if you encounter issues or you need advice, feel free to use one of the following links:</p>
</div>
<div id="get-started:help:community" class="dlist">
<dl>
<dt class="hdlist1">Community Forum </dt>
<dd>
<p>Spring Data on <a href="https://stackoverflow.com/questions/tagged/spring-data">Stack Overflow</a> is a tag for all Spring Data (not just Document) users to share information and help each other.
Note that registration is needed only for posting.</p>
</dd>
</dl>
</div>
<div id="get-started:help:professional" class="dlist">
<dl>
<dt class="hdlist1">Professional Support </dt>
<dd>
<p>Professional, from-the-source support, with guaranteed response time, is available from <a href="https://pivotal.io/">Pivotal Sofware, Inc.</a>, the company behind Spring Data and Spring.</p>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect1">
<h2 id="get-started:up-to-date"><a class="anchor" href="index.html#get-started:up-to-date"></a>4. Following Development</h2>
<div class="sectionbody">
<div class="paragraph">
<p>For information on the Spring Data JDBC source code repository, nightly builds, and snapshot artifacts, see the Spring Data JDBC <a href="https://spring.io/projects/spring-data-jdbc/">homepage</a>.
You can help make Spring Data best serve the needs of the Spring community by interacting with developers through the Community on <a href="https://stackoverflow.com/questions/tagged/spring-data">Stack Overflow</a>.
If you encounter a bug or want to suggest an improvement, please create a ticket on the Spring Data issue <a href="https://jira.spring.io/browse/DATAJDBC">tracker</a>.
To stay up to date with the latest news and announcements in the Spring eco system, subscribe to the Spring Community <a href="https://spring.io">Portal</a>.
You can also follow the Spring <a href="https://spring.io/blog">blog</a> or the project team on Twitter (<a href="https://twitter.com/SpringData">SpringData</a>).</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="project"><a class="anchor" href="index.html#project"></a>5. Project Metadata</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>Release repository: <a href="https://repo.spring.io/libs-release" class="bare">https://repo.spring.io/libs-release</a></p>
</li>
<li>
<p>Milestone repository: <a href="https://repo.spring.io/libs-milestone" class="bare">https://repo.spring.io/libs-milestone</a></p>
</li>
<li>
<p>Snapshot repository: <a href="https://repo.spring.io/libs-snapshot" class="bare">https://repo.spring.io/libs-snapshot</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="new-features"><a class="anchor" href="index.html#new-features"></a>6. New &amp; Noteworthy</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This section covers the significant changes for each version.</p>
</div>
<div class="sect2">
<h3 id="new-features.2-1-0"><a class="anchor" href="index.html#new-features.2-1-0"></a>6.1. What&#8217;s New in Spring Data JDBC 2.1</h3>
<div class="ulist">
<ul>
<li>
<p>Dialect for Oracle databases.</p>
</li>
<li>
<p>Support for <code>@Value</code> in persistence constructors.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="new-features.2-0-0"><a class="anchor" href="index.html#new-features.2-0-0"></a>6.2. What&#8217;s New in Spring Data JDBC 2.0</h3>
<div class="ulist">
<ul>
<li>
<p>Optimistic Locking support.</p>
</li>
<li>
<p>Support for <code>PagingAndSortingRepository</code>.</p>
</li>
<li>
<p><a href="index.html#jdbc.query-methods">Query Derivation</a>.</p>
</li>
<li>
<p>Full Support for H2.</p>
</li>
<li>
<p>All SQL identifiers know get quoted by default.</p>
</li>
<li>
<p>Missing columns no longer cause exceptions.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="new-features.1-1-0"><a class="anchor" href="index.html#new-features.1-1-0"></a>6.3. What&#8217;s New in Spring Data JDBC 1.1</h3>
<div class="ulist">
<ul>
<li>
<p><code>@Embedded</code> entities support.</p>
</li>
<li>
<p>Store <code>byte[]</code> as <code>BINARY</code>.</p>
</li>
<li>
<p>Dedicated <code>insert</code> method in the <code>JdbcAggregateTemplate</code>.</p>
</li>
<li>
<p>Read only property support.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="new-features.1-0-0"><a class="anchor" href="index.html#new-features.1-0-0"></a>6.4. What&#8217;s New in Spring Data JDBC 1.0</h3>
<div class="ulist">
<ul>
<li>
<p>Basic support for <code>CrudRepository</code>.</p>
</li>
<li>
<p><code>@Query</code> support.</p>
</li>
<li>
<p>MyBatis support.</p>
</li>
<li>
<p>Id generation.</p>
</li>
<li>
<p>Event support.</p>
</li>
<li>
<p>Auditing.</p>
</li>
<li>
<p><code>CustomConversions</code>.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="dependencies"><a class="anchor" href="index.html#dependencies"></a>7. Dependencies</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Due to the different inception dates of individual Spring Data modules, most of them carry different major and minor version numbers. The easiest way to find compatible ones is to rely on the Spring Data Release Train BOM that we ship with the compatible versions defined. In a Maven project, you would declare this dependency in the <code>&lt;dependencyManagement /&gt;</code> section of your POM as follows:</p>
</div>
<div class="exampleblock">
<div class="title">Example 1. Using the Spring Data release train BOM</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="xml" class="language-xml hljs">&lt;dependencyManagement&gt;
  &lt;dependencies&gt;
    &lt;dependency&gt;
      &lt;groupId&gt;org.springframework.data&lt;/groupId&gt;
      &lt;artifactId&gt;spring-data-bom&lt;/artifactId&gt;
      &lt;version&gt;2020.0.1&lt;/version&gt;
      &lt;scope&gt;import&lt;/scope&gt;
      &lt;type&gt;pom&lt;/type&gt;
    &lt;/dependency&gt;
  &lt;/dependencies&gt;
&lt;/dependencyManagement&gt;</code></pre>
</div>
</div>
</div>
</div>
<div id="dependencies.train-version" class="paragraph">
<p>The current release train version is <code>2020.0.1</code>. The train version uses <a href="https://calver.org/">calver</a> with the pattern <code>YYYY.MINOR.MICRO</code>.
The version name follows <code>${calver}</code> for GA releases and service releases and the following pattern for all other versions: <code>${calver}-${modifier}</code>, where <code>modifier</code> can be one of the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>SNAPSHOT</code>: Current snapshots</p>
</li>
<li>
<p><code>M1</code>, <code>M2</code>, and so on: Milestones</p>
</li>
<li>
<p><code>RC1</code>, <code>RC2</code>, and so on: Release candidates</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You can find a working example of using the BOMs in our <a href="https://github.com/spring-projects/spring-data-examples/tree/master/bom">Spring Data examples repository</a>. With that in place, you can declare the Spring Data modules you would like to use without a version in the <code>&lt;dependencies /&gt;</code> block, as follows:</p>
</div>
<div class="exampleblock">
<div class="title">Example 2. Declaring a dependency to a Spring Data module</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="xml" class="language-xml hljs">&lt;dependencies&gt;
  &lt;dependency&gt;
    &lt;groupId&gt;org.springframework.data&lt;/groupId&gt;
    &lt;artifactId&gt;spring-data-jpa&lt;/artifactId&gt;
  &lt;/dependency&gt;
&lt;dependencies&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="dependencies.spring-boot"><a class="anchor" href="index.html#dependencies.spring-boot"></a>7.1. Dependency Management with Spring Boot</h3>
<div class="paragraph">
<p>Spring Boot selects a recent version of Spring Data modules for you. If you still want to upgrade to a newer version, set
the <code>spring-data-releasetrain.version</code> property to the <a href="index.html#dependencies.train-version">train version and iteration</a> you would like to use.</p>
</div>
</div>
<div class="sect2">
<h3 id="dependencies.spring-framework"><a class="anchor" href="index.html#dependencies.spring-framework"></a>7.2. Spring Framework</h3>
<div class="paragraph">
<p>The current version of Spring Data modules require Spring Framework 5.3.1 or better. The modules might also work with an older bugfix version of that minor version. However, using the most recent version within that generation is highly recommended.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="repositories"><a class="anchor" href="index.html#repositories"></a>8. Working with Spring Data Repositories</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The goal of the Spring Data repository abstraction is to significantly reduce the amount of boilerplate code required to implement data access layers for various persistence stores.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p><em>Spring Data repository documentation and your module</em></p>
</div>
<div class="paragraph">
<p>This chapter explains the core concepts and interfaces of Spring Data repositories. The information in this chapter is pulled from the Spring Data Commons module. It uses the configuration and code samples for the Java Persistence API (JPA) module. You should adapt the XML namespace declaration and the types to be extended to the equivalents of the particular module that you use. &#8220;<a href="index.html#repositories.namespace-reference">Namespace reference</a>&#8221; covers XML configuration, which is supported across all Spring Data modules that support the repository API. &#8220;<a href="index.html#repository-query-keywords">Repository query keywords</a>&#8221; covers the query method keywords supported by the repository abstraction in general. For detailed information on the specific features of your module, see the chapter on that module of this document.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="repositories.core-concepts"><a class="anchor" href="index.html#repositories.core-concepts"></a>8.1. Core concepts</h3>
<div class="paragraph">
<p>The central interface in the Spring Data repository abstraction is <code>Repository</code>. It takes the domain class to manage as well as the ID type of the domain class as type arguments. This interface acts primarily as a marker interface to capture the types to work with and to help you to discover interfaces that extend this one. The <a href="../../../../../commons/docs/current/api/org/springframework/data/repository/CrudRepository.html"><code>CrudRepository</code></a> interface provides sophisticated CRUD functionality for the entity class that is being managed.</p>
</div>
<div id="repositories.repository" class="exampleblock">
<div class="title">Example 3. <code>CrudRepository</code> Interface</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">public interface CrudRepository&lt;T, ID&gt; extends Repository&lt;T, ID&gt; {

  &lt;S extends T&gt; S save(S entity);      <i class="conum" data-value="1"></i><b>(1)</b>

  Optional&lt;T&gt; findById(ID primaryKey); <i class="conum" data-value="2"></i><b>(2)</b>

  Iterable&lt;T&gt; findAll();               <i class="conum" data-value="3"></i><b>(3)</b>

  long count();                        <i class="conum" data-value="4"></i><b>(4)</b>

  void delete(T entity);               <i class="conum" data-value="5"></i><b>(5)</b>

  boolean existsById(ID primaryKey);   <i class="conum" data-value="6"></i><b>(6)</b>

  // … more functionality omitted.
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Saves the given entity.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Returns the entity identified by the given ID.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Returns all entities.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Returns the number of entities.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Deletes the given entity.</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>Indicates whether an entity with the given ID exists.</td>
</tr>
</table>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
We also provide persistence technology-specific abstractions, such as <code>JpaRepository</code> or <code>MongoRepository</code>. Those interfaces extend <code>CrudRepository</code> and expose the capabilities of the underlying persistence technology in addition to the rather generic persistence technology-agnostic interfaces such as <code>CrudRepository</code>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>On top of the <code>CrudRepository</code>, there is a <a href="../../../../../commons/docs/current/api/org/springframework/data/repository/PagingAndSortingRepository.html"><code>PagingAndSortingRepository</code></a> abstraction that adds additional methods to ease paginated access to entities:</p>
</div>
<div class="exampleblock">
<div class="title">Example 4. <code>PagingAndSortingRepository</code> interface</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">public interface PagingAndSortingRepository&lt;T, ID&gt; extends CrudRepository&lt;T, ID&gt; {

  Iterable&lt;T&gt; findAll(Sort sort);

  Page&lt;T&gt; findAll(Pageable pageable);
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>To access the second page of <code>User</code> by a page size of 20, you could do something like the following:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">PagingAndSortingRepository&lt;User, Long&gt; repository = // … get access to a bean
Page&lt;User&gt; users = repository.findAll(PageRequest.of(1, 20));</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>In addition to query methods, query derivation for both count and delete queries is available. The following list shows the interface definition for a derived count query:</p>
</div>
<div class="exampleblock">
<div class="title">Example 5. Derived Count Query</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">interface UserRepository extends CrudRepository&lt;User, Long&gt; {

  long countByLastname(String lastname);
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The following listing shows the interface definition for a derived delete query:</p>
</div>
<div class="exampleblock">
<div class="title">Example 6. Derived Delete Query</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">interface UserRepository extends CrudRepository&lt;User, Long&gt; {

  long deleteByLastname(String lastname);

  List&lt;User&gt; removeByLastname(String lastname);
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="repositories.query-methods"><a class="anchor" href="index.html#repositories.query-methods"></a>8.2. Query Methods</h3>
<div class="paragraph">
<p>Standard CRUD functionality repositories usually have queries on the underlying datastore. With Spring Data, declaring those queries becomes a four-step process:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Declare an interface extending Repository or one of its subinterfaces and type it to the domain class and ID type that it should handle, as shown in the following example:</p>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">interface PersonRepository extends Repository&lt;Person, Long&gt; { … }</code></pre>
</div>
</div>
</div>
</div>
</li>
<li>
<p>Declare query methods on the interface.</p>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">interface PersonRepository extends Repository&lt;Person, Long&gt; {
  List&lt;Person&gt; findByLastname(String lastname);
}</code></pre>
</div>
</div>
</div>
</div>
</li>
<li>
<p>Set up Spring to create proxy instances for those interfaces, either with <a href="index.html#repositories.create-instances.java-config">JavaConfig</a> or with <a href="index.html#repositories.create-instances">XML configuration</a>.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>To use Java configuration, create a class similar to the following:</p>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">import org.springframework.data.jpa.repository.config.EnableJpaRepositories;

@EnableJpaRepositories
class Config { … }</code></pre>
</div>
</div>
</div>
</div>
</li>
<li>
<p>To use XML configuration, define a bean similar to the following:</p>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="xml" class="language-xml hljs">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;beans xmlns="http://www.springframework.org/schema/beans"
   xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
   xmlns:jpa="http://www.springframework.org/schema/data/jpa"
   xsi:schemaLocation="http://www.springframework.org/schema/beans
     https://www.springframework.org/schema/beans/spring-beans.xsd
     http://www.springframework.org/schema/data/jpa
     https://www.springframework.org/schema/data/jpa/spring-jpa.xsd"&gt;

   &lt;jpa:repositories base-package="com.acme.repositories"/&gt;

&lt;/beans&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The JPA namespace is used in this example. If you use the repository abstraction for any other store, you need to change this to the appropriate namespace declaration of your store module. In other words, you should exchange <code>jpa</code> in favor of, for example, <code>mongodb</code>.</p>
</div>
<div class="paragraph">
<p>Also, note that the JavaConfig variant does not configure a package explicitly, because the package of the annotated class is used by default. To customize the package to scan, use one of the <code>basePackage…</code> attributes of the data-store-specific repository&#8217;s <code>@Enable${store}Repositories</code>-annotation.</p>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>Inject the repository instance and use it, as shown in the following example:</p>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">class SomeClient {

  private final PersonRepository repository;

  SomeClient(PersonRepository repository) {
    this.repository = repository;
  }

  void doSomething() {
    List&lt;Person&gt; persons = repository.findByLastname("Matthews");
  }
}</code></pre>
</div>
</div>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>The sections that follow explain each step in detail:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="index.html#repositories.definition">Defining Repository Interfaces</a></p>
</li>
<li>
<p><a href="index.html#repositories.query-methods.details">Defining Query Methods</a></p>
</li>
<li>
<p><a href="index.html#repositories.create-instances">Creating Repository Instances</a></p>
</li>
<li>
<p><a href="index.html#repositories.custom-implementations">Custom Implementations for Spring Data Repositories</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="repositories.definition"><a class="anchor" href="index.html#repositories.definition"></a>8.3. Defining Repository Interfaces</h3>
<div class="paragraph">
<p>To define a repository interface, you first need to define a domain class-specific repository interface. The interface must extend <code>Repository</code> and be typed to the domain class and an ID type. If you want to expose CRUD methods for that domain type, extend <code>CrudRepository</code> instead of <code>Repository</code>.</p>
</div>
<div class="sect3">
<h4 id="repositories.definition-tuning"><a class="anchor" href="index.html#repositories.definition-tuning"></a>8.3.1. Fine-tuning Repository Definition</h4>
<div class="paragraph">
<p>Typically, your repository interface extends <code>Repository</code>, <code>CrudRepository</code>, or <code>PagingAndSortingRepository</code>. Alternatively, if you do not want to extend Spring Data interfaces, you can also annotate your repository interface with <code>@RepositoryDefinition</code>. Extending <code>CrudRepository</code> exposes a complete set of methods to manipulate your entities. If you prefer to be selective about the methods being exposed, copy the methods you want to expose from <code>CrudRepository</code> into your domain repository.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Doing so lets you define your own abstractions on top of the provided Spring Data Repositories functionality.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The following example shows how to selectively expose CRUD methods (<code>findById</code> and <code>save</code>, in this case):</p>
</div>
<div class="exampleblock">
<div class="title">Example 7. Selectively exposing CRUD methods</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">@NoRepositoryBean
interface MyBaseRepository&lt;T, ID&gt; extends Repository&lt;T, ID&gt; {

  Optional&lt;T&gt; findById(ID id);

  &lt;S extends T&gt; S save(S entity);
}

interface UserRepository extends MyBaseRepository&lt;User, Long&gt; {
  User findByEmailAddress(EmailAddress emailAddress);
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>In the prior example, you defined a common base interface for all your domain repositories and exposed <code>findById(…)</code> as well as <code>save(…)</code>.These methods are routed into the base repository implementation of the store of your choice provided by Spring Data (for example, if you use JPA, the implementation is <code>SimpleJpaRepository</code>), because they match the method signatures in <code>CrudRepository</code>. So the <code>UserRepository</code> can now save users, find individual users by ID, and trigger a query to find <code>Users</code> by email address.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The intermediate repository interface is annotated with <code>@NoRepositoryBean</code>. Make sure you add that annotation to all repository interfaces for which Spring Data should not create instances at runtime.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="repositories.multiple-modules"><a class="anchor" href="index.html#repositories.multiple-modules"></a>8.3.2. Using Repositories with Multiple Spring Data Modules</h4>
<div class="paragraph">
<p>Using a unique Spring Data module in your application makes things simple, because all repository interfaces in the defined scope are bound to the Spring Data module. Sometimes, applications require using more than one Spring Data module. In such cases, a repository definition must distinguish between persistence technologies. When it detects multiple repository factories on the class path, Spring Data enters strict repository configuration mode. Strict configuration uses details on the repository or the domain class to decide about Spring Data module binding for a repository definition:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>If the repository definition <a href="index.html#repositories.multiple-modules.types">extends the module-specific repository</a>, it is a valid candidate for the particular Spring Data module.</p>
</li>
<li>
<p>If the domain class is <a href="index.html#repositories.multiple-modules.annotations">annotated with the module-specific type annotation</a>, it is a valid candidate for the particular Spring Data module. Spring Data modules accept either third-party annotations (such as JPA&#8217;s <code>@Entity</code>) or provide their own annotations (such as <code>@Document</code> for Spring Data MongoDB and Spring Data Elasticsearch).</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The following example shows a repository that uses module-specific interfaces (JPA in this case):</p>
</div>
<div id="repositories.multiple-modules.types" class="exampleblock">
<div class="title">Example 8. Repository definitions using module-specific interfaces</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">interface MyRepository extends JpaRepository&lt;User, Long&gt; { }

@NoRepositoryBean
interface MyBaseRepository&lt;T, ID&gt; extends JpaRepository&lt;T, ID&gt; { … }

interface UserRepository extends MyBaseRepository&lt;User, Long&gt; { … }</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>MyRepository</code> and <code>UserRepository</code> extend <code>JpaRepository</code> in their type hierarchy. They are valid candidates for the Spring Data JPA module.</p>
</div>
</div>
</div>
<div class="paragraph">
<p>The following example shows a repository that uses generic interfaces:</p>
</div>
<div class="exampleblock">
<div class="title">Example 9. Repository definitions using generic interfaces</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">interface AmbiguousRepository extends Repository&lt;User, Long&gt; { … }

@NoRepositoryBean
interface MyBaseRepository&lt;T, ID&gt; extends CrudRepository&lt;T, ID&gt; { … }

interface AmbiguousUserRepository extends MyBaseRepository&lt;User, Long&gt; { … }</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>AmbiguousRepository</code> and <code>AmbiguousUserRepository</code> extend only <code>Repository</code> and <code>CrudRepository</code> in their type hierarchy. While this is fine when using a unique Spring Data module, multiple modules cannot distinguish to which particular Spring Data these repositories should be bound.</p>
</div>
</div>
</div>
<div class="paragraph">
<p>The following example shows a repository that uses domain classes with annotations:</p>
</div>
<div id="repositories.multiple-modules.annotations" class="exampleblock">
<div class="title">Example 10. Repository definitions using domain classes with annotations</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">interface PersonRepository extends Repository&lt;Person, Long&gt; { … }

@Entity
class Person { … }

interface UserRepository extends Repository&lt;User, Long&gt; { … }

@Document
class User { … }</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>PersonRepository</code> references <code>Person</code>, which is annotated with the JPA <code>@Entity</code> annotation, so this repository clearly belongs to Spring Data JPA. <code>UserRepository</code> references <code>User</code>, which is annotated with Spring Data MongoDB&#8217;s <code>@Document</code> annotation.</p>
</div>
</div>
</div>
<div class="paragraph">
<p>The following bad example shows a repository that uses domain classes with mixed annotations:</p>
</div>
<div class="exampleblock">
<div class="title">Example 11. Repository definitions using domain classes with mixed annotations</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">interface JpaPersonRepository extends Repository&lt;Person, Long&gt; { … }

interface MongoDBPersonRepository extends Repository&lt;Person, Long&gt; { … }

@Entity
@Document
class Person { … }</code></pre>
</div>
</div>
<div class="paragraph">
<p>This example shows a domain class using both JPA and Spring Data MongoDB annotations. It defines two repositories, <code>JpaPersonRepository</code> and <code>MongoDBPersonRepository</code>. One is intended for JPA and the other for MongoDB usage. Spring Data is no longer able to tell the repositories apart, which leads to undefined behavior.</p>
</div>
</div>
</div>
<div class="paragraph">
<p><a href="index.html#repositories.multiple-modules.types">Repository type details</a> and <a href="index.html#repositories.multiple-modules.annotations">distinguishing domain class annotations</a> are used for strict repository configuration to identify repository candidates for a particular Spring Data module. Using multiple persistence technology-specific annotations on the same domain type is possible and enables reuse of domain types across multiple persistence technologies. However, Spring Data can then no longer determine a unique module with which to bind the repository.</p>
</div>
<div class="paragraph">
<p>The last way to distinguish repositories is by scoping repository base packages. Base packages define the starting points for scanning for repository interface definitions, which implies having repository definitions located in the appropriate packages. By default, annotation-driven configuration uses the package of the configuration class. The <a href="index.html#repositories.create-instances.spring">base package in XML-based configuration</a> is mandatory.</p>
</div>
<div class="paragraph">
<p>The following example shows annotation-driven configuration of base packages:</p>
</div>
<div class="exampleblock">
<div class="title">Example 12. Annotation-driven configuration of base packages</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">@EnableJpaRepositories(basePackages = "com.acme.repositories.jpa")
@EnableMongoRepositories(basePackages = "com.acme.repositories.mongo")
class Configuration { … }</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="repositories.query-methods.details"><a class="anchor" href="index.html#repositories.query-methods.details"></a>8.4. Defining Query Methods</h3>
<div class="paragraph">
<p>The repository proxy has two ways to derive a store-specific query from the method name:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>By deriving the query from the method name directly.</p>
</li>
<li>
<p>By using a manually defined query.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Available options depend on the actual store. However, there must be a strategy that decides what actual query is created. The next section describes the available options.</p>
</div>
<div class="sect3">
<h4 id="repositories.query-methods.query-lookup-strategies"><a class="anchor" href="index.html#repositories.query-methods.query-lookup-strategies"></a>8.4.1. Query Lookup Strategies</h4>
<div class="paragraph">
<p>The following strategies are available for the repository infrastructure to resolve the query. With XML configuration, you can configure the strategy at the namespace through the <code>query-lookup-strategy</code> attribute. For Java configuration, you can use the <code>queryLookupStrategy</code> attribute of the <code>Enable${store}Repositories</code> annotation. Some strategies may not be supported for particular datastores.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>CREATE</code> attempts to construct a store-specific query from the query method name. The general approach is to remove a given set of well known prefixes from the method name and parse the rest of the method. You can read more about query construction in &#8220;<a href="index.html#repositories.query-methods.query-creation">Query Creation</a>&#8221;.</p>
</li>
<li>
<p><code>USE_DECLARED_QUERY</code> tries to find a declared query and throws an exception if it cannot find one. The query can be defined by an annotation somewhere or declared by other means. See the documentation of the specific store to find available options for that store. If the repository infrastructure does not find a declared query for the method at bootstrap time, it fails.</p>
</li>
<li>
<p><code>CREATE_IF_NOT_FOUND</code> (the default) combines <code>CREATE</code> and <code>USE_DECLARED_QUERY</code>. It looks up a declared query first, and, if no declared query is found, it creates a custom method name-based query. This is the default lookup strategy and, thus, is used if you do not configure anything explicitly. It allows quick query definition by method names but also custom-tuning of these queries by introducing declared queries as needed.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="repositories.query-methods.query-creation"><a class="anchor" href="index.html#repositories.query-methods.query-creation"></a>8.4.2. Query Creation</h4>
<div class="paragraph">
<p>The query builder mechanism built into the Spring Data repository infrastructure is useful for building constraining queries over entities of the repository. The mechanism strips the <code>find…By</code>, <code>read…By</code>, <code>query…By</code>, <code>count…By</code>, and <code>get…By</code> prefixes from the method and starts parsing the rest of it. The introducing clause can contain further expressions, such as a <code>Distinct</code> to set a distinct flag on the query to be created. However, the first <code>By</code> acts as a delimiter to indicate the start of the actual criteria. At a very basic level, you can define conditions on entity properties and concatenate them with <code>And</code> and <code>Or</code>. The following example shows how to create a number of queries:</p>
</div>
<div class="exampleblock">
<div class="title">Example 13. Query creation from method names</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">interface PersonRepository extends Repository&lt;Person, Long&gt; {

  List&lt;Person&gt; findByEmailAddressAndLastname(EmailAddress emailAddress, String lastname);

  // Enables the distinct flag for the query
  List&lt;Person&gt; findDistinctPeopleByLastnameOrFirstname(String lastname, String firstname);
  List&lt;Person&gt; findPeopleDistinctByLastnameOrFirstname(String lastname, String firstname);

  // Enabling ignoring case for an individual property
  List&lt;Person&gt; findByLastnameIgnoreCase(String lastname);
  // Enabling ignoring case for all suitable properties
  List&lt;Person&gt; findByLastnameAndFirstnameAllIgnoreCase(String lastname, String firstname);

  // Enabling static ORDER BY for a query
  List&lt;Person&gt; findByLastnameOrderByFirstnameAsc(String lastname);
  List&lt;Person&gt; findByLastnameOrderByFirstnameDesc(String lastname);
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The actual result of parsing the method depends on the persistence store for which you create the query. However, there are some general things to notice:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The expressions are usually property traversals combined with operators that can be concatenated. You can combine property expressions with <code>AND</code> and <code>OR</code>. You also get support for operators such as <code>Between</code>, <code>LessThan</code>, <code>GreaterThan</code>, and <code>Like</code> for the property expressions. The supported operators can vary by datastore, so consult the appropriate part of your reference documentation.</p>
</li>
<li>
<p>The method parser supports setting an <code>IgnoreCase</code> flag for individual properties (for example, <code>findByLastnameIgnoreCase(…)</code>) or for all properties of a type that supports ignoring case (usually <code>String</code> instances&#8201;&#8212;&#8201;for example, <code>findByLastnameAndFirstnameAllIgnoreCase(…)</code>). Whether ignoring cases is supported may vary by store, so consult the relevant sections in the reference documentation for the store-specific query method.</p>
</li>
<li>
<p>You can apply static ordering by appending an <code>OrderBy</code> clause to the query method that references a property and by providing a sorting direction (<code>Asc</code> or <code>Desc</code>). To create a query method that supports dynamic sorting, see &#8220;<a href="index.html#repositories.special-parameters">Special parameter handling</a>&#8221;.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="repositories.query-methods.query-property-expressions"><a class="anchor" href="index.html#repositories.query-methods.query-property-expressions"></a>8.4.3. Property Expressions</h4>
<div class="paragraph">
<p>Property expressions can refer only to a direct property of the managed entity, as shown in the preceding example. At query creation time, you already make sure that the parsed property is a property of the managed domain class. However, you can also define constraints by traversing nested properties. Consider the following method signature:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">List&lt;Person&gt; findByAddressZipCode(ZipCode zipCode);</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Assume a <code>Person</code> has an <code>Address</code> with a <code>ZipCode</code>. In that case, the method creates the <code>x.address.zipCode</code> property traversal. The resolution algorithm starts by interpreting the entire part (<code>AddressZipCode</code>) as the property and checks the domain class for a property with that name (uncapitalized). If the algorithm succeeds, it uses that property. If not, the algorithm splits up the source at the camel-case parts from the right side into a head and a tail and tries to find the corresponding property&#8201;&#8212;&#8201;in our example, <code>AddressZip</code> and <code>Code</code>. If the algorithm finds a property with that head, it takes the tail and continues building the tree down from there, splitting the tail up in the way just described. If the first split does not match, the algorithm moves the split point to the left (<code>Address</code>, <code>ZipCode</code>) and continues.</p>
</div>
<div class="paragraph">
<p>Although this should work for most cases, it is possible for the algorithm to select the wrong property. Suppose the <code>Person</code> class has an <code>addressZip</code> property as well. The algorithm would match in the first split round already, choose the wrong property, and fail (as the type of <code>addressZip</code> probably has no <code>code</code> property).</p>
</div>
<div class="paragraph">
<p>To resolve this ambiguity you can use <code>_</code> inside your method name to manually define traversal points. So our method name would be as follows:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">List&lt;Person&gt; findByAddress_ZipCode(ZipCode zipCode);</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Because we treat the underscore character as a reserved character, we strongly advise following standard Java naming conventions (that is, not using underscores in property names but using camel case instead).</p>
</div>
</div>
<div class="sect3">
<h4 id="repositories.special-parameters"><a class="anchor" href="index.html#repositories.special-parameters"></a>8.4.4. Special parameter handling</h4>
<div class="paragraph">
<p>To handle parameters in your query, define method parameters as already seen in the preceding examples. Besides that, the infrastructure recognizes certain specific types like <code>Pageable</code> and <code>Sort</code>, to apply pagination and sorting to your queries dynamically. The following example demonstrates these features:</p>
</div>
<div class="exampleblock">
<div class="title">Example 14. Using <code>Pageable</code>, <code>Slice</code>, and <code>Sort</code> in query methods</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">Page&lt;User&gt; findByLastname(String lastname, Pageable pageable);

Slice&lt;User&gt; findByLastname(String lastname, Pageable pageable);

List&lt;User&gt; findByLastname(String lastname, Sort sort);

List&lt;User&gt; findByLastname(String lastname, Pageable pageable);</code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
APIs taking <code>Sort</code> and <code>Pageable</code> expect non-<code>null</code> values to be handed into methods.
If you do not want to apply any sorting or pagination, use <code>Sort.unsorted()</code> and <code>Pageable.unpaged()</code>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The first method lets you pass an <code>org.springframework.data.domain.Pageable</code> instance to the query method to dynamically add paging to your statically defined query. A <code>Page</code> knows about the total number of elements and pages available. It does so by the infrastructure triggering a count query to calculate the overall number. As this might be expensive (depending on the store used), you can instead return a <code>Slice</code>. A <code>Slice</code> knows only about whether a next <code>Slice</code> is available, which might be sufficient when walking through a larger result set.</p>
</div>
<div class="paragraph">
<p>Sorting options are handled through the <code>Pageable</code> instance, too. If you need only sorting, add an <code>org.springframework.data.domain.Sort</code> parameter to your method. As you can see, returning a <code>List</code> is also possible. In this case, the additional metadata required to build the actual <code>Page</code> instance is not created (which, in turn, means that the additional count query that would have been necessary is not issued). Rather, it restricts the query to look up only the given range of entities.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
To find out how many pages you get for an entire query, you have to trigger an additional count query. By default, this query is derived from the query you actually trigger.
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="repositories.paging-and-sorting"><a class="anchor" href="index.html#repositories.paging-and-sorting"></a>Paging and Sorting</h5>
<div class="paragraph">
<p>You can define simple sorting expressions by using property names.
You can concatenate expressions to collect multiple criteria into one expression.</p>
</div>
<div class="exampleblock">
<div class="title">Example 15. Defining sort expressions</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">Sort sort = Sort.by("firstname").ascending()
  .and(Sort.by("lastname").descending());</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>For a more type-safe way to define sort expressions, start with the type for which to define the sort expression and use method references to define the properties on which to sort.</p>
</div>
<div class="exampleblock">
<div class="title">Example 16. Defining sort expressions by using the type-safe API</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">TypedSort&lt;Person&gt; person = Sort.sort(Person.class);

Sort sort = person.by(Person::getFirstname).ascending()
  .and(person.by(Person::getLastname).descending());</code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<code>TypedSort.by(…)</code> makes use of runtime proxies by (typically) using CGlib, which may interfere with native image compilation when using tools such as Graal VM Native.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If your store implementation supports Querydsl, you can also use the generated metamodel types to define sort expressions:</p>
</div>
<div class="exampleblock">
<div class="title">Example 17. Defining sort expressions by using the Querydsl API</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">QSort sort = QSort.by(QPerson.firstname.asc())
  .and(QSort.by(QPerson.lastname.desc()));</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="repositories.limit-query-result"><a class="anchor" href="index.html#repositories.limit-query-result"></a>8.4.5. Limiting Query Results</h4>
<div class="paragraph">
<p>You can limit the results of query methods by using the <code>first</code> or <code>top</code> keywords, which you can use interchangeably. You can append an optional numeric value to <code>top</code> or <code>first</code> to specify the maximum result size to be returned.
If the number is left out, a result size of 1 is assumed. The following example shows how to limit the query size:</p>
</div>
<div class="exampleblock">
<div class="title">Example 18. Limiting the result size of a query with <code>Top</code> and <code>First</code></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">User findFirstByOrderByLastnameAsc();

User findTopByOrderByAgeDesc();

Page&lt;User&gt; queryFirst10ByLastname(String lastname, Pageable pageable);

Slice&lt;User&gt; findTop3ByLastname(String lastname, Pageable pageable);

List&lt;User&gt; findFirst10ByLastname(String lastname, Sort sort);

List&lt;User&gt; findTop10ByLastname(String lastname, Pageable pageable);</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The limiting expressions also support the <code>Distinct</code> keyword. Also, for the queries that limit the result set to one instance, wrapping the result into with the <code>Optional</code> keyword is supported.</p>
</div>
<div class="paragraph">
<p>If pagination or slicing is applied to a limiting query pagination (and the calculation of the number of available pages), it is applied within the limited result.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Limiting the results in combination with dynamic sorting by using a <code>Sort</code> parameter lets you express query methods for the 'K' smallest as well as for the 'K' biggest elements.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="repositories.collections-and-iterables"><a class="anchor" href="index.html#repositories.collections-and-iterables"></a>8.4.6. Repository Methods Returning Collections or Iterables</h4>
<div class="paragraph">
<p>Query methods that return multiple results can use standard Java <code>Iterable</code>, <code>List</code>, and <code>Set</code>.
Beyond that, we support returning Spring Data&#8217;s <code>Streamable</code>, a custom extension of <code>Iterable</code>, as well as collection types provided by <a href="https://www.vavr.io/">Vavr</a>.</p>
</div>
<div class="sect4">
<h5 id="repositories.collections-and-iterables.streamable"><a class="anchor" href="index.html#repositories.collections-and-iterables.streamable"></a>Using Streamable as Query Method Return Type</h5>
<div class="paragraph">
<p>You can use <code>Streamable</code> as alternative to <code>Iterable</code> or any collection type.
It provides convenience methods to access a non-parallel <code>Stream</code> (missing from <code>Iterable</code>) and the ability to directly <code>….filter(…)</code> and <code>….map(…)</code> over the elements and concatenate the <code>Streamable</code> to others:</p>
</div>
<div class="exampleblock">
<div class="title">Example 19. Using Streamable to combine query method results</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">interface PersonRepository extends Repository&lt;Person, Long&gt; {
  Streamable&lt;Person&gt; findByFirstnameContaining(String firstname);
  Streamable&lt;Person&gt; findByLastnameContaining(String lastname);
}

Streamable&lt;Person&gt; result = repository.findByFirstnameContaining("av")
  .and(repository.findByLastnameContaining("ea"));</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="repositories.collections-and-iterables.streamable-wrapper"><a class="anchor" href="index.html#repositories.collections-and-iterables.streamable-wrapper"></a>Returning Custom Streamable Wrapper Types</h5>
<div class="paragraph">
<p>Providing dedicated wrapper types for collections is a commonly used pattern to provide an API for a query result that returns multiple elements.
Usually, these types are used by invoking a repository method returning a collection-like type and creating an instance of the wrapper type manually.
You can avoid that additional step as Spring Data lets you use these wrapper types as query method return types if they meet the following criteria:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The type implements <code>Streamable</code>.</p>
</li>
<li>
<p>The type exposes either a constructor or a static factory method named <code>of(…)</code> or <code>valueOf(…)</code> that takes <code>Streamable</code> as an argument.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The following listing shows an example:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">class Product { <i class="conum" data-value="1"></i><b>(1)</b>
  MonetaryAmount getPrice() { … }
}

@RequiredArgConstructor(staticName = "of")
class Products implements Streamable&lt;Product&gt; { <i class="conum" data-value="2"></i><b>(2)</b>

  private Streamable&lt;Product&gt; streamable;

  public MonetaryAmount getTotal() { <i class="conum" data-value="3"></i><b>(3)</b>
    return streamable.stream() //
      .map(Priced::getPrice)
      .reduce(Money.of(0), MonetaryAmount::add);
  }
}

interface ProductRepository implements Repository&lt;Product, Long&gt; {
  Products findAllByDescriptionContaining(String text); <i class="conum" data-value="4"></i><b>(4)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>A <code>Product</code> entity that exposes API to access the product&#8217;s price.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>A wrapper type for a <code>Streamable&lt;Product&gt;</code> that can be constructed by using <code>Products.of(…)</code> (factory method created with the Lombok annotation).</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The wrapper type exposes an additional API, calculating new values on the <code>Streamable&lt;Product&gt;</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>That wrapper type can be used as a query method return type directly. You need not return <code>Streamable&lt;Product&gt;</code> and manually wrap it in the repository client.</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="repositories.collections-and-iterables.vavr"><a class="anchor" href="index.html#repositories.collections-and-iterables.vavr"></a>Support for Vavr Collections</h5>
<div class="paragraph">
<p><a href="https://www.vavr.io/">Vavr</a> is a library that embraces functional programming concepts in Java.
It ships with a custom set of collection types that you can use as query method return types, as the following table shows:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Vavr collection type</th>
<th class="tableblock halign-left valign-top">Used Vavr implementation type</th>
<th class="tableblock halign-left valign-top">Valid Java source types</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>io.vavr.collection.Seq</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>io.vavr.collection.List</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>java.util.Iterable</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>io.vavr.collection.Set</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>io.vavr.collection.LinkedHashSet</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>java.util.Iterable</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>io.vavr.collection.Map</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>io.vavr.collection.LinkedHashMap</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>java.util.Map</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>You can use the types in the first column (or subtypes thereof) as query method return types and get the types in the second column used as implementation type, depending on the Java type of the actual query result (third column).
Alternatively, you can declare <code>Traversable</code> (the Vavr <code>Iterable</code> equivalent), and we then derive the implementation class from the actual return value. That is, a <code>java.util.List</code> is turned into a Vavr <code>List</code> or <code>Seq</code>, a <code>java.util.Set</code> becomes a Vavr <code>LinkedHashSet</code> <code>Set</code>, and so on.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="repositories.nullability"><a class="anchor" href="index.html#repositories.nullability"></a>8.4.7. Null Handling of Repository Methods</h4>
<div class="paragraph">
<p>As of Spring Data 2.0, repository CRUD methods that return an individual aggregate instance use Java 8&#8217;s <code>Optional</code> to indicate the potential absence of a value.
Besides that, Spring Data supports returning the following wrapper types on query methods:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>com.google.common.base.Optional</code></p>
</li>
<li>
<p><code>scala.Option</code></p>
</li>
<li>
<p><code>io.vavr.control.Option</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Alternatively, query methods can choose not to use a wrapper type at all.
The absence of a query result is then indicated by returning <code>null</code>.
Repository methods returning collections, collection alternatives, wrappers, and streams are guaranteed never to return <code>null</code> but rather the corresponding empty representation.
See &#8220;<a href="index.html#repository-query-return-types">Repository query return types</a>&#8221; for details.</p>
</div>
<div class="sect4">
<h5 id="repositories.nullability.annotations"><a class="anchor" href="index.html#repositories.nullability.annotations"></a>Nullability Annotations</h5>
<div class="paragraph">
<p>You can express nullability constraints for repository methods by using <a href="https://docs.spring.io/spring/docs/5.3.1/spring-framework-reference/core.html#null-safety">Spring Framework&#8217;s nullability annotations</a>.
They provide a tooling-friendly approach and opt-in <code>null</code> checks during runtime, as follows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="../../../../../../spring/docs/5.3.1/javadoc-api/org/springframework/lang/NonNullApi.html"><code>@NonNullApi</code></a>: Used on the package level to declare that the default behavior for parameters and return values is, respectively, neither to accept nor to produce <code>null</code> values.</p>
</li>
<li>
<p><a href="../../../../../../spring/docs/5.3.1/javadoc-api/org/springframework/lang/NonNull.html"><code>@NonNull</code></a>: Used on a parameter or return value that must not be <code>null</code> (not needed on a parameter and return value where <code>@NonNullApi</code> applies).</p>
</li>
<li>
<p><a href="../../../../../../spring/docs/5.3.1/javadoc-api/org/springframework/lang/Nullable.html"><code>@Nullable</code></a>: Used on a parameter or return value that can be <code>null</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Spring annotations are meta-annotated with <a href="https://jcp.org/en/jsr/detail?id=305">JSR 305</a> annotations (a dormant but widely used JSR). JSR 305 meta-annotations let tooling vendors (such as <a href="https://www.jetbrains.com/help/idea/nullable-and-notnull-annotations.html">IDEA</a>, <a href="https://help.eclipse.org/oxygen/index.jsp?topic=/org.eclipse.jdt.doc.user/tasks/task-using_external_null_annotations.htm">Eclipse</a>, and <a href="https://kotlinlang.org/docs/reference/java-interop.html#null-safety-and-platform-types">Kotlin</a>) provide null-safety support in a generic way, without having to hard-code support for Spring annotations.
To enable runtime checking of nullability constraints for query methods, you need to activate non-nullability on the package level by using Spring’s <code>@NonNullApi</code> in <code>package-info.java</code>, as shown in the following example:</p>
</div>
<div class="exampleblock">
<div class="title">Example 20. Declaring Non-nullability in <code>package-info.java</code></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">@org.springframework.lang.NonNullApi
package com.acme;</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Once non-null defaulting is in place, repository query method invocations get validated at runtime for nullability constraints.
If a query result violates the defined constraint, an exception is thrown. This happens when the method would return <code>null</code> but is declared as non-nullable (the default with the annotation defined on the package in which the repository resides).
If you want to opt-in to nullable results again, selectively use <code>@Nullable</code> on individual methods.
Using the result wrapper types mentioned at the start of this section continues to work as expected: an empty result is translated into the value that represents absence.</p>
</div>
<div class="paragraph">
<p>The following example shows a number of the techniques just described:</p>
</div>
<div class="exampleblock">
<div class="title">Example 21. Using different nullability constraints</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">package com.acme;                                                       <i class="conum" data-value="1"></i><b>(1)</b>

import org.springframework.lang.Nullable;

interface UserRepository extends Repository&lt;User, Long&gt; {

  User getByEmailAddress(EmailAddress emailAddress);                    <i class="conum" data-value="2"></i><b>(2)</b>

  @Nullable
  User findByEmailAddress(@Nullable EmailAddress emailAdress);          <i class="conum" data-value="3"></i><b>(3)</b>

  Optional&lt;User&gt; findOptionalByEmailAddress(EmailAddress emailAddress); <i class="conum" data-value="4"></i><b>(4)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The repository resides in a package (or sub-package) for which we have defined non-null behavior.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Throws an <code>EmptyResultDataAccessException</code> when the query does not produce a result. Throws an <code>IllegalArgumentException</code> when the <code>emailAddress</code> handed to the method is <code>null</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Returns <code>null</code> when the query does not produce a result. Also accepts <code>null</code> as the value for <code>emailAddress</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Returns <code>Optional.empty()</code> when the query does not produce a result. Throws an <code>IllegalArgumentException</code> when the <code>emailAddress</code> handed to the method is <code>null</code>.</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="repositories.nullability.kotlin"><a class="anchor" href="index.html#repositories.nullability.kotlin"></a>Nullability in Kotlin-based Repositories</h5>
<div class="paragraph">
<p>Kotlin has the definition of <a href="https://kotlinlang.org/docs/reference/null-safety.html">nullability constraints</a> baked into the language.
Kotlin code compiles to bytecode, which does not express nullability constraints through method signatures but rather through compiled-in metadata. Make sure to include the <code>kotlin-reflect</code> JAR in your project to enable introspection of Kotlin&#8217;s nullability constraints.
Spring Data repositories use the language mechanism to define those constraints to apply the same runtime checks, as follows:</p>
</div>
<div class="exampleblock">
<div class="title">Example 22. Using nullability constraints on Kotlin repositories</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="kotlin" class="language-kotlin hljs">interface UserRepository : Repository&lt;User, String&gt; {

  fun findByUsername(username: String): User     <i class="conum" data-value="1"></i><b>(1)</b>

  fun findByFirstname(firstname: String?): User? <i class="conum" data-value="2"></i><b>(2)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The method defines both the parameter and the result as non-nullable (the Kotlin default). The Kotlin compiler rejects method invocations that pass <code>null</code> to the method. If the query yields an empty result, an <code>EmptyResultDataAccessException</code> is thrown.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>This method accepts <code>null</code> for the <code>firstname</code> parameter and returns <code>null</code> if the query does not produce a result.</td>
</tr>
</table>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="repositories.query-streaming"><a class="anchor" href="index.html#repositories.query-streaming"></a>8.4.8. Streaming Query Results</h4>
<div class="paragraph">
<p>You can process the results of query methods incrementally by using a Java 8 <code>Stream&lt;T&gt;</code> as the return type. Instead of wrapping the query results in a <code>Stream</code>, data store-specific methods are used to perform the streaming, as shown in the following example:</p>
</div>
<div class="exampleblock">
<div class="title">Example 23. Stream the result of a query with Java 8 <code>Stream&lt;T&gt;</code></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">@Query("select u from User u")
Stream&lt;User&gt; findAllByCustomQueryAndStream();

Stream&lt;User&gt; readAllByFirstnameNotNull();

@Query("select u from User u")
Stream&lt;User&gt; streamAllPaged(Pageable pageable);</code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
A <code>Stream</code> potentially wraps underlying data store-specific resources and must, therefore, be closed after usage. You can either manually close the <code>Stream</code> by using the <code>close()</code> method or by using a Java 7 <code>try-with-resources</code> block, as shown in the following example:
</td>
</tr>
</table>
</div>
<div class="exampleblock">
<div class="title">Example 24. Working with a <code>Stream&lt;T&gt;</code> result in a <code>try-with-resources</code> block</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">try (Stream&lt;User&gt; stream = repository.findAllByCustomQueryAndStream()) {
  stream.forEach(…);
}</code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Not all Spring Data modules currently support <code>Stream&lt;T&gt;</code> as a return type.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="repositories.query-async"><a class="anchor" href="index.html#repositories.query-async"></a>8.4.9. Asynchronous Query Results</h4>
<div class="paragraph">
<p>You can run repository queries asynchronously by using <a href="https://docs.spring.io/spring/docs/5.3.1/spring-framework-reference/integration.html#scheduling">Spring&#8217;s asynchronous method running capability</a>. This means the method returns immediately upon invocation while the actual query occurs in a task that has been submitted to a Spring <code>TaskExecutor</code>. Asynchronous queries differ from reactive queries and should not be mixed. See the store-specific documentation for more details on reactive support. The following example shows a number of asynchronous queries:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">@Async
Future&lt;User&gt; findByFirstname(String firstname);               <i class="conum" data-value="1"></i><b>(1)</b>

@Async
CompletableFuture&lt;User&gt; findOneByFirstname(String firstname); <i class="conum" data-value="2"></i><b>(2)</b>

@Async
ListenableFuture&lt;User&gt; findOneByLastname(String lastname);    <i class="conum" data-value="3"></i><b>(3)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Use <code>java.util.concurrent.Future</code> as the return type.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Use a Java 8 <code>java.util.concurrent.CompletableFuture</code> as the return type.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Use a <code>org.springframework.util.concurrent.ListenableFuture</code> as the return type.</td>
</tr>
</table>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="repositories.create-instances"><a class="anchor" href="index.html#repositories.create-instances"></a>8.5. Creating Repository Instances</h3>
<div class="paragraph">
<p>This section covers how to create instances and bean definitions for the defined repository interfaces. One way to do so is by using the Spring namespace that is shipped with each Spring Data module that supports the repository mechanism, although we generally recommend using Java configuration.</p>
</div>
<div class="sect3">
<h4 id="repositories.create-instances.spring"><a class="anchor" href="index.html#repositories.create-instances.spring"></a>8.5.1. XML Configuration</h4>
<div class="paragraph">
<p>Each Spring Data module includes a <code>repositories</code> element that lets you define a base package that Spring scans for you, as shown in the following example:</p>
</div>
<div class="exampleblock">
<div class="title">Example 25. Enabling Spring Data repositories via XML</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="xml" class="language-xml hljs">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;beans:beans xmlns:beans="http://www.springframework.org/schema/beans"
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xmlns="http://www.springframework.org/schema/data/jpa"
  xsi:schemaLocation="http://www.springframework.org/schema/beans
    https://www.springframework.org/schema/beans/spring-beans.xsd
    http://www.springframework.org/schema/data/jpa
    https://www.springframework.org/schema/data/jpa/spring-jpa.xsd"&gt;

  &lt;repositories base-package="com.acme.repositories" /&gt;

&lt;/beans:beans&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>In the preceding example, Spring is instructed to scan <code>com.acme.repositories</code> and all its sub-packages for interfaces extending <code>Repository</code> or one of its sub-interfaces.
For each interface found, the infrastructure registers the persistence technology-specific <code>FactoryBean</code> to create the appropriate proxies that handle invocations of the query methods.
Each bean is registered under a bean name that is derived from the interface name, so an interface of <code>UserRepository</code> would be registered under <code>userRepository</code>.
Bean names for nested repository interfaces are prefixed with their enclosing type name.
The <code>base-package</code> attribute allows wildcards so that you can define a pattern of scanned packages.</p>
</div>
<div class="sect4">
<h5 id="repositories.using-filters"><a class="anchor" href="index.html#repositories.using-filters"></a>Using Filters</h5>
<div class="paragraph">
<p>By default, the infrastructure picks up every interface that extends the persistence technology-specific <code>Repository</code> sub-interface located under the configured base package and creates a bean instance for it. However, you might want more fine-grained control over which interfaces have bean instances created for them. To do so, use <code>&lt;include-filter /&gt;</code> and <code>&lt;exclude-filter /&gt;</code> elements inside the <code>&lt;repositories /&gt;</code> element. The semantics are exactly equivalent to the elements in Spring&#8217;s context namespace. For details, see the <a href="https://docs.spring.io/spring/docs/5.3.1/spring-framework-reference/core.html#beans-scanning-filters">Spring reference documentation</a> for these elements.</p>
</div>
<div class="paragraph">
<p>For example, to exclude certain interfaces from instantiation as repository beans, you could use the following configuration:</p>
</div>
<div class="exampleblock">
<div class="title">Example 26. Using exclude-filter element</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="xml" class="language-xml hljs">&lt;repositories base-package="com.acme.repositories"&gt;
  &lt;context:exclude-filter type="regex" expression=".*SomeRepository" /&gt;
&lt;/repositories&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The preceding example excludes all interfaces ending in <code>SomeRepository</code> from being instantiated.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="repositories.create-instances.java-config"><a class="anchor" href="index.html#repositories.create-instances.java-config"></a>8.5.2. Java Configuration</h4>
<div class="paragraph">
<p>You can also trigger the repository infrastructure by using a store-specific <code>@Enable${store}Repositories</code> annotation on a Java configuration class. For an introduction to Java-based configuration of the Spring container, see <a href="https://docs.spring.io/spring/docs/5.3.1/spring-framework-reference/core.html#beans-java">JavaConfig in the Spring reference documentation</a>.</p>
</div>
<div class="paragraph">
<p>A sample configuration to enable Spring Data repositories resembles the following:</p>
</div>
<div class="exampleblock">
<div class="title">Example 27. Sample annotation-based repository configuration</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">@Configuration
@EnableJpaRepositories("com.acme.repositories")
class ApplicationConfiguration {

  @Bean
  EntityManagerFactory entityManagerFactory() {
    // …
  }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The preceding example uses the JPA-specific annotation, which you would change according to the store module you actually use. The same applies to the definition of the <code>EntityManagerFactory</code> bean. See the sections covering the store-specific configuration.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="repositories.create-instances.standalone"><a class="anchor" href="index.html#repositories.create-instances.standalone"></a>8.5.3. Standalone Usage</h4>
<div class="paragraph">
<p>You can also use the repository infrastructure outside of a Spring container&#8201;&#8212;&#8201;for example, in CDI environments. You still need some Spring libraries in your classpath, but, generally, you can set up repositories programmatically as well. The Spring Data modules that provide repository support ship with a persistence technology-specific <code>RepositoryFactory</code> that you can use, as follows:</p>
</div>
<div class="exampleblock">
<div class="title">Example 28. Standalone usage of the repository factory</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">RepositoryFactorySupport factory = … // Instantiate factory here
UserRepository repository = factory.getRepository(UserRepository.class);</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="repositories.custom-implementations"><a class="anchor" href="index.html#repositories.custom-implementations"></a>8.6. Custom Implementations for Spring Data Repositories</h3>
<div class="paragraph">
<p>This section covers repository customization and how fragments form a composite repository.</p>
</div>
<div class="paragraph">
<p>When a query method requires a different behavior or cannot be implemented by query derivation, you need to provide a custom implementation. Spring Data repositories let you provide custom repository code and integrate it with generic CRUD abstraction and query method functionality.</p>
</div>
<div class="sect3">
<h4 id="repositories.single-repository-behavior"><a class="anchor" href="index.html#repositories.single-repository-behavior"></a>8.6.1. Customizing Individual Repositories</h4>
<div class="paragraph">
<p>To enrich a repository with custom functionality, you must first define a fragment interface and an implementation for the custom functionality, as follows:</p>
</div>
<div class="exampleblock">
<div class="title">Example 29. Interface for custom repository functionality</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">interface CustomizedUserRepository {
  void someCustomMethod(User user);
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock">
<div class="title">Example 30. Implementation of custom repository functionality</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">class CustomizedUserRepositoryImpl implements CustomizedUserRepository {

  public void someCustomMethod(User user) {
    // Your custom implementation
  }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The most important part of the class name that corresponds to the fragment interface is the <code>Impl</code> postfix.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The implementation itself does not depend on Spring Data and can be a regular Spring bean. Consequently, you can use standard dependency injection behavior to inject references to other beans (such as a <code>JdbcTemplate</code>), take part in aspects, and so on.</p>
</div>
<div class="paragraph">
<p>Then you can let your repository interface extend the fragment interface, as follows:</p>
</div>
<div class="exampleblock">
<div class="title">Example 31. Changes to your repository interface</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">interface UserRepository extends CrudRepository&lt;User, Long&gt;, CustomizedUserRepository {

  // Declare query methods here
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Extending the fragment interface with your repository interface combines the CRUD and custom functionality and makes it available to clients.</p>
</div>
<div class="paragraph">
<p>Spring Data repositories are implemented by using fragments that form a repository composition. Fragments are the base repository, functional aspects (such as <a href="index.html#core.extensions.querydsl">QueryDsl</a>), and custom interfaces along with their implementations. Each time you add an interface to your repository interface, you enhance the composition by adding a fragment. The base repository and repository aspect implementations are provided by each Spring Data module.</p>
</div>
<div class="paragraph">
<p>The following example shows custom interfaces and their implementations:</p>
</div>
<div class="exampleblock">
<div class="title">Example 32. Fragments with their implementations</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">interface HumanRepository {
  void someHumanMethod(User user);
}

class HumanRepositoryImpl implements HumanRepository {

  public void someHumanMethod(User user) {
    // Your custom implementation
  }
}

interface ContactRepository {

  void someContactMethod(User user);

  User anotherContactMethod(User user);
}

class ContactRepositoryImpl implements ContactRepository {

  public void someContactMethod(User user) {
    // Your custom implementation
  }

  public User anotherContactMethod(User user) {
    // Your custom implementation
  }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The following example shows the interface for a custom repository that extends <code>CrudRepository</code>:</p>
</div>
<div class="exampleblock">
<div class="title">Example 33. Changes to your repository interface</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">interface UserRepository extends CrudRepository&lt;User, Long&gt;, HumanRepository, ContactRepository {

  // Declare query methods here
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Repositories may be composed of multiple custom implementations that are imported in the order of their declaration. Custom implementations have a higher priority than the base implementation and repository aspects. This ordering lets you override base repository and aspect methods and resolves ambiguity if two fragments contribute the same method signature. Repository fragments are not limited to use in a single repository interface. Multiple repositories may use a fragment interface, letting you reuse customizations across different repositories.</p>
</div>
<div class="paragraph">
<p>The following example shows a repository fragment and its implementation:</p>
</div>
<div class="exampleblock">
<div class="title">Example 34. Fragments overriding <code>save(…)</code></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">interface CustomizedSave&lt;T&gt; {
  &lt;S extends T&gt; S save(S entity);
}

class CustomizedSaveImpl&lt;T&gt; implements CustomizedSave&lt;T&gt; {

  public &lt;S extends T&gt; S save(S entity) {
    // Your custom implementation
  }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The following example shows a repository that uses the preceding repository fragment:</p>
</div>
<div class="exampleblock">
<div class="title">Example 35. Customized repository interfaces</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">interface UserRepository extends CrudRepository&lt;User, Long&gt;, CustomizedSave&lt;User&gt; {
}

interface PersonRepository extends CrudRepository&lt;Person, Long&gt;, CustomizedSave&lt;Person&gt; {
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="repositories.configuration"><a class="anchor" href="index.html#repositories.configuration"></a>Configuration</h5>
<div class="paragraph">
<p>If you use namespace configuration, the repository infrastructure tries to autodetect custom implementation fragments by scanning for classes below the package in which it found a repository. These classes need to follow the naming convention of appending the namespace element&#8217;s <code>repository-impl-postfix</code> attribute to the fragment interface name. This postfix defaults to <code>Impl</code>. The following example shows a repository that uses the default postfix and a repository that sets a custom value for the postfix:</p>
</div>
<div class="exampleblock">
<div class="title">Example 36. Configuration example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="xml" class="language-xml hljs">&lt;repositories base-package="com.acme.repository" /&gt;

&lt;repositories base-package="com.acme.repository" repository-impl-postfix="MyPostfix" /&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The first configuration in the preceding example tries to look up a class called <code>com.acme.repository.CustomizedUserRepositoryImpl</code> to act as a custom repository implementation. The second example tries to look up <code>com.acme.repository.CustomizedUserRepositoryMyPostfix</code>.</p>
</div>
<div class="sect5">
<h6 id="repositories.single-repository-behaviour.ambiguity"><a class="anchor" href="index.html#repositories.single-repository-behaviour.ambiguity"></a>Resolution of Ambiguity</h6>
<div class="paragraph">
<p>If multiple implementations with matching class names are found in different packages, Spring Data uses the bean names to identify which one to use.</p>
</div>
<div class="paragraph">
<p>Given the following two custom implementations for the <code>CustomizedUserRepository</code> shown earlier, the first implementation is used.
Its bean name is <code>customizedUserRepositoryImpl</code>, which matches that of the fragment interface (<code>CustomizedUserRepository</code>) plus the postfix <code>Impl</code>.</p>
</div>
<div class="exampleblock">
<div class="title">Example 37. Resolution of ambiguous implementations</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">package com.acme.impl.one;

class CustomizedUserRepositoryImpl implements CustomizedUserRepository {

  // Your custom implementation
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">package com.acme.impl.two;

@Component("specialCustomImpl")
class CustomizedUserRepositoryImpl implements CustomizedUserRepository {

  // Your custom implementation
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>If you annotate the <code>UserRepository</code> interface with <code>@Component("specialCustom")</code>, the bean name plus <code>Impl</code> then matches the one defined for the repository implementation in <code>com.acme.impl.two</code>, and it is used instead of the first one.</p>
</div>
</div>
<div class="sect5">
<h6 id="repositories.manual-wiring"><a class="anchor" href="index.html#repositories.manual-wiring"></a>Manual Wiring</h6>
<div class="paragraph">
<p>If your custom implementation uses annotation-based configuration and autowiring only, the preceding approach shown works well, because it is treated as any other Spring bean. If your implementation fragment bean needs special wiring, you can declare the bean and name it according to the conventions described in the <a href="index.html#repositories.single-repository-behaviour.ambiguity">preceding section</a>. The infrastructure then refers to the manually defined bean definition by name instead of creating one itself. The following example shows how to manually wire a custom implementation:</p>
</div>
<div class="exampleblock">
<div class="title">Example 38. Manual wiring of custom implementations</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="xml" class="language-xml hljs">&lt;repositories base-package="com.acme.repository" /&gt;

&lt;beans:bean id="userRepositoryImpl" class="…"&gt;
  &lt;!-- further configuration --&gt;
&lt;/beans:bean&gt;</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="repositories.customize-base-repository"><a class="anchor" href="index.html#repositories.customize-base-repository"></a>8.6.2. Customize the Base Repository</h4>
<div class="paragraph">
<p>The approach described in the <a href="index.html#repositories.manual-wiring">preceding section</a> requires customization of each repository interfaces when you want to customize the base repository behavior so that all repositories are affected. To instead change behavior for all repositories, you can create an implementation that extends the persistence technology-specific repository base class. This class then acts as a custom base class for the repository proxies, as shown in the following example:</p>
</div>
<div class="exampleblock">
<div class="title">Example 39. Custom repository base class</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">class MyRepositoryImpl&lt;T, ID&gt;
  extends SimpleJpaRepository&lt;T, ID&gt; {

  private final EntityManager entityManager;

  MyRepositoryImpl(JpaEntityInformation entityInformation,
                          EntityManager entityManager) {
    super(entityInformation, entityManager);

    // Keep the EntityManager around to used from the newly introduced methods.
    this.entityManager = entityManager;
  }

  @Transactional
  public &lt;S extends T&gt; S save(S entity) {
    // implementation goes here
  }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<i class="fa icon-caution" title="Caution"></i>
</td>
<td class="content">
The class needs to have a constructor of the super class which the store-specific repository factory implementation uses. If the repository base class has multiple constructors, override the one taking an <code>EntityInformation</code> plus a store specific infrastructure object (such as an <code>EntityManager</code> or a template class).
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The final step is to make the Spring Data infrastructure aware of the customized repository base class. In Java configuration, you can do so by using the <code>repositoryBaseClass</code> attribute of the <code>@Enable${store}Repositories</code> annotation, as shown in the following example:</p>
</div>
<div class="exampleblock">
<div class="title">Example 40. Configuring a custom repository base class using JavaConfig</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">@Configuration
@EnableJpaRepositories(repositoryBaseClass = MyRepositoryImpl.class)
class ApplicationConfiguration { … }</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>A corresponding attribute is available in the XML namespace, as shown in the following example:</p>
</div>
<div class="exampleblock">
<div class="title">Example 41. Configuring a custom repository base class using XML</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="xml" class="language-xml hljs">&lt;repositories base-package="com.acme.repository"
     base-class="….MyRepositoryImpl" /&gt;</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="core.domain-events"><a class="anchor" href="index.html#core.domain-events"></a>8.7. Publishing Events from Aggregate Roots</h3>
<div class="paragraph">
<p>Entities managed by repositories are aggregate roots.
In a Domain-Driven Design application, these aggregate roots usually publish domain events.
Spring Data provides an annotation called <code>@DomainEvents</code> that you can use on a method of your aggregate root to make that publication as easy as possible, as shown in the following example:</p>
</div>
<div class="exampleblock">
<div class="title">Example 42. Exposing domain events from an aggregate root</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">class AnAggregateRoot {

    @DomainEvents <i class="conum" data-value="1"></i><b>(1)</b>
    Collection&lt;Object&gt; domainEvents() {
        // … return events you want to get published here
    }

    @AfterDomainEventPublication <i class="conum" data-value="2"></i><b>(2)</b>
    void callbackMethod() {
       // … potentially clean up domain events list
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The method that uses <code>@DomainEvents</code> can return either a single event instance or a collection of events. It must not take any arguments.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>After all events have been published, we have a method annotated with <code>@AfterDomainEventPublication</code>. You can use it to potentially clean the list of events to be published (among other uses).</td>
</tr>
</table>
</div>
</div>
</div>
<div class="paragraph">
<p>The methods are called every time one of a Spring Data repository&#8217;s <code>save(…)</code>, <code>saveAll(…)</code>, <code>delete(…)</code> or <code>deleteAll(…)</code> methods are called.</p>
</div>
</div>
<div class="sect2">
<h3 id="core.extensions"><a class="anchor" href="index.html#core.extensions"></a>8.8. Spring Data Extensions</h3>
<div class="paragraph">
<p>This section documents a set of Spring Data extensions that enable Spring Data usage in a variety of contexts. Currently, most of the integration is targeted towards Spring MVC.</p>
</div>
<div class="sect3">
<h4 id="core.extensions.querydsl"><a class="anchor" href="index.html#core.extensions.querydsl"></a>8.8.1. Querydsl Extension</h4>
<div class="paragraph">
<p><a href="http://www.querydsl.com/">Querydsl</a> is a framework that enables the construction of statically typed SQL-like queries through its fluent API.</p>
</div>
<div class="paragraph">
<p>Several Spring Data modules offer integration with Querydsl through <code>QuerydslPredicateExecutor</code>, as the following example shows:</p>
</div>
<div class="exampleblock">
<div class="title">Example 43. QuerydslPredicateExecutor interface</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">public interface QuerydslPredicateExecutor&lt;T&gt; {

  Optional&lt;T&gt; findById(Predicate predicate);  <i class="conum" data-value="1"></i><b>(1)</b>

  Iterable&lt;T&gt; findAll(Predicate predicate);   <i class="conum" data-value="2"></i><b>(2)</b>

  long count(Predicate predicate);            <i class="conum" data-value="3"></i><b>(3)</b>

  boolean exists(Predicate predicate);        <i class="conum" data-value="4"></i><b>(4)</b>

  // … more functionality omitted.
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Finds and returns a single entity matching the <code>Predicate</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Finds and returns all entities matching the <code>Predicate</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Returns the number of entities matching the <code>Predicate</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Returns whether an entity that matches the <code>Predicate</code> exists.</td>
</tr>
</table>
</div>
</div>
</div>
<div class="paragraph">
<p>To use the Querydsl support, extend <code>QuerydslPredicateExecutor</code> on your repository interface, as the following example shows:</p>
</div>
<div class="exampleblock">
<div class="title">Example 44. Querydsl integration on repositories</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">interface UserRepository extends CrudRepository&lt;User, Long&gt;, QuerydslPredicateExecutor&lt;User&gt; {
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The preceding example lets you write type-safe queries by using Querydsl <code>Predicate</code> instances, as the following example shows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">Predicate predicate = user.firstname.equalsIgnoreCase("dave")
	.and(user.lastname.startsWithIgnoreCase("mathews"));

userRepository.findAll(predicate);</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="core.web"><a class="anchor" href="index.html#core.web"></a>8.8.2. Web support</h4>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
This section contains the documentation for the Spring Data web support as it is implemented in the current versions of Spring Data Commons. As the newly introduced support changes many things, we kept the documentation of the former behavior in <a href="index.html#web.legacy">[web.legacy]</a>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Spring Data modules that support the repository programming model ship with a variety of web support. The web related components require Spring MVC JARs to be on the classpath. Some of them even provide integration with <a href="https://github.com/spring-projects/spring-hateoas">Spring HATEOAS</a>. In general, the integration support is enabled by using the <code>@EnableSpringDataWebSupport</code> annotation in your JavaConfig configuration class, as the following example shows:</p>
</div>
<div class="exampleblock">
<div class="title">Example 45. Enabling Spring Data web support</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">@Configuration
@EnableWebMvc
@EnableSpringDataWebSupport
class WebConfiguration {}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The <code>@EnableSpringDataWebSupport</code> annotation registers a few components. We discuss those later in this section. It also detects Spring HATEOAS on the classpath and registers integration components (if present) for it as well.</p>
</div>
<div class="paragraph">
<p>Alternatively, if you use XML configuration, register either <code>SpringDataWebConfiguration</code> or <code>HateoasAwareSpringDataWebConfiguration</code> as Spring beans, as the following example shows (for <code>SpringDataWebConfiguration</code>):</p>
</div>
<div class="exampleblock">
<div class="title">Example 46. Enabling Spring Data web support in XML</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="xml" class="language-xml hljs">&lt;bean class="org.springframework.data.web.config.SpringDataWebConfiguration" /&gt;

&lt;!-- If you use Spring HATEOAS, register this one *instead* of the former --&gt;
&lt;bean class="org.springframework.data.web.config.HateoasAwareSpringDataWebConfiguration" /&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="core.web.basic"><a class="anchor" href="index.html#core.web.basic"></a>Basic Web Support</h5>
<div class="paragraph">
<p>The configuration shown in the <a href="index.html#core.web">previous section</a> registers a few basic components:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A <a href="index.html#core.web.basic.domain-class-converter">Using the <code>DomainClassConverter</code> Class</a> to let Spring MVC resolve instances of repository-managed domain classes from request parameters or path variables.</p>
</li>
<li>
<p><a href="index.html#core.web.basic.paging-and-sorting"><code>HandlerMethodArgumentResolver</code></a> implementations to let Spring MVC resolve <code>Pageable</code> and <code>Sort</code> instances from request parameters.</p>
</li>
</ul>
</div>
<div class="sect5">
<h6 id="core.web.basic.domain-class-converter"><a class="anchor" href="index.html#core.web.basic.domain-class-converter"></a>Using the <code>DomainClassConverter</code> Class</h6>
<div class="paragraph">
<p>The <code>DomainClassConverter</code> class lets you use domain types in your Spring MVC controller method signatures directly so that you need not manually lookup the instances through the repository, as the following example shows:</p>
</div>
<div class="exampleblock">
<div class="title">Example 47. A Spring MVC controller using domain types in method signatures</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">@Controller
@RequestMapping("/users")
class UserController {

  @RequestMapping("/{id}")
  String showUserForm(@PathVariable("id") User user, Model model) {

    model.addAttribute("user", user);
    return "userForm";
  }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The method receives a <code>User</code> instance directly, and no further lookup is necessary. The instance can be resolved by letting Spring MVC convert the path variable into the <code>id</code> type of the domain class first and eventually access the instance through calling <code>findById(…)</code> on the repository instance registered for the domain type.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Currently, the repository has to implement <code>CrudRepository</code> to be eligible to be discovered for conversion.
</td>
</tr>
</table>
</div>
</div>
<div class="sect5">
<h6 id="core.web.basic.paging-and-sorting"><a class="anchor" href="index.html#core.web.basic.paging-and-sorting"></a>HandlerMethodArgumentResolvers for Pageable and Sort</h6>
<div class="paragraph">
<p>The configuration snippet shown in the <a href="index.html#core.web.basic.domain-class-converter">previous section</a> also registers a <code>PageableHandlerMethodArgumentResolver</code> as well as an instance of <code>SortHandlerMethodArgumentResolver</code>. The registration enables <code>Pageable</code> and <code>Sort</code> as valid controller method arguments, as the following example shows:</p>
</div>
<div class="exampleblock">
<div class="title">Example 48. Using Pageable as a controller method argument</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">@Controller
@RequestMapping("/users")
class UserController {

  private final UserRepository repository;

  UserController(UserRepository repository) {
    this.repository = repository;
  }

  @RequestMapping
  String showUsers(Model model, Pageable pageable) {

    model.addAttribute("users", repository.findAll(pageable));
    return "users";
  }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The preceding method signature causes Spring MVC try to derive a <code>Pageable</code> instance from the request parameters by using the following default configuration:</p>
</div>
<table class="tableblock frame-all grid-all fit-content">
<caption class="title">Table 1. Request parameters evaluated for <code>Pageable</code> instances</caption>
<colgroup>
<col>
<col>
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>page</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Page you want to retrieve. 0-indexed and defaults to 0.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>size</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Size of the page you want to retrieve. Defaults to 20.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>sort</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Properties that should be sorted by in the format <code>property,property(,ASC|DESC)(,IgnoreCase)</code>. The default sort direction is case-sensitive ascending. Use multiple <code>sort</code> parameters if you want to switch direction or case sensitivity&#8201;&#8212;&#8201;for example, <code>?sort=firstname&amp;sort=lastname,asc&amp;sort=city,ignorecase</code>.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>To customize this behavior, register a bean that implements the <code>PageableHandlerMethodArgumentResolverCustomizer</code> interface or the <code>SortHandlerMethodArgumentResolverCustomizer</code> interface, respectively. Its <code>customize()</code> method gets called, letting you change settings, as the following example shows:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">@Bean SortHandlerMethodArgumentResolverCustomizer sortCustomizer() {
    return s -&gt; s.setPropertyDelimiter("&lt;--&gt;");
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>If setting the properties of an existing <code>MethodArgumentResolver</code> is not sufficient for your purpose, extend either <code>SpringDataWebConfiguration</code> or the HATEOAS-enabled equivalent, override the <code>pageableResolver()</code> or <code>sortResolver()</code> methods, and import your customized configuration file instead of using the <code>@Enable</code> annotation.</p>
</div>
<div class="paragraph">
<p>If you need multiple <code>Pageable</code> or <code>Sort</code> instances to be resolved from the request (for multiple tables, for example), you can use Spring&#8217;s <code>@Qualifier</code> annotation to distinguish one from another. The request parameters then have to be prefixed with <code>${qualifier}_</code>. The following example shows the resulting method signature:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">String showUsers(Model model,
      @Qualifier("thing1") Pageable first,
      @Qualifier("thing2") Pageable second) { … }</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>You have to populate <code>thing1_page</code>, <code>thing2_page</code>, and so on.</p>
</div>
<div class="paragraph">
<p>The default <code>Pageable</code> passed into the method is equivalent to a <code>PageRequest.of(0, 20)</code>, but you can customize it by using the <code>@PageableDefault</code> annotation on the <code>Pageable</code> parameter.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="core.web.pageables"><a class="anchor" href="index.html#core.web.pageables"></a>Hypermedia Support for Pageables</h5>
<div class="paragraph">
<p>Spring HATEOAS ships with a representation model class (<code>PagedResources</code>) that allows enriching the content of a <code>Page</code> instance with the necessary <code>Page</code> metadata as well as links to let the clients easily navigate the pages. The conversion of a <code>Page</code> to a <code>PagedResources</code> is done by an implementation of the Spring HATEOAS <code>ResourceAssembler</code> interface, called the <code>PagedResourcesAssembler</code>. The following example shows how to use a <code>PagedResourcesAssembler</code> as a controller method argument:</p>
</div>
<div class="exampleblock">
<div class="title">Example 49. Using a PagedResourcesAssembler as controller method argument</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">@Controller
class PersonController {

  @Autowired PersonRepository repository;

  @RequestMapping(value = "/persons", method = RequestMethod.GET)
  HttpEntity&lt;PagedResources&lt;Person&gt;&gt; persons(Pageable pageable,
    PagedResourcesAssembler assembler) {

    Page&lt;Person&gt; persons = repository.findAll(pageable);
    return new ResponseEntity&lt;&gt;(assembler.toResources(persons), HttpStatus.OK);
  }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Enabling the configuration, as shown in the preceding example, lets the <code>PagedResourcesAssembler</code> be used as a controller method argument. Calling <code>toResources(…)</code> on it has the following effects:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The content of the <code>Page</code> becomes the content of the <code>PagedResources</code> instance.</p>
</li>
<li>
<p>The <code>PagedResources</code> object gets a <code>PageMetadata</code> instance attached, and it is populated with information from the <code>Page</code> and the underlying <code>PageRequest</code>.</p>
</li>
<li>
<p>The <code>PagedResources</code> may get <code>prev</code> and <code>next</code> links attached, depending on the page&#8217;s state. The links point to the URI to which the method maps. The pagination parameters added to the method match the setup of the <code>PageableHandlerMethodArgumentResolver</code> to make sure the links can be resolved later.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Assume we have 30 <code>Person</code> instances in the database. You can now trigger a request (<code>GET <a href="http://localhost:8080/persons" class="bare">http://localhost:8080/persons</a></code>) and see output similar to the following:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="javascript" class="language-javascript hljs">{ "links" : [ { "rel" : "next",
                "href" : "http://localhost:8080/persons?page=1&amp;size=20" }
  ],
  "content" : [
     … // 20 Person instances rendered here
  ],
  "pageMetadata" : {
    "size" : 20,
    "totalElements" : 30,
    "totalPages" : 2,
    "number" : 0
  }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The assembler produced the correct URI and also picked up the default configuration to resolve the parameters into a <code>Pageable</code> for an upcoming request. This means that, if you change that configuration, the links automatically adhere to the change. By default, the assembler points to the controller method it was invoked in, but you can customize that by passing a custom <code>Link</code> to be used as base to build the pagination links, which overloads the <code>PagedResourcesAssembler.toResource(…)</code> method.</p>
</div>
</div>
<div class="sect4">
<h5 id="core.web.binding"><a class="anchor" href="index.html#core.web.binding"></a>Web Databinding Support</h5>
<div class="paragraph">
<p>You can use Spring Data projections (described in <a href="index.html#projections">[projections]</a>) to bind incoming request payloads by using either <a href="https://goessner.net/articles/JsonPath/">JSONPath</a> expressions (requires <a href="https://github.com/json-path/JsonPath">Jayway JsonPath</a> or <a href="https://www.w3.org/TR/xpath-31/">XPath</a> expressions (requires <a href="https://xmlbeam.org/">XmlBeam</a>), as the following example shows:</p>
</div>
<div class="exampleblock">
<div class="title">Example 50. HTTP payload binding using JSONPath or XPath expressions</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">@ProjectedPayload
public interface UserPayload {

  @XBRead("//firstname")
  @JsonPath("$..firstname")
  String getFirstname();

  @XBRead("/lastname")
  @JsonPath({ "$.lastname", "$.user.lastname" })
  String getLastname();
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>You can use the type shown in the preceding example as a Spring MVC handler method argument or by using <code>ParameterizedTypeReference</code> on one of methods of the <code>RestTemplate</code>.
The preceding method declarations would try to find <code>firstname</code> anywhere in the given document.
The <code>lastname</code> XML lookup is performed on the top-level of the incoming document.
The JSON variant of that tries a top-level <code>lastname</code> first but also tries <code>lastname</code> nested in a <code>user</code> sub-document if the former does not return a value.
That way, changes in the structure of the source document can be mitigated easily without having clients calling the exposed methods (usually a drawback of class-based payload binding).</p>
</div>
<div class="paragraph">
<p>Nested projections are supported as described in <a href="index.html#projections">[projections]</a>.
If the method returns a complex, non-interface type, a Jackson <code>ObjectMapper</code> is used to map the final value.</p>
</div>
<div class="paragraph">
<p>For Spring MVC, the necessary converters are registered automatically as soon as <code>@EnableSpringDataWebSupport</code> is active and the required dependencies are available on the classpath.
For usage with <code>RestTemplate</code>, register a <code>ProjectingJackson2HttpMessageConverter</code> (JSON) or <code>XmlBeamHttpMessageConverter</code> manually.</p>
</div>
<div class="paragraph">
<p>For more information, see the <a href="https://github.com/spring-projects/spring-data-examples/tree/master/web/projection">web projection example</a> in the canonical <a href="https://github.com/spring-projects/spring-data-examples">Spring Data Examples repository</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="core.web.type-safe"><a class="anchor" href="index.html#core.web.type-safe"></a>Querydsl Web Support</h5>
<div class="paragraph">
<p>For those stores that have <a href="http://www.querydsl.com/">QueryDSL</a> integration, you can derive queries from the attributes contained in a <code>Request</code> query string.</p>
</div>
<div class="paragraph">
<p>Consider the following query string:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="text" class="language-text hljs">?firstname=Dave&amp;lastname=Matthews</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Given the <code>User</code> object from the previous examples, you can resolve a query string to the following value by using the <code>QuerydslPredicateArgumentResolver</code>, as follows:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="text" class="language-text hljs">QUser.user.firstname.eq("Dave").and(QUser.user.lastname.eq("Matthews"))</code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The feature is automatically enabled, along with <code>@EnableSpringDataWebSupport</code>, when Querydsl is found on the classpath.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Adding a <code>@QuerydslPredicate</code> to the method signature provides a ready-to-use <code>Predicate</code>, which you can run by using the <code>QuerydslPredicateExecutor</code>.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Type information is typically resolved from the method&#8217;s return type. Since that information does not necessarily match the domain type, it might be a good idea to use the <code>root</code> attribute of <code>QuerydslPredicate</code>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The following example shows how to use <code>@QuerydslPredicate</code> in a method signature:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">@Controller
class UserController {

  @Autowired UserRepository repository;

  @RequestMapping(value = "/", method = RequestMethod.GET)
  String index(Model model, @QuerydslPredicate(root = User.class) Predicate predicate,    <i class="conum" data-value="1"></i><b>(1)</b>
          Pageable pageable, @RequestParam MultiValueMap&lt;String, String&gt; parameters) {

    model.addAttribute("users", repository.findAll(predicate, pageable));

    return "index";
  }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Resolve query string arguments to matching <code>Predicate</code> for <code>User</code>.</td>
</tr>
</table>
</div>
</div>
</div>
<div class="paragraph">
<p>The default binding is as follows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>Object</code> on simple properties as <code>eq</code>.</p>
</li>
<li>
<p><code>Object</code> on collection like properties as <code>contains</code>.</p>
</li>
<li>
<p><code>Collection</code> on simple properties as <code>in</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You can customize those bindings through the <code>bindings</code> attribute of <code>@QuerydslPredicate</code> or by making use of Java 8 <code>default methods</code> and adding the <code>QuerydslBinderCustomizer</code> method to the repository interface, as follows:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">interface UserRepository extends CrudRepository&lt;User, String&gt;,
                                 QuerydslPredicateExecutor&lt;User&gt;,                <i class="conum" data-value="1"></i><b>(1)</b>
                                 QuerydslBinderCustomizer&lt;QUser&gt; {               <i class="conum" data-value="2"></i><b>(2)</b>

  @Override
  default void customize(QuerydslBindings bindings, QUser user) {

    bindings.bind(user.username).first((path, value) -&gt; path.contains(value))    <i class="conum" data-value="3"></i><b>(3)</b>
    bindings.bind(String.class)
      .first((StringPath path, String value) -&gt; path.containsIgnoreCase(value)); <i class="conum" data-value="4"></i><b>(4)</b>
    bindings.excluding(user.password);                                           <i class="conum" data-value="5"></i><b>(5)</b>
  }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>QuerydslPredicateExecutor</code> provides access to specific finder methods for <code>Predicate</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td><code>QuerydslBinderCustomizer</code> defined on the repository interface is automatically picked up and shortcuts <code>@QuerydslPredicate(bindings=&#8230;&#8203;)</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Define the binding for the <code>username</code> property to be a simple <code>contains</code> binding.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Define the default binding for <code>String</code> properties to be a case-insensitive <code>contains</code> match.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Exclude the <code>password</code> property from <code>Predicate</code> resolution.</td>
</tr>
</table>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="core.repository-populators"><a class="anchor" href="index.html#core.repository-populators"></a>8.8.3. Repository Populators</h4>
<div class="paragraph">
<p>If you work with the Spring JDBC module, you are probably familiar with the support for populating a <code>DataSource</code> with SQL scripts. A similar abstraction is available on the repositories level, although it does not use SQL as the data definition language because it must be store-independent. Thus, the populators support XML (through Spring&#8217;s OXM abstraction) and JSON (through Jackson) to define data with which to populate the repositories.</p>
</div>
<div class="paragraph">
<p>Assume you have a file called <code>data.json</code> with the following content:</p>
</div>
<div class="exampleblock">
<div class="title">Example 51. Data defined in JSON</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="javascript" class="language-javascript hljs">[ { "_class" : "com.acme.Person",
 "firstname" : "Dave",
  "lastname" : "Matthews" },
  { "_class" : "com.acme.Person",
 "firstname" : "Carter",
  "lastname" : "Beauford" } ]</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>You can populate your repositories by using the populator elements of the repository namespace provided in Spring Data Commons. To populate the preceding data to your <code>PersonRepository</code>, declare a populator similar to the following:</p>
</div>
<div class="exampleblock">
<div class="title">Example 52. Declaring a Jackson repository populator</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="xml" class="language-xml hljs">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;beans xmlns="http://www.springframework.org/schema/beans"
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xmlns:repository="http://www.springframework.org/schema/data/repository"
  xsi:schemaLocation="http://www.springframework.org/schema/beans
    https://www.springframework.org/schema/beans/spring-beans.xsd
    http://www.springframework.org/schema/data/repository
    https://www.springframework.org/schema/data/repository/spring-repository.xsd"&gt;

  &lt;repository:jackson2-populator locations="classpath:data.json" /&gt;

&lt;/beans&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The preceding declaration causes the <code>data.json</code> file to
be read and deserialized by a Jackson <code>ObjectMapper</code>.</p>
</div>
<div class="paragraph">
<p>The type to which the JSON object is unmarshalled is determined by inspecting the <code>_class</code> attribute of the JSON document. The infrastructure eventually selects the appropriate repository to handle the object that was deserialized.</p>
</div>
<div class="paragraph">
<p>To instead use XML to define the data the repositories should be populated with, you can use the <code>unmarshaller-populator</code> element. You configure it to use one of the XML marshaller options available in Spring OXM. See the <a href="https://docs.spring.io/spring/docs/5.3.1/spring-framework-reference/data-access.html#oxm">Spring reference documentation</a> for details. The following example shows how to unmarshall a repository populator with JAXB:</p>
</div>
<div class="exampleblock">
<div class="title">Example 53. Declaring an unmarshalling repository populator (using JAXB)</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="xml" class="language-xml hljs">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;beans xmlns="http://www.springframework.org/schema/beans"
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xmlns:repository="http://www.springframework.org/schema/data/repository"
  xmlns:oxm="http://www.springframework.org/schema/oxm"
  xsi:schemaLocation="http://www.springframework.org/schema/beans
    https://www.springframework.org/schema/beans/spring-beans.xsd
    http://www.springframework.org/schema/data/repository
    https://www.springframework.org/schema/data/repository/spring-repository.xsd
    http://www.springframework.org/schema/oxm
    https://www.springframework.org/schema/oxm/spring-oxm.xsd"&gt;

  &lt;repository:unmarshaller-populator locations="classpath:data.json"
    unmarshaller-ref="unmarshaller" /&gt;

  &lt;oxm:jaxb2-marshaller contextPath="com.acme" /&gt;

&lt;/beans&gt;</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<h1 id="reference" class="sect0"><a class="anchor" href="index.html#reference"></a>Reference Documentation</h1>
<div class="sect1">
<h2 id="jdbc.repositories"><a class="anchor" href="index.html#jdbc.repositories"></a>9. JDBC Repositories</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This chapter points out the specialties for repository support for JDBC. This builds on the core repository support explained in <a href="index.html#repositories">Working with Spring Data Repositories</a>.
You should have a sound understanding of the basic concepts explained there.</p>
</div>
<div class="sect2">
<h3 id="jdbc.why"><a class="anchor" href="index.html#jdbc.why"></a>9.1. Why Spring Data JDBC?</h3>
<div class="paragraph">
<p>The main persistence API for relational databases in the Java world is certainly JPA, which has its own Spring Data module.
Why is there another one?</p>
</div>
<div class="paragraph">
<p>JPA does a lot of things in order to help the developer.
Among other things, it tracks changes to entities.
It does lazy loading for you.
It lets you map a wide array of object constructs to an equally wide array of database designs.</p>
</div>
<div class="paragraph">
<p>This is great and makes a lot of things really easy.
Just take a look at a basic JPA tutorial.
But it often gets really confusing as to why JPA does a certain thing.
Also, things that are really simple conceptually get rather difficult with JPA.</p>
</div>
<div class="paragraph">
<p>Spring Data JDBC aims to be much simpler conceptually, by embracing the following design decisions:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If you load an entity, SQL statements get run.
Once this is done, you have a completely loaded entity.
No lazy loading or caching is done.</p>
</li>
<li>
<p>If you save an entity, it gets saved.
If you do not, it does not.
There is no dirty tracking and no session.</p>
</li>
<li>
<p>There is a simple model of how to map entities to tables.
It probably only works for rather simple cases.
If you do not like that, you should code your own strategy.
Spring Data JDBC offers only very limited support for customizing the strategy with annotations.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="jdbc.domain-driven-design"><a class="anchor" href="index.html#jdbc.domain-driven-design"></a>9.2. Domain Driven Design and Relational Databases.</h3>
<div class="paragraph">
<p>All Spring Data modules are inspired by the concepts of &#8220;repository&#8221;, &#8220;aggregate&#8221;, and &#8220;aggregate root&#8221; from Domain Driven Design.
These are possibly even more important for Spring Data JDBC, because they are, to some extent, contrary to normal practice when working with relational databases.</p>
</div>
<div class="paragraph">
<p>An aggregate is a group of entities that is guaranteed to be consistent between atomic changes to it.
A classic example is an <code>Order</code> with <code>OrderItems</code>.
A property on <code>Order</code> (for example, <code>numberOfItems</code> is consistent with the actual number of <code>OrderItems</code>) remains consistent as changes are made.</p>
</div>
<div class="paragraph">
<p>References across aggregates are not guaranteed to be consistent at all times.
They are guaranteed to become consistent eventually.</p>
</div>
<div class="paragraph">
<p>Each aggregate has exactly one aggregate root, which is one of the entities of the aggregate.
The aggregate gets manipulated only through methods on that aggregate root.
These are the atomic changes mentioned earlier.</p>
</div>
<div class="paragraph">
<p>A repository is an abstraction over a persistent store that looks like a collection of all the aggregates of a certain type.
For Spring Data in general, this means you want to have one <code>Repository</code> per aggregate root.
In addition, for Spring Data JDBC this means that all entities reachable from an aggregate root are considered to be part of that aggregate root.
Spring Data JDBC assumes that only the aggregate has a foreign key to a table storing non-root entities of the aggregate and no other entity points toward non-root entities.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
In the current implementation, entities referenced from an aggregate root are deleted and recreated by Spring Data JDBC.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You can overwrite the repository methods with implementations that match your style of working and designing your database.</p>
</div>
</div>
<div class="sect2">
<h3 id="jdbc.getting-started"><a class="anchor" href="index.html#jdbc.getting-started"></a>9.3. Getting Started</h3>
<div class="paragraph">
<p>An easy way to bootstrap setting up a working environment is to create a Spring-based project in <a href="https://spring.io/tools/sts">STS</a> or from <a href="https://start.spring.io">Spring Initializr</a>.</p>
</div>
<div class="paragraph">
<p>First, you need to set up a running database server. Refer to your vendor documentation on how to configure your database for JDBC access.</p>
</div>
<div class="paragraph">
<p>To create a Spring project in STS:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Go to File &#8594; New &#8594; Spring Template Project &#8594; Simple Spring Utility Project, and press Yes when prompted. Then enter a project and a package name, such as <code>org.spring.jdbc.example</code>.</p>
</li>
<li>
<p>Add the following to the <code>pom.xml</code> files <code>dependencies</code> element:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="xml" class="language-xml hljs">&lt;dependencies&gt;

  &lt;!-- other dependency elements omitted --&gt;

  &lt;dependency&gt;
    &lt;groupId&gt;org.springframework.data&lt;/groupId&gt;
    &lt;artifactId&gt;spring-data-jdbc&lt;/artifactId&gt;
    &lt;version&gt;2.1.1&lt;/version&gt;
  &lt;/dependency&gt;

&lt;/dependencies&gt;</code></pre>
</div>
</div>
</li>
<li>
<p>Change the version of Spring in the pom.xml to be</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="xml" class="language-xml hljs">&lt;spring.framework.version&gt;5.3.1&lt;/spring.framework.version&gt;</code></pre>
</div>
</div>
</li>
<li>
<p>Add the following location of the Spring Milestone repository for Maven to your <code>pom.xml</code> such that it is at the same level of your <code>&lt;dependencies/&gt;</code> element:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="xml" class="language-xml hljs">&lt;repositories&gt;
  &lt;repository&gt;
    &lt;id&gt;spring-milestone&lt;/id&gt;
    &lt;name&gt;Spring Maven MILESTONE Repository&lt;/name&gt;
    &lt;url&gt;https://repo.spring.io/libs-milestone&lt;/url&gt;
  &lt;/repository&gt;
&lt;/repositories&gt;</code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>The repository is also <a href="https://repo.spring.io/milestone/org/springframework/data/">browseable here</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="jdbc.examples-repo"><a class="anchor" href="index.html#jdbc.examples-repo"></a>9.4. Examples Repository</h3>
<div class="paragraph">
<p>There is a <a href="https://github.com/spring-projects/spring-data-examples">GitHub repository with several examples</a> that you can download and play around with to get a feel for how the library works.</p>
</div>
</div>
<div class="sect2">
<h3 id="jdbc.java-config"><a class="anchor" href="index.html#jdbc.java-config"></a>9.5. Annotation-based Configuration</h3>
<div class="paragraph">
<p>The Spring Data JDBC repositories support can be activated by an annotation through Java configuration, as the following example shows:</p>
</div>
<div class="exampleblock">
<div class="title">Example 54. Spring Data JDBC repositories using Java configuration</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">@Configuration
@EnableJdbcRepositories                                                                <i class="conum" data-value="1"></i><b>(1)</b>
class ApplicationConfig extends AbstractJdbcConfiguration {                            <i class="conum" data-value="2"></i><b>(2)</b>

    @Bean
    public DataSource dataSource() {                                                   <i class="conum" data-value="3"></i><b>(3)</b>

        EmbeddedDatabaseBuilder builder = new EmbeddedDatabaseBuilder();
        return builder.setType(EmbeddedDatabaseType.HSQL).build();
    }

    @Bean
    NamedParameterJdbcOperations namedParameterJdbcOperations(DataSource dataSource) { <i class="conum" data-value="4"></i><b>(4)</b>
        return new NamedParameterJdbcTemplate(dataSource);
    }

    @Bean
    TransactionManager transactionManager(DataSource dataSource) {                     <i class="conum" data-value="5"></i><b>(5)</b>
        return new DataSourceTransactionManager(dataSource);
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>@EnableJdbcRepositories</code> creates implementations for interfaces derived from <code>Repository</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td><code>AbstractJdbcConfiguration</code> provides various default beans required by Spring Data JDBC</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Creates a <code>DataSource</code> connecting to a database.
This is required by the following two bean methods.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Creates the <code>NamedParameterJdbcOperations</code> used by Spring Data JDBC to access the database.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Spring Data JDBC utilizes the transaction management provided by Spring JDBC.</td>
</tr>
</table>
</div>
</div>
</div>
<div class="paragraph">
<p>The configuration class in the preceding example sets up an embedded HSQL database by using the <code>EmbeddedDatabaseBuilder</code> API of <code>spring-jdbc</code>.
The <code>DataSource</code> is then used to set up <code>NamedParameterJdbcOperations</code> and a <code>TransactionManager</code>.
We finally activate Spring Data JDBC repositories by using the <code>@EnableJdbcRepositories</code>.
If no base package is configured, it uses the package in which the configuration class resides.
Extending <code>AbstractJdbcConfiguration</code> ensures various beans get registered.
Overwriting its methods can be used to customize the setup (see below).</p>
</div>
<div class="paragraph">
<p>This configuration can be further simplified by using Spring Boot.
With Spring Boot a <code>DataSource</code> is sufficient once the starter <code>spring-boot-starter-data-jdbc</code> is included in the dependencies.
Everything else is done by Spring Boot.</p>
</div>
<div class="paragraph">
<p>There are a couple of things one might want to customize in this setup.</p>
</div>
<div class="sect3">
<h4 id="jdbc.dialects"><a class="anchor" href="index.html#jdbc.dialects"></a>9.5.1. Dialects</h4>
<div class="paragraph">
<p>Spring Data JDBC uses implementations of the interface <code>Dialect</code> to encapsulate behavior that is specific to a database or its JDBC driver.
By default, the <code>AbstractJdbcConfiguration</code> tries to determine the database in use an register the correct <code>Dialect</code>.
This behavior can be changed by overwriting <code>jdbcDialect(NamedParameterJdbcOperations)</code>.</p>
</div>
<div class="paragraph">
<p>If you use a database for which no dialect is available, then your application won’t startup. In that case, you’ll have to ask your vendor to provide a <code>Dialect</code> implementation. Alternatively, you can:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Implement your own <code>Dialect</code>.</p>
</li>
<li>
<p>Implement a <code>JdbcDialectProvider</code> returning the <code>Dialect</code>.</p>
</li>
<li>
<p>Register the provider by creating a <code>spring.factories</code> resource under <code>META-INF</code> and perform the registration by adding a line<br>
<code>org.springframework.data.jdbc.repository.config.DialectResolver$JdbcDialectProvider=&lt;fully qualified name of your JdbcDialectProvider&gt;</code></p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="jdbc.entity-persistence"><a class="anchor" href="index.html#jdbc.entity-persistence"></a>9.6. Persisting Entities</h3>
<div class="paragraph">
<p>Saving an aggregate can be performed with the <code>CrudRepository.save(…)</code> method.
If the aggregate is new, this results in an insert for the aggregate root, followed by insert statements for all directly or indirectly referenced entities.</p>
</div>
<div class="paragraph">
<p>If the aggregate root is not new, all referenced entities get deleted, the aggregate root gets updated, and all referenced entities get inserted again.
Note that whether an instance is new is part of the instance&#8217;s state.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
This approach has some obvious downsides.
If only few of the referenced entities have been actually changed, the deletion and insertion is wasteful.
While this process could and probably will be improved, there are certain limitations to what Spring Data JDBC can offer.
It does not know the previous state of an aggregate.
So any update process always has to take whatever it finds in the database and make sure it converts it to whatever is the state of the entity passed to the save method.
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="mapping.fundamentals"><a class="anchor" href="index.html#mapping.fundamentals"></a>9.6.1. Object Mapping Fundamentals</h4>
<div class="paragraph">
<p>This section covers the fundamentals of Spring Data object mapping, object creation, field and property access, mutability and immutability.
Note, that this section only applies to Spring Data modules that do not use the object mapping of the underlying data store (like JPA).
Also be sure to consult the store-specific sections for store-specific object mapping, like indexes, customizing column or field names or the like.</p>
</div>
<div class="paragraph">
<p>Core responsibility of the Spring Data object mapping is to create instances of domain objects and map the store-native data structures onto those.
This means we need two fundamental steps:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Instance creation by using one of the constructors exposed.</p>
</li>
<li>
<p>Instance population to materialize all exposed properties.</p>
</li>
</ol>
</div>
<div class="sect4">
<h5 id="mapping.object-creation"><a class="anchor" href="index.html#mapping.object-creation"></a>Object creation</h5>
<div class="paragraph">
<p>Spring Data automatically tries to detect a persistent entity&#8217;s constructor to be used to materialize objects of that type.
The resolution algorithm works as follows:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>If there&#8217;s a no-argument constructor, it will be used.
Other constructors will be ignored.</p>
</li>
<li>
<p>If there&#8217;s a single constructor taking arguments, it will be used.</p>
</li>
<li>
<p>If there are multiple constructors taking arguments, the one to be used by Spring Data will have to be annotated with <code>@PersistenceConstructor</code>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The value resolution assumes constructor argument names to match the property names of the entity, i.e. the resolution will be performed as if the property was to be populated, including all customizations in mapping (different datastore column or field name etc.).
This also requires either parameter names information available in the class file or an <code>@ConstructorProperties</code> annotation being present on the constructor.</p>
</div>
<div class="paragraph">
<p>The value resolution can be customized by using Spring Framework&#8217;s <code>@Value</code> value annotation using a store-specific SpEL expression.
Please consult the section on store specific mappings for further details.</p>
</div>
<div id="mapping.object-creation.details" class="sidebarblock">
<div class="content">
<div class="title">Object creation internals</div>
<div class="paragraph">
<p>To avoid the overhead of reflection, Spring Data object creation uses a factory class generated at runtime by default, which will call the domain classes constructor directly.
I.e. for this example type:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">class Person {
  Person(String firstname, String lastname) { … }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>we will create a factory class semantically equivalent to this one at runtime:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">class PersonObjectInstantiator implements ObjectInstantiator {

  Object newInstance(Object... args) {
    return new Person((String) args[0], (String) args[1]);
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This gives us a roundabout 10% performance boost over reflection.
For the domain class to be eligible for such optimization, it needs to adhere to a set of constraints:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>it must not be a private class</p>
</li>
<li>
<p>it must not be a non-static inner class</p>
</li>
<li>
<p>it must not be a CGLib proxy class</p>
</li>
<li>
<p>the constructor to be used by Spring Data must not be private</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If any of these criteria match, Spring Data will fall back to entity instantiation via reflection.</p>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="mapping.property-population"><a class="anchor" href="index.html#mapping.property-population"></a>Property population</h5>
<div class="paragraph">
<p>Once an instance of the entity has been created, Spring Data populates all remaining persistent properties of that class.
Unless already populated by the entity&#8217;s constructor (i.e. consumed through its constructor argument list), the identifier property will be populated first to allow the resolution of cyclic object references.
After that, all non-transient properties that have not already been populated by the constructor are set on the entity instance.
For that we use the following algorithm:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>If the property is immutable but exposes a <code>with…</code> method (see below), we use the <code>with…</code> method to create a new entity instance with the new property value.</p>
</li>
<li>
<p>If property access (i.e. access through getters and setters) is defined, we&#8217;re invoking the setter method.</p>
</li>
<li>
<p>If the property is mutable we set the field directly.</p>
</li>
<li>
<p>If the property is immutable we&#8217;re using the constructor to be used by persistence operations (see <a href="index.html#mapping.object-creation">Object creation</a>) to create a copy of the instance.</p>
</li>
<li>
<p>By default, we set the field value directly.</p>
</li>
</ol>
</div>
<div id="mapping.property-population.details" class="sidebarblock">
<div class="content">
<div class="title">Property population internals</div>
<div class="paragraph">
<p>Similarly to our <a href="index.html#mapping.object-creation.details">optimizations in object construction</a> we also use Spring Data runtime generated accessor classes to interact with the entity instance.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">class Person {

  private final Long id;
  private String firstname;
  private @AccessType(Type.PROPERTY) String lastname;

  Person() {
    this.id = null;
  }

  Person(Long id, String firstname, String lastname) {
    // Field assignments
  }

  Person withId(Long id) {
    return new Person(id, this.firstname, this.lastame);
  }

  void setLastname(String lastname) {
    this.lastname = lastname;
  }
}</code></pre>
</div>
</div>
<div class="exampleblock">
<div class="title">Example 55. A generated Property Accessor</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">class PersonPropertyAccessor implements PersistentPropertyAccessor {

  private static final MethodHandle firstname;              <i class="conum" data-value="2"></i><b>(2)</b>

  private Person person;                                    <i class="conum" data-value="1"></i><b>(1)</b>

  public void setProperty(PersistentProperty property, Object value) {

    String name = property.getName();

    if ("firstname".equals(name)) {
      firstname.invoke(person, (String) value);             <i class="conum" data-value="2"></i><b>(2)</b>
    } else if ("id".equals(name)) {
      this.person = person.withId((Long) value);            <i class="conum" data-value="3"></i><b>(3)</b>
    } else if ("lastname".equals(name)) {
      this.person.setLastname((String) value);              <i class="conum" data-value="4"></i><b>(4)</b>
    }
  }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>PropertyAccessor&#8217;s hold a mutable instance of the underlying object. This is, to enable mutations of otherwise immutable properties.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>By default, Spring Data uses field-access to read and write property values. As per visibility rules of <code>private</code> fields, <code>MethodHandles</code> are used to interact with fields.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The class exposes a <code>withId(…)</code> method that&#8217;s used to set the identifier, e.g. when an instance is inserted into the datastore and an identifier has been generated. Calling <code>withId(…)</code> creates a new <code>Person</code> object. All subsequent mutations will take place in the new instance leaving the previous untouched.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Using property-access allows direct method invocations without using <code>MethodHandles</code>.</td>
</tr>
</table>
</div>
</div>
</div>
<div class="paragraph">
<p>This gives us a roundabout 25% performance boost over reflection.
For the domain class to be eligible for such optimization, it needs to adhere to a set of constraints:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Types must not reside in the default or under the <code>java</code> package.</p>
</li>
<li>
<p>Types and their constructors must be <code>public</code></p>
</li>
<li>
<p>Types that are inner classes must be <code>static</code>.</p>
</li>
<li>
<p>The used Java Runtime must allow for declaring classes in the originating <code>ClassLoader</code>. Java 9 and newer impose certain limitations.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>By default, Spring Data attempts to use generated property accessors and falls back to reflection-based ones if a limitation is detected.</p>
</div>
</div>
</div>
<div class="paragraph">
<p>Let&#8217;s have a look at the following entity:</p>
</div>
<div class="exampleblock">
<div class="title">Example 56. A sample entity</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">class Person {

  private final @Id Long id;                                                <i class="conum" data-value="1"></i><b>(1)</b>
  private final String firstname, lastname;                                 <i class="conum" data-value="2"></i><b>(2)</b>
  private final LocalDate birthday;
  private final int age;                                                    <i class="conum" data-value="3"></i><b>(3)</b>

  private String comment;                                                   <i class="conum" data-value="4"></i><b>(4)</b>
  private @AccessType(Type.PROPERTY) String remarks;                        <i class="conum" data-value="5"></i><b>(5)</b>

  static Person of(String firstname, String lastname, LocalDate birthday) { <i class="conum" data-value="6"></i><b>(6)</b>

    return new Person(null, firstname, lastname, birthday,
      Period.between(birthday, LocalDate.now()).getYears());
  }

  Person(Long id, String firstname, String lastname, LocalDate birthday, int age) { <i class="conum" data-value="6"></i><b>(6)</b>

    this.id = id;
    this.firstname = firstname;
    this.lastname = lastname;
    this.birthday = birthday;
    this.age = age;
  }

  Person withId(Long id) {                                                  <i class="conum" data-value="1"></i><b>(1)</b>
    return new Person(id, this.firstname, this.lastname, this.birthday, this.age);
  }

  void setRemarks(String remarks) {                                         <i class="conum" data-value="5"></i><b>(5)</b>
    this.remarks = remarks;
  }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The identifier property is final but set to <code>null</code> in the constructor.
The class exposes a <code>withId(…)</code> method that&#8217;s used to set the identifier, e.g. when an instance is inserted into the datastore and an identifier has been generated.
The original <code>Person</code> instance stays unchanged as a new one is created.
The same pattern is usually applied for other properties that are store managed but might have to be changed for persistence operations.
The wither method is optional as the persistence constructor (see 6) is effectively a copy constructor and setting the property will be translated into creating a fresh instance with the new identifier value applied.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The <code>firstname</code> and <code>lastname</code> properties are ordinary immutable properties potentially exposed through getters.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The <code>age</code> property is an immutable but derived one from the <code>birthday</code> property.
With the design shown, the database value will trump the defaulting as Spring Data uses the only declared constructor.
Even if the intent is that the calculation should be preferred, it&#8217;s important that this constructor also takes <code>age</code> as parameter (to potentially ignore it) as otherwise the property population step will attempt to set the age field and fail due to it being immutable and no <code>with…</code> method being present.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>The <code>comment</code> property is mutable is populated by setting its field directly.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>The <code>remarks</code> properties are mutable and populated by setting the <code>comment</code> field directly or by invoking the setter method for</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>The class exposes a factory method and a constructor for object creation.
The core idea here is to use factory methods instead of additional constructors to avoid the need for constructor disambiguation through <code>@PersistenceConstructor</code>.
Instead, defaulting of properties is handled within the factory method.</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="mapping.general-recommendations"><a class="anchor" href="index.html#mapping.general-recommendations"></a>General recommendations</h5>
<div class="ulist">
<ul>
<li>
<p><em>Try to stick to immutable objects</em>&#8201;&#8212;&#8201;Immutable objects are straightforward to create as materializing an object is then a matter of calling its constructor only.
Also, this avoids your domain objects to be littered with setter methods that allow client code to manipulate the objects state.
If you need those, prefer to make them package protected so that they can only be invoked by a limited amount of co-located types.
Constructor-only materialization is up to 30% faster than properties population.</p>
</li>
<li>
<p><em>Provide an all-args constructor</em>&#8201;&#8212;&#8201;Even if you cannot or don&#8217;t want to model your entities as immutable values, there&#8217;s still value in providing a constructor that takes all properties of the entity as arguments, including the mutable ones, as this allows the object mapping to skip the property population for optimal performance.</p>
</li>
<li>
<p><em>Use factory methods instead of overloaded constructors to avoid <code>@PersistenceConstructor</code></em>&#8201;&#8212;&#8201;With an all-argument constructor needed for optimal performance, we usually want to expose more application use case specific constructors that omit things like auto-generated identifiers etc.
It&#8217;s an established pattern to rather use static factory methods to expose these variants of the all-args constructor.</p>
</li>
<li>
<p><em>Make sure you adhere to the constraints that allow the generated instantiator and property accessor classes to be used</em>&#8201;&#8212;&#8201;</p>
</li>
<li>
<p><em>For identifiers to be generated, still use a final field in combination with an all-arguments persistence constructor (preferred) or a <code>with…</code> method</em>&#8201;&#8212;&#8201;</p>
</li>
<li>
<p><em>Use Lombok to avoid boilerplate code</em>&#8201;&#8212;&#8201;As persistence operations usually require a constructor taking all arguments, their declaration becomes a tedious repetition of boilerplate parameter to field assignments that can best be avoided by using Lombok&#8217;s <code>@AllArgsConstructor</code>.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="mapping.kotlin"><a class="anchor" href="index.html#mapping.kotlin"></a>Kotlin support</h5>
<div class="paragraph">
<p>Spring Data adapts specifics of Kotlin to allow object creation and mutation.</p>
</div>
<div class="sect5">
<h6>Kotlin object creation</h6>
<div class="paragraph">
<p>Kotlin classes are supported to be instantiated , all classes are immutable by default and require explicit property declarations to define mutable properties.
Consider the following <code>data</code> class <code>Person</code>:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="kotlin" class="language-kotlin hljs">data class Person(val id: String, val name: String)</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The class above compiles to a typical class with an explicit constructor.We can customize this class by adding another constructor and annotate it with <code>@PersistenceConstructor</code> to indicate a constructor preference:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="kotlin" class="language-kotlin hljs">data class Person(var id: String, val name: String) {

    @PersistenceConstructor
    constructor(id: String) : this(id, "unknown")
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Kotlin supports parameter optionality by allowing default values to be used if a parameter is not provided.
When Spring Data detects a constructor with parameter defaulting, then it leaves these parameters absent if the data store does not provide a value (or simply returns <code>null</code>) so Kotlin can apply parameter defaulting.Consider the following class that applies parameter defaulting for <code>name</code></p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="kotlin" class="language-kotlin hljs">data class Person(var id: String, val name: String = "unknown")</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Every time the <code>name</code> parameter is either not part of the result or its value is <code>null</code>, then the <code>name</code> defaults to <code>unknown</code>.</p>
</div>
</div>
<div class="sect5">
<h6>Property population of Kotlin data classes</h6>
<div class="paragraph">
<p>In Kotlin, all classes are immutable by default and require explicit property declarations to define mutable properties.
Consider the following <code>data</code> class <code>Person</code>:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="kotlin" class="language-kotlin hljs">data class Person(val id: String, val name: String)</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>This class is effectively immutable.
It allows creating new instances as Kotlin generates a <code>copy(…)</code> method that creates new object instances copying all property values from the existing object and applying property values provided as arguments to the method.</p>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="jdbc.entity-persistence.types"><a class="anchor" href="index.html#jdbc.entity-persistence.types"></a>9.6.2. Supported Types in Your Entity</h4>
<div class="paragraph">
<p>The properties of the following types are currently supported:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>All primitive types and their boxed types (<code>int</code>, <code>float</code>, <code>Integer</code>, <code>Float</code>, and so on)</p>
</li>
<li>
<p>Enums get mapped to their name.</p>
</li>
<li>
<p><code>String</code></p>
</li>
<li>
<p><code>java.util.Date</code>, <code>java.time.LocalDate</code>, <code>java.time.LocalDateTime</code>, and <code>java.time.LocalTime</code></p>
</li>
<li>
<p>Arrays and Collections of the types mentioned above can be mapped to columns of array type if your database supports that.</p>
</li>
<li>
<p>Anything your database driver accepts.</p>
</li>
<li>
<p>References to other entities.
They are considered a one-to-one relationship, or an embedded type.
It is optional for one-to-one relationship entities to have an <code>id</code> attribute.
The table of the referenced entity is expected to have an additional column named the same as the table of the referencing entity.
You can change this name by implementing <code>NamingStrategy.getReverseColumnName(PersistentPropertyPathExtension path)</code>.
Embedded entities do not need an <code>id</code>.
If one is present it gets ignored.</p>
</li>
<li>
<p><code>Set&lt;some entity&gt;</code> is considered a one-to-many relationship.
The table of the referenced entity is expected to have an additional column named the same as the table of the referencing entity.
You can change this name by implementing <code>NamingStrategy.getReverseColumnName(PersistentPropertyPathExtension path)</code>.</p>
</li>
<li>
<p><code>Map&lt;simple type, some entity&gt;</code> is considered a qualified one-to-many relationship.
The table of the referenced entity is expected to have two additional columns: One named the same as the table of the referencing entity for the foreign key and one with the same name and an additional <code>_key</code> suffix for the map key.
You can change this behavior by implementing <code>NamingStrategy.getReverseColumnName(PersistentPropertyPathExtension path)</code> and <code>NamingStrategy.getKeyColumn(RelationalPersistentProperty property)</code>, respectively.
Alternatively you may annotate the attribute with <code>@MappedCollection(idColumn="your_column_name", keyColumn="your_key_column_name")</code></p>
</li>
<li>
<p><code>List&lt;some entity&gt;</code> is mapped as a <code>Map&lt;Integer, some entity&gt;</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The handling of referenced entities is limited.
This is based on the idea of aggregate roots as described above.
If you reference another entity, that entity is, by definition, part of your aggregate.
So, if you remove the reference, the previously referenced entity gets deleted.
This also means references are 1-1 or 1-n, but not n-1 or n-m.</p>
</div>
<div class="paragraph">
<p>If you have n-1 or n-m references, you are, by definition, dealing with two separate aggregates.
References between those should be encoded as simple <code>id</code> values, which should map properly with Spring Data JDBC.</p>
</div>
</div>
<div class="sect3">
<h4 id="jdbc.entity-persistence.custom-converters"><a class="anchor" href="index.html#jdbc.entity-persistence.custom-converters"></a>9.6.3. Custom converters</h4>
<div class="paragraph">
<p>Custom converters can be registered, for types that are not supported by default, by inheriting your configuration from <code>AbstractJdbcConfiguration</code> and overwriting the method <code>jdbcCustomConversions()</code>.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">@Configuration
public class DataJdbcConfiguration extends AbstractJdbcConfiguration {

    @Override
    public JdbcCustomConversions jdbcCustomConversions() {

      return new JdbcCustomConversions(Collections.singletonList(TimestampTzToDateConverter.INSTANCE));

    }

    @ReadingConverter
    enum TimestampTzToDateConverter implements Converter&lt;TIMESTAMPTZ, Date&gt; {

        INSTANCE;

        @Override
        public Date convert(TIMESTAMPTZ source) {
            //...
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The constructor of <code>JdbcCustomConversions</code> accepts a list of <code>org.springframework.core.convert.converter.Converter</code>.</p>
</div>
<div class="paragraph">
<p>Converters should be annotated with <code>@ReadingConverter</code> or <code>@WritingConverter</code> in order to control their applicability to only reading from or to writing to the database.</p>
</div>
<div class="paragraph">
<p><code>TIMESTAMPTZ</code> in the example is a database specific data type that needs conversion into something more suitable for a domain model.</p>
</div>
<div class="sect4">
<h5 id="jdbc.entity-persistence.custom-converters.jdbc-value"><a class="anchor" href="index.html#jdbc.entity-persistence.custom-converters.jdbc-value"></a>JdbcValue</h5>
<div class="paragraph">
<p>Value conversion uses <code>JdbcValue</code> to enrich values propagated to JDBC operations with a <code>java.sql.Types</code> type.
Register a custom write converter if you need to specify a JDBC-specific type instead of using type derivation.
This converter should convert the value to <code>JdbcValue</code> which has a field for the value and for the actual <code>JDBCType</code>.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="jdbc.entity-persistence.naming-strategy"><a class="anchor" href="index.html#jdbc.entity-persistence.naming-strategy"></a>9.6.4. <code>NamingStrategy</code></h4>
<div class="paragraph">
<p>When you use the standard implementations of <code>CrudRepository</code> that Spring Data JDBC provides, they expect a certain table structure.
You can tweak that by providing a <a href="../../../2.1.1/api/org/springframework/data/relational/core/mapping/NamingStrategy.html"><code>NamingStrategy</code></a> in your application context.</p>
</div>
</div>
<div class="sect3">
<h4 id="jdbc.entity-persistence.custom-table-name"><a class="anchor" href="index.html#jdbc.entity-persistence.custom-table-name"></a>9.6.5. <code>Custom table names</code></h4>
<div class="paragraph">
<p>When the NamingStrategy does not matching on your database table names, you can customize the names with the <a href="../../../2.1.1/api/org/springframework/data/relational/core/mapping/Table.html"><code>@Table</code></a> annotation.
The element <code>value</code> of this annotation provides the custom table name.
The following example maps the <code>MyEntity</code> class to the <code>CUSTOM_TABLE_NAME</code> table in the database:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">@Table("CUSTOM_TABLE_NAME")
public class MyEntity {
    @Id
    Integer id;

    String name;
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="jdbc.entity-persistence.custom-column-name"><a class="anchor" href="index.html#jdbc.entity-persistence.custom-column-name"></a>9.6.6. <code>Custom column names</code></h4>
<div class="paragraph">
<p>When the NamingStrategy does not matching on your database column names, you can customize the names with the <a href="../../../2.1.1/api/org/springframework/data/relational/core/mapping/Column.html"><code>@Column</code></a> annotation.
The element <code>value</code> of this annotation provides the custom column name.
The following example maps the <code>name</code> property of the <code>MyEntity</code> class to the <code>CUSTOM_COLUMN_NAME</code> column in the database:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">public class MyEntity {
    @Id
    Integer id;

    @Column("CUSTOM_COLUMN_NAME")
    String name;
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The <a href="../../../2.1.1/api/org/springframework/data/relational/core/mapping/MappedCollection.html"><code>@MappedCollection</code></a>
annotation can be used on a reference type (one-to-one relationship) or on Sets, Lists, and Maps (one-to-many relationship).
<code>idColumn</code> element of the annotation provides a custom name for the foreign key column referencing the id column in the other table.
In the following example the corresponding table for the <code>MySubEntity</code> class has a <code>NAME</code> column, and the <code>CUSTOM_MY_ENTITY_ID_COLUMN_NAME</code> column of the <code>MyEntity</code> id for relationship reasons:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">public class MyEntity {
    @Id
    Integer id;

    @MappedCollection(idColumn = "CUSTOM_MY_ENTITY_ID_COLUMN_NAME")
    Set&lt;MySubEntity&gt; subEntities;
}

public class MySubEntity {
    String name;
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>When using <code>List</code> and <code>Map</code> you must have an additional column for the position of a dataset in the <code>List</code> or the key value of the entity in the <code>Map</code>.
This additional column name may be customized with the <code>keyColumn</code> Element of the <a href="../../../2.1.1/api/org/springframework/data/relational/core/mapping/MappedCollection.html"><code>@MappedCollection</code></a> annotation:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">public class MyEntity {
    @Id
    Integer id;

    @MappedCollection(idColumn = "CUSTOM_COLUMN_NAME", keyColumn = "CUSTOM_KEY_COLUMN_NAME")
    List&lt;MySubEntity&gt; name;
}

public class MySubEntity {
    String name;
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="jdbc.entity-persistence.embedded-entities"><a class="anchor" href="index.html#jdbc.entity-persistence.embedded-entities"></a>9.6.7. Embedded entities</h4>
<div class="paragraph">
<p>Embedded entities are used to have value objects in your java data model, even if there is only one table in your database.
In the following example you see, that <code>MyEntity</code> is mapped with the <code>@Embedded</code> annotation.
The consequence of this is, that in the database a table <code>my_entity</code> with the two columns <code>id</code> and <code>name</code> (from the <code>EmbeddedEntity</code> class) is expected.</p>
</div>
<div class="paragraph">
<p>However, if the <code>name</code> column is actually <code>null</code> within the result set, the entire property <code>embeddedEntity</code> will be set to null according to the <code>onEmpty</code> of <code>@Embedded</code>, which <code>null</code>s objects when all nested properties are <code>null</code>.<br>
Opposite to this behavior <code>USE_EMPTY</code> tries to create a new instance using either a default constructor or one that accepts nullable parameter values from the result set.</p>
</div>
<div class="exampleblock">
<div class="title">Example 57. Sample Code of embedding objects</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">public class MyEntity {

    @Id
    Integer id;

    @Embedded(onEmpty = USE_NULL) <i class="conum" data-value="1"></i><b>(1)</b>
    EmbeddedEntity embeddedEntity;
}

public class EmbeddedEntity {
    String name;
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>Null</code>s <code>embeddedEntity</code> if <code>name</code> in <code>null</code>.
Use <code>USE_EMPTY</code> to instantiate <code>embeddedEntity</code> with a potential <code>null</code> value for the <code>name</code> property.</td>
</tr>
</table>
</div>
</div>
</div>
<div class="paragraph">
<p>If you need a value object multiple times in an entity, this can be achieved with the optional <code>prefix</code> element of the <code>@Embedded</code> annotation.
This element represents a prefix and is prepend for each column name in the embedded object.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Make use of the shortcuts <code>@Embedded.Nullable</code> &amp; <code>@Embedded.Empty</code> for <code>@Embedded(onEmpty = USE_NULL)</code> and <code>@Embedded(onEmpty = USE_EMPTY)</code> to reduce verbosity and simultaneously set JSR-305 <code>@javax.annotation.Nonnull</code> accordingly.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">public class MyEntity {

    @Id
    Integer id;

    @Embedded.Nullable <i class="conum" data-value="1"></i><b>(1)</b>
    EmbeddedEntity embeddedEntity;
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Shortcut for <code>@Embedded(onEmpty = USE_NULL)</code>.</td>
</tr>
</table>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Embedded entities containing a <code>Collection</code> or a <code>Map</code> will always be considered non empty since they will at least contain the empty collection or map.
Such an entity will therefore never be <code>null</code> even when using @Embedded(onEmpty = USE_NULL).</p>
</div>
</div>
<div class="sect3">
<h4 id="jdbc.entity-persistence.state-detection-strategies"><a class="anchor" href="index.html#jdbc.entity-persistence.state-detection-strategies"></a>9.6.8. Entity State Detection Strategies</h4>
<div class="paragraph">
<p>The following table describes the strategies that Spring Data JDBC offers for detecting whether an entity is new:</p>
</div>
<table class="tableblock frame-all grid-all fit-content">
<caption class="title">Table 2. Options for detection whether an entity is new in Spring Data JDBC</caption>
<colgroup>
<col>
<col>
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Id-Property inspection (the default)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">By default, Spring Data JDBC inspects the identifier property of the given entity.
If the identifier property is <code>null</code>, then the entity is assumed to be new. Otherwise, it is assumed to not be new.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Implementing <code>Persistable</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If an entity implements <code>Persistable</code>, Spring Data JDBC delegates the new detection to the <code>isNew(…)</code> method of the entity.
See the <a href="../../../../../data-commons/docs/current/api/index.html?org%252Fspringframework%252Fdata%252Fdomain%252FPersistable.html">Javadoc</a> for details.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Implementing <code>EntityInformation</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">You can customize the <code>EntityInformation</code> abstraction used in the <code>SimpleJdbcRepository</code> implementation by creating a subclass of <code>JdbcRepositoryFactory</code> and overriding the <code>getEntityInformation(…)</code> method.
You then have to register the custom implementation of <code>JdbcRepositoryFactory</code> as a Spring bean.
Note that this should rarely be necessary. See the <a href="../../../2.1.1/api/org/springframework/data/jdbc/repository/support/JdbcRepositoryFactory.html">Javadoc</a> for details.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="jdbc.entity-persistence.id-generation"><a class="anchor" href="index.html#jdbc.entity-persistence.id-generation"></a>9.6.9. ID Generation</h4>
<div class="paragraph">
<p>Spring Data JDBC uses the ID to identify entities.
The ID of an entity must be annotated with Spring Data&#8217;s <a href="../../../../../commons/docs/current/api/org/springframework/data/annotation/Id.html"><code>@Id</code></a> annotation.</p>
</div>
<div class="paragraph">
<p>When your data base has an auto-increment column for the ID column, the generated value gets set in the entity after inserting it into the database.</p>
</div>
<div class="paragraph">
<p>One important constraint is that, after saving an entity, the entity must not be new any more.
Note that whether an entity is new is part of the entity&#8217;s state.
With auto-increment columns, this happens automatically, because the ID gets set by Spring Data with the value from the ID column.
If you are not using auto-increment columns, you can use a <code>BeforeSave</code> listener, which sets the ID of the entity (covered later in this document).</p>
</div>
</div>
<div class="sect3">
<h4 id="jdbc.entity-persistence.optimistic-locking"><a class="anchor" href="index.html#jdbc.entity-persistence.optimistic-locking"></a>9.6.10. Optimistic Locking</h4>
<div class="paragraph">
<p>Spring Data JDBC supports optimistic locking by means of a numeric attribute that is annotated with
<a href="../../../../../commons/docs/current/api/org/springframework/data/annotation/Version.html"><code>@Version</code></a> on the aggregate root.
Whenever Spring Data JDBC saves an aggregate with such a version attribute two things happen:
The update statement for the aggregate root will contain a where clause checking that the version stored in the database is actually unchanged.
If this isn&#8217;t the case an <code>OptimisticLockingFailureException</code> will be thrown.
Also the version attribute gets increased both in the entity and in the database so a concurrent action will notice the change and throw an <code>OptimisticLockingFailureException</code> if applicable as described above.</p>
</div>
<div class="paragraph">
<p>This process also applies to inserting new aggregates, where a <code>null</code> or <code>0</code> version indicates a new instance and the increased instance afterwards marks the instance as not new anymore, making this work rather nicely with cases where the id is generated during object construction for example when UUIDs are used.</p>
</div>
<div class="paragraph">
<p>During deletes the version check also applies but no version is increased.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="jdbc.query-methods"><a class="anchor" href="index.html#jdbc.query-methods"></a>9.7. Query Methods</h3>
<div class="paragraph">
<p>This section offers some specific information about the implementation and use of Spring Data JDBC.</p>
</div>
<div class="paragraph">
<p>Most of the data access operations you usually trigger on a repository result in a query being run against the databases.
Defining such a query is a matter of declaring a method on the repository interface, as the following example shows:</p>
</div>
<div class="exampleblock">
<div class="title">Example 58. PersonRepository with query methods</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">interface PersonRepository extends PagingAndSortingRepository&lt;Person, String&gt; {

  List&lt;Person&gt; findByFirstname(String firstname);                                   <i class="conum" data-value="1"></i><b>(1)</b>

  List&lt;Person&gt; findByFirstnameOrderByLastname(String firstname, Pageable pageable); <i class="conum" data-value="2"></i><b>(2)</b>

  Person findByFirstnameAndLastname(String firstname, String lastname);             <i class="conum" data-value="3"></i><b>(3)</b>

  Person findFirstByLastname(String lastname);                                      <i class="conum" data-value="4"></i><b>(4)</b>

  @Query("SELECT * FROM person WHERE lastname = :lastname")
  List&lt;Person&gt; findByLastname(String lastname);                                     <i class="conum" data-value="5"></i><b>(5)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The method shows a query for all people with the given <code>lastname</code>.
The query is derived by parsing the method name for constraints that can be concatenated with <code>And</code> and <code>Or</code>.
Thus, the method name results in a query expression of <code>SELECT … FROM person WHERE firstname = :firstname</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Use <code>Pageable</code> to pass offset and sorting parameters to the database.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Find a single entity for the given criteria.
It completes with <code>IncorrectResultSizeDataAccessException</code> on non-unique results.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>In contrast to &lt;3&gt;, the first entity is always emitted even if the query yields more result documents.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>The <code>findByLastname</code> method shows a query for all people with the given last name.</td>
</tr>
</table>
</div>
</div>
</div>
<div class="paragraph">
<p>The following table shows the keywords that are supported for query methods:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 3. Supported keywords for query methods</caption>
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 33.3333%;">
<col style="width: 50.0001%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Keyword</th>
<th class="tableblock halign-left valign-top">Sample</th>
<th class="tableblock halign-left valign-top">Logical result</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>After</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>findByBirthdateAfter(Date date)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>birthdate &gt; date</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>GreaterThan</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>findByAgeGreaterThan(int age)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>age &gt; age</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>GreaterThanEqual</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>findByAgeGreaterThanEqual(int age)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>age &gt;= age</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Before</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>findByBirthdateBefore(Date date)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>birthdate &lt; date</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>LessThan</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>findByAgeLessThan(int age)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>age &lt; age</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>LessThanEqual</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>findByAgeLessThanEqual(int age)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>age &lt;= age</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Between</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>findByAgeBetween(int from, int to)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>age BETWEEN from AND to</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>NotBetween</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>findByAgeBetween(int from, int to)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>age NOT BETWEEN from AND to</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>In</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>findByAgeIn(Collection&lt;Integer&gt; ages)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>age IN (age1, age2, ageN)</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>NotIn</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>findByAgeNotIn(Collection ages)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>age NOT IN (age1, age2, ageN)</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>IsNotNull</code>, <code>NotNull</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>findByFirstnameNotNull()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>firstname IS NOT NULL</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>IsNull</code>, <code>Null</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>findByFirstnameNull()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>firstname IS NULL</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Like</code>, <code>StartingWith</code>, <code>EndingWith</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>findByFirstnameLike(String name)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>firstname LIKE name</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>NotLike</code>, <code>IsNotLike</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>findByFirstnameNotLike(String name)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>firstname NOT LIKE name</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Containing</code> on String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>findByFirstnameContaining(String name)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>firstname LIKE '%' name +'%'</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>NotContaining</code> on String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>findByFirstnameNotContaining(String name)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>firstname NOT LIKE '%' name +'%'</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>(No keyword)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>findByFirstname(String name)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>firstname = name</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Not</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>findByFirstnameNot(String name)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>firstname != name</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>IsTrue</code>, <code>True</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>findByActiveIsTrue()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>active IS TRUE</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>IsFalse</code>, <code>False</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>findByActiveIsFalse()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>active IS FALSE</code></p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Query derivation is limited to properties that can be used in a <code>WHERE</code> clause without using joins.
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="jdbc.query-methods.strategies"><a class="anchor" href="index.html#jdbc.query-methods.strategies"></a>9.7.1. Query Lookup Strategies</h4>
<div class="paragraph">
<p>The JDBC module supports defining a query manually as a String in a <code>@Query</code> annotation or as named query in a property file.
Deriving a query from the name of the method is currently not supported.</p>
</div>
</div>
<div class="sect3">
<h4 id="jdbc.query-methods.at-query"><a class="anchor" href="index.html#jdbc.query-methods.at-query"></a>9.7.2. Using <code>@Query</code></h4>
<div class="paragraph">
<p>The following example shows how to use <code>@Query</code> to declare a query method:</p>
</div>
<div class="exampleblock">
<div class="title">Example 59. Declare a query method by using @Query</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">public interface UserRepository extends CrudRepository&lt;User, Long&gt; {

  @Query("select firstName, lastName from User u where u.emailAddress = :email")
  User findByEmailAddress(@Param("email") String email);
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>For converting the query result into entities the same <code>RowMapper</code> is used by default as for the queries Spring Data JDBC generates itself.
The query you provide must match the format the <code>RowMapper</code> expects.
Columns for all properties that are used in the constructor of an entity must be provided.
Columns for properties that get set via setter, wither or field access are optional.
Properties that don&#8217;t have a matching column in the result will not be set.
The query is used for populating the aggregate root, embedded entities and one-to-one relationships including arrays of primitive types which get stored and loaded as SQL-array-types.
Separate queries are generated for maps, lists, sets and arrays of entities.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Spring fully supports Java 8’s parameter name discovery based on the <code>-parameters</code> compiler flag.
By using this flag in your build as an alternative to debug information, you can omit the <code>@Param</code> annotation for named parameters.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Spring Data JDBC supports only named parameters.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="jdbc.query-methods.named-query"><a class="anchor" href="index.html#jdbc.query-methods.named-query"></a>9.7.3. Named Queries</h4>
<div class="paragraph">
<p>If no query is given in an annotation as described in the previous section Spring Data JDBC will try to locate a named query.
There are two ways how the name of the query can be determined.
The default is to take the <em>domain class</em> of the query, i.e. the aggregate root of the repository, take its simple name and append the name of the method separated by a <code>.</code>.
Alternatively the <code>@Query</code> annotation has a <code>name</code> attribute which can be used to specify the name of a query to be looked up.</p>
</div>
<div class="paragraph">
<p>Named queries are expected to be provided in the property file <code>META-INF/jdbc-named-queries.properties</code> on the classpath.</p>
</div>
<div class="paragraph">
<p>The location of that file may be changed by setting a value to <code>@EnableJdbcRepositories.namedQueriesLocation</code>.</p>
</div>
<div class="sect4">
<h5 id="jdbc.query-methods.at-query.custom-rowmapper"><a class="anchor" href="index.html#jdbc.query-methods.at-query.custom-rowmapper"></a>Custom <code>RowMapper</code></h5>
<div class="paragraph">
<p>You can configure which <code>RowMapper</code> to use, either by using the <code>@Query(rowMapperClass = &#8230;&#8203;.)</code> or by registering a <code>RowMapperMap</code> bean and registering a <code>RowMapper</code> per method return type.
The following example shows how to register <code>DefaultQueryMappingConfiguration</code>:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">@Bean
QueryMappingConfiguration rowMappers() {
  return new DefaultQueryMappingConfiguration()
    .register(Person.class, new PersonRowMapper())
    .register(Address.class, new AddressRowMapper());
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>When determining which <code>RowMapper</code> to use for a method, the following steps are followed, based on the return type of the method:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>If the type is a simple type, no <code>RowMapper</code> is used.</p>
<div class="paragraph">
<p>Instead, the query is expected to return a single row with a single column, and a conversion to the return type is applied to that value.</p>
</div>
</li>
<li>
<p>The entity classes in the <code>QueryMappingConfiguration</code> are iterated until one is found that is a superclass or interface of the return type in question.
The <code>RowMapper</code> registered for that class is used.</p>
<div class="paragraph">
<p>Iterating happens in the order of registration, so make sure to register more general types after specific ones.</p>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>If applicable, wrapper types such as collections or <code>Optional</code> are unwrapped.
Thus, a return type of <code>Optional&lt;Person&gt;</code> uses the <code>Person</code> type in the preceding process.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Using a custom <code>RowMapper</code> through <code>QueryMappingConfiguration</code>, <code>@Query(rowMapperClass=…)</code>, or a custom <code>ResultSetExtractor</code> disables Entity Callbacks and Lifecycle Events as the result mapping can issue its own events/callbacks if needed.
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="jdbc.query-methods.at-query.modifying"><a class="anchor" href="index.html#jdbc.query-methods.at-query.modifying"></a>Modifying Query</h5>
<div class="paragraph">
<p>You can mark a query as being a modifying query by using the <code>@Modifying</code> on query method, as the following example shows:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">@Modifying
@Query("UPDATE DUMMYENTITY SET name = :name WHERE id = :id")
boolean updateName(@Param("id") Long id, @Param("name") String name);</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>You can specify the following return types:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>void</code></p>
</li>
<li>
<p><code>int</code> (updated record count)</p>
</li>
<li>
<p><code>boolean</code>(whether a record was updated)</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="jdbc.mybatis"><a class="anchor" href="index.html#jdbc.mybatis"></a>9.8. MyBatis Integration</h3>
<div class="paragraph">
<p>The CRUD operations and query methods can be delegated to MyBatis.
This section describes how to configure Spring Data JDBC to integrate with MyBatis and which conventions to follow to hand over the running of the queries as well as the mapping to the library.</p>
</div>
<div class="sect3">
<h4 id="jdbc.mybatis.configuration"><a class="anchor" href="index.html#jdbc.mybatis.configuration"></a>9.8.1. Configuration</h4>
<div class="paragraph">
<p>The easiest way to properly plug MyBatis into Spring Data JDBC is by importing <code>MyBatisJdbcConfiguration</code> into you application configuration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">@Configuration
@EnableJdbcRepositories
@Import(MyBatisJdbcConfiguration.class)
class Application {

  @Bean
  SqlSessionFactoryBean sqlSessionFactoryBean() {
    // Configure MyBatis here
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>As you can see, all you need to declare is a <code>SqlSessionFactoryBean</code> as <code>MyBatisJdbcConfiguration</code> relies on a <code>SqlSession</code> bean to be available in the <code>ApplicationContext</code> eventually.</p>
</div>
</div>
<div class="sect3">
<h4 id="jdbc.mybatis.conventions"><a class="anchor" href="index.html#jdbc.mybatis.conventions"></a>9.8.2. Usage conventions</h4>
<div class="paragraph">
<p>For each operation in <code>CrudRepository</code>, Spring Data JDBC runs multiple statements.
If there is a <a href="https://github.com/mybatis/mybatis-3/blob/master/src/main/java/org/apache/ibatis/session/SqlSessionFactory.java"><code>SqlSessionFactory</code></a> in the application context, Spring Data checks, for each step, whether the <code>SessionFactory</code> offers a statement.
If one is found, that statement (including its configured mapping to an entity) is used.</p>
</div>
<div class="paragraph">
<p>The name of the statement is constructed by concatenating the fully qualified name of the entity type with <code>Mapper.</code> and a <code>String</code> determining the kind of statement.
For example, if an instance of <code>org.example.User</code> is to be inserted, Spring Data JDBC looks for a statement named <code>org.example.UserMapper.insert</code>.</p>
</div>
<div class="paragraph">
<p>When the statement is run, an instance of [<code>MyBatisContext</code>] gets passed as an argument, which makes various arguments available to the statement.</p>
</div>
<div class="paragraph">
<p>The following table describes the available MyBatis statements:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Purpose</th>
<th class="tableblock halign-left valign-top">CrudRepository methods that might trigger this statement</th>
<th class="tableblock halign-left valign-top">Attributes available in the <code>MyBatisContext</code></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>insert</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Inserts a single entity. This also applies for entities referenced by the aggregate root.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>save</code>, <code>saveAll</code>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>getInstance</code>: the instance to be saved</p>
<p class="tableblock"><code>getDomainType</code>: The type of the entity to be saved.</p>
<p class="tableblock"><code>get(&lt;key&gt;)</code>: ID of the referencing entity, where <code>&lt;key&gt;</code> is the name of the back reference column provided by the <code>NamingStrategy</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>update</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Updates a single entity. This also applies for entities referenced by the aggregate root.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>save</code>, <code>saveAll</code>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>getInstance</code>: The instance to be saved</p>
<p class="tableblock"><code>getDomainType</code>: The type of the entity to be saved.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>delete</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Deletes a single entity.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>delete</code>, <code>deleteById</code>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>getId</code>: The ID of the instance to be deleted</p>
<p class="tableblock"><code>getDomainType</code>: The type of the entity to be deleted.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>deleteAll-&lt;propertyPath&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Deletes all entities referenced by any aggregate root of the type used as prefix with the given property path.
Note that the type used for prefixing the statement name is the name of the aggregate root, not the one of the entity to be deleted.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>deleteAll</code>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>getDomainType</code>: The types of the entities to be deleted.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>deleteAll</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Deletes all aggregate roots of the type used as the prefix</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>deleteAll</code>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>getDomainType</code>: The type of the entities to be deleted.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>delete-&lt;propertyPath&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Deletes all entities referenced by an aggregate root with the given propertyPath</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>deleteById</code>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>getId</code>: The ID of the aggregate root for which referenced entities are to be deleted.</p>
<p class="tableblock"><code>getDomainType</code>: The type of the entities to be deleted.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>findById</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Selects an aggregate root by ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>findById</code>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>getId</code>: The ID of the entity to load.</p>
<p class="tableblock"><code>getDomainType</code>: The type of the entity to load.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>findAll</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Select all aggregate roots</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>findAll</code>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>getDomainType</code>: The type of the entity to load.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>findAllById</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Select a set of aggregate roots by ID values</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>findAllById</code>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>getId</code>: A list of ID values of the entities to load.</p>
<p class="tableblock"><code>getDomainType</code>: The type of the entity to load.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>findAllByProperty-&lt;propertyName&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Select a set of entities that is referenced by another entity. The type of the referencing entity is used for the prefix. The referenced entities type is used as the suffix. <em>This method is deprecated. Use <code>findAllByPath</code> instead</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">All <code>find*</code> methods. If no query is defined for <code>findAllByPath</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>getId</code>: The ID of the entity referencing the entities to be loaded.</p>
<p class="tableblock"><code>getDomainType</code>: The type of the entity to load.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>findAllByPath-&lt;propertyPath&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Select a set of entities that is referenced by another entity via a property path.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">All <code>find*</code> methods.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>getIdentifier</code>: The <code>Identifier</code> holding the id of the aggregate root plus the keys and list indexes of all path elements.</p>
<p class="tableblock"><code>getDomainType</code>: The type of the entity to load.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>findAllSorted</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Select all aggregate roots, sorted</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>findAll(Sort)</code>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>getSort</code>: The sorting specification.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>findAllPaged</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Select a page of aggregate roots, optionally sorted</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>findAll(Page)</code>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>getPageable</code>: The paging specification.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>count</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Count the number of aggregate root of the type used as prefix</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>count</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>getDomainType</code>: The type of aggregate roots to count.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect2">
<h3 id="jdbc.events"><a class="anchor" href="index.html#jdbc.events"></a>9.9. Lifecycle Events</h3>
<div class="paragraph">
<p>Spring Data JDBC triggers events that get published to any matching <code>ApplicationListener</code> beans in the application context.
For example, the following listener gets invoked before an aggregate gets saved:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">@Bean
public ApplicationListener&lt;BeforeSaveEvent&lt;Object&gt;&gt; loggingSaves() {

	return event -&gt; {

		Object entity = event.getEntity();
		LOG.info("{} is getting saved.", entity);
	};
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>If you want to handle events only for a specific domain type you may derive your listener from <code>AbstractRelationalEventListener</code> and overwrite one or more of the <code>onXXX</code> methods, where <code>XXX</code> stands for an event type.
Callback methods will only get invoked for events related to the domain type and their subtypes so you don&#8217;t require further casting.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">public class PersonLoadListener extends AbstractRelationalEventListener&lt;Person&gt; {

	@Override
	protected void onAfterLoad(AfterLoadEvent&lt;Person&gt; personLoad) {
		LOG.info(personLoad.getEntity());
	}
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The following table describes the available events:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 4. Available events</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Event</th>
<th class="tableblock halign-left valign-top">When It Is Published</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../../../2.1.1/api/org/springframework/data/relational/core/mapping/event/BeforeDeleteEvent.html"><code>BeforeDeleteEvent</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Before an aggregate root gets deleted.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../../../2.1.1/api/org/springframework/data/relational/core/mapping/event/AfterDeleteEvent.html"><code>AfterDeleteEvent</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">After an aggregate root gets deleted.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../../../2.1.1/api/org/springframework/data/relational/core/mapping/event/BeforeConvertEvent.html"><code>BeforeConvertEvent</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Before an aggregate root gets saved (that is, inserted or updated but after the decision about whether if it gets updated or deleted was made).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../../../2.1.1/api/org/springframework/data/relational/core/mapping/event/BeforeSaveEvent.html"><code>BeforeSaveEvent</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Before an aggregate root gets saved (that is, inserted or updated but after the decision about whether if it gets updated or deleted was made).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../../../2.1.1/api/org/springframework/data/relational/core/mapping/event/AfterSaveEvent.html"><code>AfterSaveEvent</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">After an aggregate root gets saved (that is, inserted or updated).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../../../2.1.1/api/org/springframework/data/relational/core/mapping/event/AfterLoadEvent.html"><code>AfterLoadEvent</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">After an aggregate root gets created from a database <code>ResultSet</code> and all its properties get set.</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Lifecycle events depend on an <code>ApplicationEventMulticaster</code>, which in case of the <code>SimpleApplicationEventMulticaster</code> can be configured with a <code>TaskExecutor</code>, and therefore gives no guarantees when an Event is processed.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="entity-callbacks"><a class="anchor" href="index.html#entity-callbacks"></a>9.10. Entity Callbacks</h3>
<div class="paragraph">
<p>The Spring Data infrastructure provides hooks for modifying an entity before and after certain methods are invoked.
Those so called <code>EntityCallback</code> instances provide a convenient way to check and potentially modify an entity in a callback fashioned style.<br>
An <code>EntityCallback</code> looks pretty much like a specialized <code>ApplicationListener</code>.
Some Spring Data modules publish store specific events (such as <code>BeforeSaveEvent</code>) that allow modifying the given entity. In some cases, such as when working with immutable types, these events can cause trouble.
Also, event publishing relies on <code>ApplicationEventMulticaster</code>. If configuring that with an asynchronous <code>TaskExecutor</code> it can lead to unpredictable outcomes, as event processing can be forked onto a Thread.</p>
</div>
<div class="paragraph">
<p>Entity callbacks provide integration points with both synchronous and reactive APIs to guarantee in-order execution at well-defined checkpoints within the processing chain, returning a potentially modified entity or an reactive wrapper type.</p>
</div>
<div class="paragraph">
<p>Entity callbacks are typically separated by API type. This separation means that a synchronous API considers only synchronous entity callbacks and a reactive implementation considers only reactive entity callbacks.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The Entity Callback API has been introduced with Spring Data Commons 2.2. It is the recommended way of applying entity modifications.
Existing store specific <code>ApplicationEvents</code> are still published <strong>before</strong> the invoking potentially registered <code>EntityCallback</code> instances.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="entity-callbacks.implement"><a class="anchor" href="index.html#entity-callbacks.implement"></a>9.10.1. Implementing Entity Callbacks</h4>
<div class="paragraph">
<p>An <code>EntityCallback</code> is directly associated with its domain type through its generic type argument.
Each Spring Data module typically ships with a set of predefined <code>EntityCallback</code> interfaces covering the entity lifecycle.</p>
</div>
<div class="exampleblock">
<div class="title">Example 60. Anatomy of an <code>EntityCallback</code></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">@FunctionalInterface
public interface BeforeSaveCallback&lt;T&gt; extends EntityCallback&lt;T&gt; {

	/**
	 * Entity callback method invoked before a domain object is saved.
	 * Can return either the same or a modified instance.
	 *
	 * @return the domain object to be persisted.
	 */
	T onBeforeSave(T entity &lt;2&gt;, String collection &lt;3&gt;); <i class="conum" data-value="1"></i><b>(1)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>BeforeSaveCallback</code> specific method to be called before an entity is saved. Returns a potentially modifed instance.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The entity right before persisting.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>A number of store specific arguments like the <em>collection</em> the entity is persisted to.</td>
</tr>
</table>
</div>
</div>
</div>
<div class="exampleblock">
<div class="title">Example 61. Anatomy of a reactive <code>EntityCallback</code></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">@FunctionalInterface
public interface ReactiveBeforeSaveCallback&lt;T&gt; extends EntityCallback&lt;T&gt; {

	/**
	 * Entity callback method invoked on subscription, before a domain object is saved.
	 * The returned Publisher can emit either the same or a modified instance.
	 *
	 * @return Publisher emitting the domain object to be persisted.
	 */
	Publisher&lt;T&gt; onBeforeSave(T entity &lt;2&gt;, String collection &lt;3&gt;); <i class="conum" data-value="1"></i><b>(1)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>BeforeSaveCallback</code> specific method to be called on subscription, before an entity is saved. Emits a potentially modifed instance.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The entity right before persisting.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>A number of store specific arguments like the <em>collection</em> the entity is persisted to.</td>
</tr>
</table>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Optional entity callback parameters are defined by the implementing Spring Data module and inferred from call site of <code>EntityCallback.callback()</code>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Implement the interface suiting your application needs like shown in the example below:</p>
</div>
<div class="exampleblock">
<div class="title">Example 62. Example <code>BeforeSaveCallback</code></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">class DefaultingEntityCallback implements BeforeSaveCallback&lt;Person&gt;, Ordered {      <i class="conum" data-value="2"></i><b>(2)</b>

	@Override
	public Object onBeforeSave(Person entity, String collection) {                   <i class="conum" data-value="1"></i><b>(1)</b>

		if(collection == "user") {
		    return // ...
		}

		return // ...
	}

	@Override
	public int getOrder() {
		return 100;                                                                  <i class="conum" data-value="2"></i><b>(2)</b>
	}
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Callback implementation according to your requirements.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Potentially order the entity callback if multiple ones for the same domain type exist. Ordering follows lowest precedence.</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="entity-callbacks.register"><a class="anchor" href="index.html#entity-callbacks.register"></a>9.10.2. Registering Entity Callbacks</h4>
<div class="paragraph">
<p><code>EntityCallback</code> beans are picked up by the store specific implementations in case they are registered in the <code>ApplicationContext</code>.
Most template APIs already implement <code>ApplicationContextAware</code> and therefore have access to the <code>ApplicationContext</code></p>
</div>
<div class="paragraph">
<p>The following example explains a collection of valid entity callback registrations:</p>
</div>
<div class="exampleblock">
<div class="title">Example 63. Example <code>EntityCallback</code> Bean registration</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">@Order(1)                                                           <i class="conum" data-value="1"></i><b>(1)</b>
@Component
class First implements BeforeSaveCallback&lt;Person&gt; {

	@Override
	public Person onBeforeSave(Person person) {
		return // ...
	}
}

@Component
class DefaultingEntityCallback implements BeforeSaveCallback&lt;Person&gt;,
                                                           Ordered { <i class="conum" data-value="2"></i><b>(2)</b>

	@Override
	public Object onBeforeSave(Person entity, String collection) {
		// ...
	}

	@Override
	public int getOrder() {
		return 100;                                                  <i class="conum" data-value="2"></i><b>(2)</b>
	}
}

@Configuration
public class EntityCallbackConfiguration {

    @Bean
    BeforeSaveCallback&lt;Person&gt; unorderedLambdaReceiverCallback() {   <i class="conum" data-value="3"></i><b>(3)</b>
        return (BeforeSaveCallback&lt;Person&gt;) it -&gt; // ...
    }
}

@Component
class UserCallbacks implements BeforeConvertCallback&lt;User&gt;,
                                        BeforeSaveCallback&lt;User&gt; {   <i class="conum" data-value="4"></i><b>(4)</b>

	@Override
	public Person onBeforeConvert(User user) {
		return // ...
	}

	@Override
	public Person onBeforeSave(User user) {
		return // ...
	}
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>BeforeSaveCallback</code> receiving its order from the <code>@Order</code> annotation.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td><code>BeforeSaveCallback</code> receiving its order via the <code>Ordered</code> interface implementation.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td><code>BeforeSaveCallback</code> using a lambda expression. Unordered by default and invoked last. Note that callbacks implemented by a lambda expression do not expose typing information hence invoking these with a non-assignable entity affects the callback throughput. Use a <code>class</code> or <code>enum</code> to enable type filtering for the callback bean.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Combine multiple entity callback interfaces in a single implementation class.</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="jdbc.entity-callbacks"><a class="anchor" href="index.html#jdbc.entity-callbacks"></a>9.10.3. Store-specific EntityCallbacks</h4>
<div class="paragraph">
<p>Spring Data JDBC uses the <code>EntityCallback</code> API for its auditing support and reacts on the following callbacks:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 5. Available Callbacks</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><code>EntityCallback</code></th>
<th class="tableblock halign-left valign-top">When It Is Published</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../../../2.1.1/api/org/springframework/data/relational/core/mapping/event/BeforeDeleteCallback.html"><code>BeforeDeleteCallback</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Before an aggregate root gets deleted.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../../../2.1.1/api/org/springframework/data/relational/core/mapping/event/AfterDeleteCallback.html"><code>AfterDeleteCallback</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">After an aggregate root gets deleted.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../../../2.1.1/api/org/springframework/data/relational/core/mapping/event/BeforeConvertCallback.html"><code>BeforeConvertCallback</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Before an aggregate root gets saved (that is, inserted or updated but after the decision about whether if it gets updated or deleted was made).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../../../2.1.1/api/org/springframework/data/relational/core/mapping/event/BeforeSaveCallback.html"><code>BeforeSaveCallback</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Before an aggregate root gets saved (that is, inserted or updated but after the decision about whether if it gets updated or deleted was made).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../../../2.1.1/api/org/springframework/data/relational/core/mapping/event/AfterSaveCallback.html"><code>AfterSaveCallback</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">After an aggregate root gets saved (that is, inserted or updated).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../../../2.1.1/api/org/springframework/data/relational/core/mapping/event/AfterLoadCallback.html"><code>AfterLoadCallback</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">After an aggregate root gets created from a database <code>ResultSet</code> and all its property get set.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect2">
<h3 id="jdbc.custom-converters"><a class="anchor" href="index.html#jdbc.custom-converters"></a>9.11. Custom Conversions</h3>
<div class="paragraph">
<p>Spring Data JDBC allows registration of custom converters to influence how values are mapped in the database.
Currently, converters are only applied on property-level.</p>
</div>
<div class="sect3">
<h4 id="jdbc.custom-converters.writer"><a class="anchor" href="index.html#jdbc.custom-converters.writer"></a>9.11.1. Writing a Property by Using a Registered Spring Converter</h4>
<div class="paragraph">
<p>The following example shows an implementation of a <code>Converter</code> that converts from a <code>Boolean</code> object to a <code>String</code> value:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">import org.springframework.core.convert.converter.Converter;

@WritingConverter
public class BooleanToStringConverter implements Converter&lt;Boolean, String&gt; {

    @Override
    public String convert(Boolean source) {
        return source != null &amp;&amp; source ? "T" : "F";
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>There are a couple of things to notice here: <code>Boolean</code> and <code>String</code> are both simple types hence Spring Data requires a hint in which direction this converter should apply (reading or writing).
By annotating this converter with <code>@WritingConverter</code> you instruct Spring Data to write every <code>Boolean</code> property as <code>String</code> in the database.</p>
</div>
</div>
<div class="sect3">
<h4 id="jdbc.custom-converters.reader"><a class="anchor" href="index.html#jdbc.custom-converters.reader"></a>9.11.2. Reading by Using a Spring Converter</h4>
<div class="paragraph">
<p>The following example shows an implementation of a <code>Converter</code> that converts from a <code>String</code> to a <code>Boolean</code> value:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">@ReadingConverter
public class StringToBooleanConverter implements Converter&lt;String, Boolean&gt; {

    @Override
    public Boolean convert(String source) {
        return source != null &amp;&amp; source.equalsIgnoreCase("T") ? Boolean.TRUE : Boolean.FALSE;
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>There are a couple of things to notice here: <code>String</code> and <code>Boolean</code> are both simple types hence Spring Data requires a hint in which direction this converter should apply (reading or writing).
By annotating this converter with <code>@ReadingConverter</code> you instruct Spring Data to convert every <code>String</code> value from the database that should be assigned to a <code>Boolean</code> property.</p>
</div>
</div>
<div class="sect3">
<h4 id="jdbc.custom-converters.configuration"><a class="anchor" href="index.html#jdbc.custom-converters.configuration"></a>9.11.3. Registering Spring Converters with the <code>JdbcConverter</code></h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">class MyJdbcConfiguration extends AbstractJdbcConfiguration {

    // …

    @Overwrite
    @Bean
    public JdbcCustomConversions jdbcCustomConversions() {
        return new JdbcCustomConversions(Arrays.asList(new BooleanToStringConverter(), new StringToBooleanConverter()));
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following example of a Spring <code>Converter</code> implementation converts from a <code>String</code> to a custom <code>Email</code> value object:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">@ReadingConverter
public class EmailReadConverter implements Converter&lt;String, Email&gt; {

  public Email convert(String source) {
    return Email.valueOf(source);
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you write a <code>Converter</code> whose source and target type are native types, we cannot determine whether we should consider it as a reading or a writing converter.
Registering the converter instance as both might lead to unwanted results.
For example, a <code>Converter&lt;String, Long&gt;</code> is ambiguous, although it probably does not make sense to try to convert all <code>String</code> instances into <code>Long</code> instances when writing.
To let you force the infrastructure to register a converter for only one way, we provide <code>@ReadingConverter</code> and <code>@WritingConverter</code> annotations to be used in the converter implementation.</p>
</div>
<div class="paragraph">
<p>Converters are subject to explicit registration as instances are not picked up from a classpath or container scan to avoid unwanted registration with a conversion service and the side effects resulting from such a registration. Converters are registered with <code>CustomConversions</code> as the central facility that allows registration and querying for registered converters based on source- and target type.</p>
</div>
<div class="paragraph">
<p><code>CustomConversions</code> ships with a pre-defined set of converter registrations:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>JSR-310 Converters for conversion between <code>java.time</code>, <code>java.util.Date</code> and <code>String</code> types.</p>
</li>
<li>
<p>Deprecated: Joda Time Converters for conversion between <code>org.joda.time</code>, JSR-310, and <code>java.util.Date</code>.</p>
</li>
<li>
<p>Deprecated: ThreeTenBackport Converters for conversion between <code>org.joda.time</code>, JSR-310, and <code>java.util.Date</code>.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Default converters for local temporal types (e.g. <code>LocalDateTime</code> to <code>java.util.Date</code>) rely on system-default timezone settings to convert between those types. You can override the default converter, by registering your own converter.
</td>
</tr>
</table>
</div>
<div class="sect5">
<h6 id="customconversions.converter-disambiguation"><a class="anchor" href="index.html#customconversions.converter-disambiguation"></a>Converter Disambiguation</h6>
<div class="paragraph">
<p>Generally, we inspect the <code>Converter</code> implementations for the source and target types they convert from and to.
Depending on whether one of those is a type the underlying data access API can handle natively, we register the converter instance as a reading or a writing converter.
The following examples show a writing- and a read converter (note the difference is in the order of the qualifiers on <code>Converter</code>):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">// Write converter as only the target type is one that can be handled natively
class MyConverter implements Converter&lt;Person, String&gt; { … }

// Read converter as only the source type is one that can be handled natively
class MyConverter implements Converter&lt;String, Person&gt; { … }</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="jdbc.logging"><a class="anchor" href="index.html#jdbc.logging"></a>9.12. Logging</h3>
<div class="paragraph">
<p>Spring Data JDBC does little to no logging on its own.
Instead, the mechanics of <code>JdbcTemplate</code> to issue SQL statements provide logging.
Thus, if you want to inspect what SQL statements are run, activate logging for Spring&#8217;s <a href="https://docs.spring.io/spring/docs/5.3.1/spring-framework-reference/data-access.html#jdbc-JdbcTemplate"><code>NamedParameterJdbcTemplate</code></a> or <a href="https://www.mybatis.org/mybatis-3/logging.html">MyBatis</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="jdbc.transactions"><a class="anchor" href="index.html#jdbc.transactions"></a>9.13. Transactionality</h3>
<div class="paragraph">
<p>CRUD methods on repository instances are transactional by default.
For reading operations, the transaction configuration <code>readOnly</code> flag is set to <code>true</code>.
All others are configured with a plain <code>@Transactional</code> annotation so that default transaction configuration applies.
For details, see the Javadoc of <a href="../../../2.1.1/api/org/springframework/data/jdbc/repository/support/SimpleJdbcRepository.html"><code>SimpleJdbcRepository</code></a>.
If you need to tweak transaction configuration for one of the methods declared in a repository, redeclare the method in your repository interface, as follows:</p>
</div>
<div class="exampleblock">
<div class="title">Example 64. Custom transaction configuration for CRUD</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">public interface UserRepository extends CrudRepository&lt;User, Long&gt; {

  @Override
  @Transactional(timeout = 10)
  public List&lt;User&gt; findAll();

  // Further query method declarations
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The preceding causes the <code>findAll()</code> method to be run with a timeout of 10 seconds and without the <code>readOnly</code> flag.</p>
</div>
<div class="paragraph">
<p>Another way to alter transactional behavior is by using a facade or service implementation that typically covers more than one repository.
Its purpose is to define transactional boundaries for non-CRUD operations.
The following example shows how to create such a facade:</p>
</div>
<div class="exampleblock">
<div class="title">Example 65. Using a facade to define transactions for multiple repository calls</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">@Service
class UserManagementImpl implements UserManagement {

  private final UserRepository userRepository;
  private final RoleRepository roleRepository;

  @Autowired
  public UserManagementImpl(UserRepository userRepository,
    RoleRepository roleRepository) {
    this.userRepository = userRepository;
    this.roleRepository = roleRepository;
  }

  @Transactional
  public void addRoleToAllUsers(String roleName) {

    Role role = roleRepository.findByName(roleName);

    for (User user : userRepository.findAll()) {
      user.addRole(role);
      userRepository.save(user);
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The preceding example causes calls to <code>addRoleToAllUsers(…)</code> to run inside a transaction (participating in an existing one or creating a new one if none are already running).
The transaction configuration for the repositories is neglected, as the outer transaction configuration determines the actual repository to be used.
Note that you have to explicitly activate <code>&lt;tx:annotation-driven /&gt;</code> or use <code>@EnableTransactionManagement</code> to get annotation-based configuration for facades working.
Note that the preceding example assumes you use component scanning.</p>
</div>
<div class="sect3">
<h4 id="jdbc.transaction.query-methods"><a class="anchor" href="index.html#jdbc.transaction.query-methods"></a>9.13.1. Transactional Query Methods</h4>
<div class="paragraph">
<p>To let your query methods be transactional, use <code>@Transactional</code> at the repository interface you define, as the following example shows:</p>
</div>
<div class="exampleblock">
<div class="title">Example 66. Using @Transactional at query methods</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">@Transactional(readOnly = true)
public interface UserRepository extends CrudRepository&lt;User, Long&gt; {

  List&lt;User&gt; findByLastname(String lastname);

  @Modifying
  @Transactional
  @Query("delete from User u where u.active = false")
  void deleteInactiveUsers();
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Typically, you want the <code>readOnly</code> flag to be set to true, because most of the query methods only read data.
In contrast to that, <code>deleteInactiveUsers()</code> uses the <code>@Modifying</code> annotation and overrides the transaction configuration.
Thus, the method is with the <code>readOnly</code> flag set to <code>false</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
It is definitely reasonable to use transactions for read-only queries, and we can mark them as such by setting the <code>readOnly</code> flag.
This does not, however, act as a check that you do not trigger a manipulating query (although some databases reject <code>INSERT</code> and <code>UPDATE</code> statements inside a read-only transaction).
Instead, the <code>readOnly</code> flag is propagated as a hint to the underlying JDBC driver for performance optimizations.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="auditing"><a class="anchor" href="index.html#auditing"></a>9.14. Auditing</h3>
<div class="sect3">
<h4 id="auditing.basics"><a class="anchor" href="index.html#auditing.basics"></a>9.14.1. Basics</h4>
<div class="paragraph">
<p>Spring Data provides sophisticated support to transparently keep track of who created or changed an entity and when the change happened. To benefit from that functionality, you have to equip your entity classes with auditing metadata that can be defined either using annotations or by implementing an interface.</p>
</div>
<div class="sect4">
<h5 id="auditing.annotations"><a class="anchor" href="index.html#auditing.annotations"></a>Annotation-based Auditing Metadata</h5>
<div class="paragraph">
<p>We provide <code>@CreatedBy</code> and <code>@LastModifiedBy</code> to capture the user who created or modified the entity as well as <code>@CreatedDate</code> and <code>@LastModifiedDate</code> to capture when the change happened.</p>
</div>
<div class="exampleblock">
<div class="title">Example 67. An audited entity</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">class Customer {

  @CreatedBy
  private User user;

  @CreatedDate
  private DateTime createdDate;

  // … further properties omitted
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>As you can see, the annotations can be applied selectively, depending on which information you want to capture. The annotations capturing when changes were made can be used on properties of type Joda-Time, <code>DateTime</code>, legacy Java <code>Date</code> and <code>Calendar</code>, JDK8 date and time types, and <code>long</code> or <code>Long</code>.</p>
</div>
</div>
<div class="sect4">
<h5 id="auditing.interfaces"><a class="anchor" href="index.html#auditing.interfaces"></a>Interface-based Auditing Metadata</h5>
<div class="paragraph">
<p>In case you do not want to use annotations to define auditing metadata, you can let your domain class implement the <code>Auditable</code> interface. It exposes setter methods for all of the auditing properties.</p>
</div>
<div class="paragraph">
<p>There is also a convenience base class, <code>AbstractAuditable</code>, which you can extend to avoid the need to manually implement the interface methods. Doing so increases the coupling of your domain classes to Spring Data, which might be something you want to avoid. Usually, the annotation-based way of defining auditing metadata is preferred as it is less invasive and more flexible.</p>
</div>
</div>
<div class="sect4">
<h5 id="auditing.auditor-aware"><a class="anchor" href="index.html#auditing.auditor-aware"></a><code>AuditorAware</code></h5>
<div class="paragraph">
<p>In case you use either <code>@CreatedBy</code> or <code>@LastModifiedBy</code>, the auditing infrastructure somehow needs to become aware of the current principal. To do so, we provide an <code>AuditorAware&lt;T&gt;</code> SPI interface that you have to implement to tell the infrastructure who the current user or system interacting with the application is. The generic type <code>T</code> defines what type the properties annotated with <code>@CreatedBy</code> or <code>@LastModifiedBy</code> have to be.</p>
</div>
<div class="paragraph">
<p>The following example shows an implementation of the interface that uses Spring Security&#8217;s <code>Authentication</code> object:</p>
</div>
<div class="exampleblock">
<div class="title">Example 68. Implementation of <code>AuditorAware</code> based on Spring Security</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">class SpringSecurityAuditorAware implements AuditorAware&lt;User&gt; {

  @Override
  public Optional&lt;User&gt; getCurrentAuditor() {

    return Optional.ofNullable(SecurityContextHolder.getContext())
            .map(SecurityContext::getAuthentication)
            .filter(Authentication::isAuthenticated)
            .map(Authentication::getPrincipal)
            .map(User.class::cast);
  }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The implementation accesses the <code>Authentication</code> object provided by Spring Security and looks up the custom <code>UserDetails</code> instance that you have created in your <code>UserDetailsService</code> implementation. We assume here that you are exposing the domain user through the <code>UserDetails</code> implementation but that, based on the <code>Authentication</code> found, you could also look it up from anywhere.</p>
</div>
</div>
<div class="sect4">
<h5 id="auditing.reactive-auditor-aware"><a class="anchor" href="index.html#auditing.reactive-auditor-aware"></a><code>ReactiveAuditorAware</code></h5>
<div class="paragraph">
<p>When using reactive infrastructure you might want to make use of contextual information to provide <code>@CreatedBy</code> or <code>@LastModifiedBy</code> information.
We provide an <code>ReactiveAuditorAware&lt;T&gt;</code> SPI interface that you have to implement to tell the infrastructure who the current user or system interacting with the application is. The generic type <code>T</code> defines what type the properties annotated with <code>@CreatedBy</code> or <code>@LastModifiedBy</code> have to be.</p>
</div>
<div class="paragraph">
<p>The following example shows an implementation of the interface that uses reactive Spring Security&#8217;s <code>Authentication</code> object:</p>
</div>
<div class="exampleblock">
<div class="title">Example 69. Implementation of <code>ReactiveAuditorAware</code> based on Spring Security</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">class SpringSecurityAuditorAware implements ReactiveAuditorAware&lt;User&gt; {

  @Override
  public Mono&lt;User&gt; getCurrentAuditor() {

    return ReactiveSecurityContextHolder.getContext()
                .map(SecurityContext::getAuthentication)
                .filter(Authentication::isAuthenticated)
                .map(Authentication::getPrincipal)
                .map(User.class::cast);
  }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The implementation accesses the <code>Authentication</code> object provided by Spring Security and looks up the custom <code>UserDetails</code> instance that you have created in your <code>UserDetailsService</code> implementation. We assume here that you are exposing the domain user through the <code>UserDetails</code> implementation but that, based on the <code>Authentication</code> found, you could also look it up from anywhere.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="jdbc.auditing"><a class="anchor" href="index.html#jdbc.auditing"></a>9.15. JDBC Auditing</h3>
<div class="paragraph">
<p>In order to activate auditing, add <code>@EnableJdbcAuditing</code> to your configuration, as the following example shows:</p>
</div>
<div class="exampleblock">
<div class="title">Example 70. Activating auditing with Java configuration</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">@Configuration
@EnableJdbcAuditing
class Config {

  @Bean
  public AuditorAware&lt;AuditableUser&gt; auditorProvider() {
    return new AuditorAwareImpl();
  }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>If you expose a bean of type <code>AuditorAware</code> to the <code>ApplicationContext</code>, the auditing infrastructure automatically picks it up and uses it to determine the current user to be set on domain types.
If you have multiple implementations registered in the <code>ApplicationContext</code>, you can select the one to be used by explicitly setting the <code>auditorAwareRef</code> attribute of <code>@EnableJdbcAuditing</code>.</p>
</div>
</div>
</div>
</div>
<h1 id="appendix" class="sect0"><a class="anchor" href="index.html#appendix"></a>Appendix</h1>
<div class="sect1">
<h2 id="glossary"><a class="anchor" href="index.html#glossary"></a>Appendix A: Glossary</h2>
<div class="sectionbody">
<div class="dlist">
<dl>
<dt class="hdlist1">AOP</dt>
<dd>
<p>Aspect-Oriented Programming</p>
</dd>
<dt class="hdlist1">CRUD</dt>
<dd>
<p>Create, Read, Update, Delete - Basic persistence operations</p>
</dd>
<dt class="hdlist1">Dependency Injection</dt>
<dd>
<p>Pattern to hand a component&#8217;s dependency to the component from outside, freeing the component to lookup the dependent itself.
For more information, see <a href="https://en.wikipedia.org/wiki/Dependency_Injection"><a href="https://en.wikipedia.org/wiki/Dependency_Injection" class="bare">https://en.wikipedia.org/wiki/Dependency_Injection</a></a>.</p>
</dd>
<dt class="hdlist1">JPA</dt>
<dd>
<p>Java Persistence API</p>
</dd>
<dt class="hdlist1">Spring</dt>
<dd>
<p>Java application framework&#8201;&#8212;&#8201;<a href="https://projects.spring.io/spring-framework"><a href="https://projects.spring.io/spring-framework" class="bare">https://projects.spring.io/spring-framework</a></a></p>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect1">
<h2 id="repositories.namespace-reference"><a class="anchor" href="index.html#repositories.namespace-reference"></a>Appendix B: Namespace reference</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="populator.namespace-dao-config"><a class="anchor" href="index.html#populator.namespace-dao-config"></a>The <code>&lt;repositories /&gt;</code> Element</h3>
<div class="paragraph">
<p>The <code>&lt;repositories /&gt;</code> element triggers the setup of the Spring Data repository infrastructure. The most important attribute is <code>base-package</code>, which defines the package to scan for Spring Data repository interfaces. See &#8220;<a href="index.html#repositories.create-instances.spring">XML Configuration</a>&#8221;. The following table describes the attributes of the <code>&lt;repositories /&gt;</code> element:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 6. Attributes</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>base-package</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Defines the package to be scanned for repository interfaces that extend <code>*Repository</code> (the actual interface is determined by the specific Spring Data module) in auto-detection mode. All packages below the configured package are scanned, too. Wildcards are allowed.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>repository-impl-postfix</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Defines the postfix to autodetect custom repository implementations. Classes whose names end with the configured postfix are considered as candidates. Defaults to <code>Impl</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>query-lookup-strategy</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Determines the strategy to be used to create finder queries. See &#8220;<a href="index.html#repositories.query-methods.query-lookup-strategies">Query Lookup Strategies</a>&#8221; for details. Defaults to <code>create-if-not-found</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>named-queries-location</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Defines the location to search for a Properties file containing externally defined queries.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>consider-nested-repositories</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether nested repository interface definitions should be considered. Defaults to <code>false</code>.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="populator.namespace-reference"><a class="anchor" href="index.html#populator.namespace-reference"></a>Appendix C: Populators namespace reference</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="namespace-dao-config"><a class="anchor" href="index.html#namespace-dao-config"></a>The &lt;populator /&gt; element</h3>
<div class="paragraph">
<p>The <code>&lt;populator /&gt;</code> element allows to populate the a data store via the Spring Data repository infrastructure.<sup class="footnote">[<a id="_footnoteref_1" class="footnote" href="index.html#_footnotedef_1" title="View footnote.">1</a>]</sup></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 7. Attributes</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>locations</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Where to find the files to read the objects from the repository shall be populated with.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="repository-query-keywords"><a class="anchor" href="index.html#repository-query-keywords"></a>Appendix D: Repository query keywords</h2>
<div class="sectionbody">
<div class="sect2">
<h3>Supported query keywords</h3>
<div class="paragraph">
<p>The following table lists the keywords generally supported by the Spring Data repository query derivation mechanism. However, consult the store-specific documentation for the exact list of supported keywords, because some keywords listed here might not be supported in a particular store.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 8. Query keywords</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Logical keyword</th>
<th class="tableblock halign-left valign-top">Keyword expressions</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>AND</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>And</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>OR</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Or</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>AFTER</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>After</code>, <code>IsAfter</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>BEFORE</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Before</code>, <code>IsBefore</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CONTAINING</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Containing</code>, <code>IsContaining</code>, <code>Contains</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>BETWEEN</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Between</code>, <code>IsBetween</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ENDING_WITH</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>EndingWith</code>, <code>IsEndingWith</code>, <code>EndsWith</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>EXISTS</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Exists</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>FALSE</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>False</code>, <code>IsFalse</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>GREATER_THAN</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>GreaterThan</code>, <code>IsGreaterThan</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>GREATER_THAN_EQUALS</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>GreaterThanEqual</code>, <code>IsGreaterThanEqual</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>IN</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>In</code>, <code>IsIn</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>IS</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Is</code>, <code>Equals</code>, (or no keyword)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>IS_EMPTY</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>IsEmpty</code>, <code>Empty</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>IS_NOT_EMPTY</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>IsNotEmpty</code>, <code>NotEmpty</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>IS_NOT_NULL</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>NotNull</code>, <code>IsNotNull</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>IS_NULL</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Null</code>, <code>IsNull</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>LESS_THAN</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>LessThan</code>, <code>IsLessThan</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>LESS_THAN_EQUAL</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>LessThanEqual</code>, <code>IsLessThanEqual</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>LIKE</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Like</code>, <code>IsLike</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>NEAR</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Near</code>, <code>IsNear</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>NOT</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Not</code>, <code>IsNot</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>NOT_IN</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>NotIn</code>, <code>IsNotIn</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>NOT_LIKE</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>NotLike</code>, <code>IsNotLike</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>REGEX</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Regex</code>, <code>MatchesRegex</code>, <code>Matches</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>STARTING_WITH</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>StartingWith</code>, <code>IsStartingWith</code>, <code>StartsWith</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>TRUE</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>True</code>, <code>IsTrue</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>WITHIN</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Within</code>, <code>IsWithin</code></p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="repository-query-return-types"><a class="anchor" href="index.html#repository-query-return-types"></a>Appendix E: Repository query return types</h2>
<div class="sectionbody">
<div class="sect2">
<h3>Supported Query Return Types</h3>
<div class="paragraph">
<p>The following table lists the return types generally supported by Spring Data repositories. However, consult the store-specific documentation for the exact list of supported return types, because some types listed here might not be supported in a particular store.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Geospatial types (such as <code>GeoResult</code>, <code>GeoResults</code>, and <code>GeoPage</code>) are available only for data stores that support geospatial queries.
</td>
</tr>
</table>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 9. Query return types</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Return type</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>void</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Denotes no return value.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Primitives</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Java primitives.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Wrapper types</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Java wrapper types.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>T</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A unique entity. Expects the query method to return one result at most. If no result is found, <code>null</code> is returned. More than one result triggers an <code>IncorrectResultSizeDataAccessException</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Iterator&lt;T&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An <code>Iterator</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Collection&lt;T&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A <code>Collection</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>List&lt;T&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A <code>List</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Optional&lt;T&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A Java 8 or Guava <code>Optional</code>. Expects the query method to return one result at most. If no result is found, <code>Optional.empty()</code> or <code>Optional.absent()</code> is returned. More than one result triggers an <code>IncorrectResultSizeDataAccessException</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Option&lt;T&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Either a Scala or Vavr <code>Option</code> type. Semantically the same behavior as Java 8&#8217;s <code>Optional</code>, described earlier.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Stream&lt;T&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A Java 8 <code>Stream</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Streamable&lt;T&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A convenience extension of <code>Iterable</code> that directy exposes methods to stream, map and filter results, concatenate them etc.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Types that implement <code>Streamable</code> and take a <code>Streamable</code> constructor or factory method argument</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Types that expose a constructor or <code>….of(…)</code>/<code>….valueOf(…)</code> factory method taking a <code>Streamable</code> as argument. See <a href="index.html#repositories.collections-and-iterables.streamable-wrapper">Returning Custom Streamable Wrapper Types</a> for details.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Vavr <code>Seq</code>, <code>List</code>, <code>Map</code>, <code>Set</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Vavr collection types. See <a href="index.html#repositories.collections-and-iterables.vavr">Support for Vavr Collections</a> for details.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Future&lt;T&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A <code>Future</code>. Expects a method to be annotated with <code>@Async</code> and requires Spring&#8217;s asynchronous method execution capability to be enabled.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CompletableFuture&lt;T&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A Java 8 <code>CompletableFuture</code>. Expects a method to be annotated with <code>@Async</code> and requires Spring&#8217;s asynchronous method execution capability to be enabled.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ListenableFuture</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A <code>org.springframework.util.concurrent.ListenableFuture</code>. Expects a method to be annotated with <code>@Async</code> and requires Spring&#8217;s asynchronous method execution capability to be enabled.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Slice</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A sized chunk of data with an indication of whether there is more data available. Requires a <code>Pageable</code> method parameter.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Page&lt;T&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A <code>Slice</code> with additional information, such as the total number of results. Requires a <code>Pageable</code> method parameter.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>GeoResult&lt;T&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A result entry with additional information, such as the distance to a reference location.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>GeoResults&lt;T&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A list of <code>GeoResult&lt;T&gt;</code> with additional information, such as the average distance to a reference location.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>GeoPage&lt;T&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A <code>Page</code> with <code>GeoResult&lt;T&gt;</code>, such as the average distance to a reference location.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Mono&lt;T&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A Project Reactor <code>Mono</code> emitting zero or one element using reactive repositories. Expects the query method to return one result at most. If no result is found, <code>Mono.empty()</code> is returned. More than one result triggers an <code>IncorrectResultSizeDataAccessException</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Flux&lt;T&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A Project Reactor <code>Flux</code> emitting zero, one, or many elements using reactive repositories. Queries returning <code>Flux</code> can emit also an infinite number of elements.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Single&lt;T&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A RxJava <code>Single</code> emitting a single element using reactive repositories. Expects the query method to return one result at most. If no result is found, <code>Mono.empty()</code> is returned. More than one result triggers an <code>IncorrectResultSizeDataAccessException</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Maybe&lt;T&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A RxJava <code>Maybe</code> emitting zero or one element using reactive repositories. Expects the query method to return one result at most. If no result is found, <code>Mono.empty()</code> is returned. More than one result triggers an <code>IncorrectResultSizeDataAccessException</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Flowable&lt;T&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A RxJava <code>Flowable</code> emitting zero, one, or many elements using reactive repositories. Queries returning <code>Flowable</code> can emit also an infinite number of elements.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<div id="footnotes">
<hr>
<div class="footnote" id="_footnotedef_1">
<a href="index.html#_footnoteref_1">1</a>. see <a href="index.html#repositories.create-instances.spring">XML Configuration</a>
</div>
</div>
<div id="footer">
<div id="footer-text">
Version 2.1.1<br>
Last updated 2020-11-11 12:30:59 +0100
</div>
</div>
<link rel="stylesheet" href="js/highlight/styles/github.min.css">
<script src="js/highlight/highlight.min.js"></script>
<script>hljs.initHighlighting()</script>
<script type="text/javascript" src="js/tocbot/tocbot.min.js"></script>
<script type="text/javascript" src="js/toc.js"></script>
<script>if(window.parent==window){(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');ga('create','UA-2728886-23','auto',{'siteSpeedSampleRate':100});ga('send','pageview');}</script></body>
</html>